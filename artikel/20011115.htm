<HTML>
<HEAD>
<TITLE>Eine Klasse f&uuml;r sich - die .NET Zip Library</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="7 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="Das .NET Framework umfasst hunderte Klassen, doch etwas fehlt: es gibt keinerlei Klassen zur Komprimierung und Dekomprimierung von Zip Archiven. Diesem Fehlen kann aber mit der .NET Zip Library (SharpZipLib) abgeholfen werden.">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,Zip,Gzip,Inflate,Deflate,Komprimierung,Compression,.NET,source code,included,Klasse,Library,SharpZipLib,NZipLib">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff"  BACKGROUND="../images/layout/aspheutemainbg.gif" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<MAP NAME="titlebar">
<!--<AREA SHAPE=RECT COORDS="116,46,191,61" HREF="http://www.aspaktuell.com" ALT="ASP Aktuell">-->
<!--<AREA SHAPE=RECT COORDS="192,46,255,61" HREF="http://www.aspwelt.com" ALT="ASP Welt">-->
<AREA SHAPE=RECT COORDS="256,46,432,61" HREF="http://www.aspgerman.com/aspgerman/" ALT="ASP German">
<AREA SHAPE=RECT COORDS="115,15,269,42" HREF="../default.htm" ALT="Homepage">
<AREA SHAPE=RECT COORDS="278,26,587,42" HREF="../default.htm" ALT="Homepage">
</MAP>

<div style="position:absolute;left:0px;top:30px">
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td background="../images/layout/aspheutetitle.gif">
<img src="../images/layout/blind.gif" width="715" height="73" usemap="#titlebar" border="0">
</td>
<td width="100%" background="../images/layout/aspheutetitleext.gif">
&nbsp;
</td>
<td background="../images/layout/aspheutetitleend.gif">
<img src="../images/layout/blind.gif" width="25" height="1">
</td>
</tr>
</table>
</div>

<div style="position:absolute;left:1px;top:115px">
<table width="110" border="0" cellspacing="0" cellpadding="0">
<tr><td width="110"><img src="../Images/spacer.gif" width="110" height="1" alt="" border="0"></td></tr>
<tr>
<td background="../images/layout/aspheuteheader.gif" class="header" height=16 width="110">
<p>Liste</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">

<p class="content">
<a href="../kategorien/dotNET%202dot0.htm">.NET 2.0 (1)</a><br>
<a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein (16)</a><br>
<a href="../kategorien/dotNET%20Fu.htm">.NET Fu (5)</a><br>
<a href="../kategorien/ADOdotNET.htm">ADO.NET (11)</a><br>
<a href="../kategorien/Aprilscherz.htm">Aprilscherz (3)</a><br>
<a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen (44)</a><br>
<a href="../kategorien/ASP%20Tricks.htm">ASP Tricks (83)</a><br>
<a href="../kategorien/ASPdotNET.htm">ASP.NET (44)</a><br>
<a href="../kategorien/ASPIntranetdotde.htm">ASPIntranet.de (5)</a><br>
<a href="../kategorien/Csharp.htm">C# (28)</a><br>
<a href="../kategorien/Datenbank.htm">Datenbank (44)</a><br>
<a href="../kategorien/Dokumentation.htm">Dokumentation (4)</a><br>
<a href="../kategorien/IIS%206dot0.htm">IIS 6.0 (1)</a><br>
<a href="../kategorien/Komponenten.htm">Komponenten (29)</a><br>
<a href="../kategorien/Optimierung.htm">Optimierung (10)</a><br>
<a href="../kategorien/Server.htm">Server (21)</a><br>
<a href="../kategorien/Sicherheit.htm">Sicherheit (34)</a><br>
<a href="../kategorien/Tee%20Off.htm">Tee Off (6)</a><br>
<a href="../kategorien/VBdotNET.htm">VB.NET (6)</a><br>
<a href="../kategorien/WAP.htm">WAP (8)</a><br>
<a href="../kategorien/Web%20Services.htm">Web Services (11)</a><br>
<a href="../kategorien/XML.htm">XML (9)</a><br>


<br>
<a href="/syndication/rss.xml"><img src="../Images/rss_small.png" width="25" height="10" alt="RSS 2.0 - Die neuesten f&uuml;nf Artikel auf AspHeute.com" border="0"></a>

</p><!-- </p> remains -->


<br>

</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearch.gif" class="header" height=16 width="110">
<p>Suchen</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearchext.gif" class="header" width="110">
<form class="content" ACTION="REMOVED" METHOD="GET">
<div>
<input class="Newsletter" type="text" size="10" name="CiRestriction">
<span class="spacer2"><br></span>
<span class="spacer4"><br></span>
<INPUT TYPE="HIDDEN" NAME="CiMaxRecordsPerPage" VALUE="10">
<INPUT TYPE="HIDDEN" NAME="CiSort" VALUE="rank[d]">
<INPUT TYPE="HIDDEN" NAME="HTMLQueryForm" VALUE="../default.htm">
<img src="../images/layout/blind.gif" width="41" height="1"><input type="image" src="../images/layout/aspheutesearchenter.gif" border="0" width="49" height="14"><br>
<span class="spacer4"><br></span>
</div>
</form>
</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">
<p class="content">
<a href="/REMOVED/" title="Our most popular articles translated into English">English Articles</a><br>
<a href="/REMOVED/" title="Visit our Chinese content section">Chinese Articles</a><br>
<a href="../autoren/UnsereAutoren.htm" title="Unsere Autoren">Unsere Autoren</a><br>
&nbsp;<br>
<a href="/REMOVED/link2us.asp" title="Setzen Sie einen Link zu AspHeute!">Link zu AspHeute</a><br>
<a href="/REMOVED/impressum.asp" title="Das Impressum von AspHeute">Impressum</a><br>
<a href="/REMOVED/advertise.asp" title="Werben auch Sie auf AspHeute">Werben</a><br>
<a href="/REMOVED/kontakt.asp" title="Teilen Sie uns Ihre W&uuml;nsche, Beschwerden und Anregungen mit">Anfragen</a><br>
</p>
</td>
</tr>
</table>
</div>



<!-- Content starts here  -->
<div style="position:absolute;left:120px;top:108px">
<table cellspacing="0" cellpadding="0"><!--Tabelle aussen-->
<tr><!--Tabelle aussen, 1/2-->
<td><!--Tabelle aussen, 1/1-->
    <table border=0 align=center><tr><td align=center>


</td></tr></table>

<H1>Eine Klasse f&uuml;r sich - die .NET Zip Library</H1>
<p>
Geschrieben von: <a href="../autoren/christophwille.htm">Christoph Wille</a><br>
Kategorie: <a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20011115"></SCRIPT>
</p>
<p>
Das .NET Framework umfasst hunderte Klassen, doch etwas fehlt: es gibt keinerlei Klassen zur
Komprimierung und Dekomprimierung von Zip Archiven. Diesem Fehlen kann aber mit der .NET Zip Library (#ziplib)
abgeholfen werden - diese unterst&uuml;tzt sowohl das Zip als auch das GZip Format, ist gratis, und kommt
mit C# Code inklusive.
</p>

<p>
Die #ziplib (SharpZipLib, ehemals NZipLib) kann von <a href="http://www.icsharpcode.net/opensource/sharpziplib/" target="_blank">ic#code</a> downgeloadet werden.
Obwohl die Library selbst unter der GPL (GNU General Public License) vertrieben wird, darf man dank der
Ausnahme die Library in Nicht-GPL Programmen einsetzen.
</p>

<h2>Verwendung in ASP.NET</h2>
<p>
Die Library ist als <a href="http://www.icsharpcode.net/OpenSource/SharpZipLib/DownloadLatestVersion.asp?what=assembly">DLL Assembly</a> kompiliert, und ist im
verlinkten Download als Datei namens <b>SharpZipLib.dll</b> enthalten. Der erste Schritt ist also, sie in das <b>bin</b> Verzeichnis der 
Website zu verfrachten - dieser Vorgang wurde bereits im Artikel <a href="20010123.htm">Eine Eurokonvertierungskomponente in C# erstellen</a> beschrieben
</p>
<p>
Jetzt wo die Komponente dank <i>XCOPY Deployment</i> bereits registriert ist, kann sie auch schon
verwendet werden. Dazu habe ich eine kleine ASP.NET Seite geschrieben, die den Inhalt eines Zip
Archivs ausgibt: den Dateinamen, die Dateigr&ouml;&szlig;e, die komprimierte Gr&ouml;&szlig;e. Der Sourcecode ist im Download
des heutigen Artikels als <b>ListZipContent.aspx</b> enthalten:
</p>

<pre style="background='silver';">
&lt;% @Page Language= "C#" %&gt;
&lt;% @Import Namespace="System.IO" %&gt;
&lt;% @Import Namespace="System.Text" %&gt;
&lt;% @Import Namespace="ICSharpCode.SharpZipLib.Zip" %&gt;
&lt;%
ZipInputStream s = new ZipInputStream(File.OpenRead("c:\\test.zip"));
ZipEntry theEntry = null;
StringBuilder strOutput = new StringBuilder();

while ((theEntry = s.GetNextEntry()) != null) 
{
  strOutput.Append("&lt;tr&gt;&lt;td&gt;");
  strOutput.Append(theEntry.Name);
  strOutput.Append("&lt;/td&gt;&lt;td&gt;");
  strOutput.Append(theEntry.Size.ToString());
  strOutput.Append("&lt;/td&gt;&lt;td&gt;");
  strOutput.Append(theEntry.CompressedSize.ToString());
  strOutput.Append("&lt;/td&gt;&lt;/tr&gt;\r\n");
}

s.Close(); // clean up the file resource immediately
%&gt;

&lt;table&gt;
&lt;tr&gt;&lt;th&gt;File name&lt;/th&gt;&lt;th&gt;Actual Size&lt;/th&gt;&lt;th&gt;Compressed Size&lt;/th&gt;&lt;/tr&gt;
&lt;%
  Response.Write(strOutput.ToString());
%&gt;
&lt;/table&gt;
</pre>

<p>
Dieses Beispiel verwendet die Klassen aus dem <b>ICSharpCode.SharpZipLib.Zip</b> Namespace, deshalb mu&szlig; ein entsprechendes
<i>Import</i> Statement vorhanden sein. Eine genaue Beschreibung aller Namespaces und Klassen k&ouml;nnen
Sie in der Hilfedatei <b>Documentation.chm</b> finden. Diese Dokumentation ist &auml;hnlich
zur .NET Framework Reference aufgebaut, das navigieren sollte also kein Problem sein.
</p>
<p>
In obigem Beispiel verwende ich die <i>ZipInputStream</i> Klasse, um auf eine bereits existierende
(hardcodierte) Zip Datei zuzugreifen. Nach dem &Ouml;ffnen des Archivs laufe ich mittels einer <i>while</i>
Schleife alle Eintr&auml;ge (<i>ZipEntry</i> Klasse) durch, und puffere den generierten Tabelleninhalt in
einem <i>StringBuilder</i> Objekt (siehe auch Artikel <a href="20000803.htm">Die String Klasse in C#</a>).
</p>
<p>
Die Ausgabe sieht wenig aufregend so aus, ist aber Beweis, da&szlig; es funktioniert wie geplant:
</p>
<IMG SRC="Bilder/200111/20011115.png" width="400" height="227" alt="" border="0">

<h2>Dateien in Archiven betrachten</h2>
<p>
Jetzt haben wir eine Liste von Dateien - wie kommen wir aber an deren Inhalte? Sprich wie dekomprimieren
wir die einzelnen Dateien? Hierzu ein modifiziertes Beispiel, das an der Kommandozeile l&auml;uft
(<b>ViewZipFile.cs</b>):
</p>

<pre style="background='silver';">
using System;
using System.Text;
using System.IO;

using ICSharpCode.SharpZipLib.Zip;

class MainClass
{
  public static void Main(string[] args)
  {
    ZipInputStream s = new ZipInputStream(File.OpenRead(args[0]));
    ZipEntry theEntry;

    int nBytes = 2048;
    byte[] data = new byte[2048];

    while ((theEntry = s.GetNextEntry()) != null) 
    {
      Console.WriteLine(theEntry.Name);
      Console.Write("Eintrag anzeigen? (j/n)");

      if (Console.ReadLine() == "j") 
      {
        while((nBytes = s.Read(data, 0, data.Length))  &gt; 0)
        {
           Console.Write(new ASCIIEncoding().GetString(data,0,nBytes));
        }
      }
      Console.WriteLine();
    }
    s.Close();
  }
}
</pre>

<p>
Im Prinzip ist das Auslesen einer komprimierten Datei aus dem Zip Archiv nur der <i>Read</i> Befehl, den man von Streams
sowieso schon kennt. Wir verarbeiten die erhaltenen Daten so, da&szlig; wir sie mittels ASCII
Encoding an der Konsole ausgeben. Nat&uuml;rlich k&ouml;nnte man statt der Konvertierung die Daten in eine
Datei auf der Festplatte schreiben.
</p>

<p>
Kompiliert wird diese Anwendung wie folgt (Annahme: NZipLib.dll liegt im gleichen Verzeichnis):
</p>

<pre style="background='silver';">
csc /target:exe /reference:SharpZipLib.dll ViewZipFile.cs
</pre>

<p>
Der Aufruf erfolgt so:
</p>

<pre style="background='silver';">
viewzipfile c:\test.zip
</pre>

<p>
Und schon kann man sich die Dateien im Zip Archiv ansehen.
</p>

<h2>Zip Archive erstellen</h2>
<p>
Auslesen ist ja leicht! Und wie steht's mit dem Erstellen eines Zip Archivs? Nun, sehen wir uns
ein kleines Beispielprogramm an, das alle Dateien eines Unterverzeichnisses in eine Zip Datei
schreibt (<b>CreateZipFile</b>):
</p>

<pre style="background='silver';">
using System;
using System.IO;

using ICSharpCode.SharpZipLib.Zip;

class MainClass
{
  public static void Main(string[] args)
  {
    // alle Dateien im angegebenen Ordner werden komprimiert
    string[] aFilenames = Directory.GetFiles(args[0]);
    
    // der Name der Zipdatei ist der zweite Parameter im Aufruf
    ZipOutputStream s = new ZipOutputStream(File.Create(args[1]));
    
    // Komprimierungslevel setzen: 0 [keine] - 9 [st&auml;rkste]
    s.SetLevel(5); 
    
    for (int i=0; i &lt; aFilenames.Length; i++)
    {
      FileStream fs = File.OpenRead(aFilenames[i]);
      
      // im Normalfall allokiert man die Buffer im voraus
      // hier aus Klarheitsgr&uuml;nden pro Datei einmal
      byte[] buffer = new byte[fs.Length];
      fs.Read(buffer, 0, buffer.Length);

      // und jetzt schreiben wir einen ZipEntry &amp; die Daten      
      ZipEntry entry = new ZipEntry(aFilenames[i]);
      s.PutNextEntry(entry);
      s.Write(buffer, 0, buffer.Length);
    }
    
    s.Finish();
    s.Close();
  }
}
</pre>

<p>
Im Komprimierungsszenario arbeiten wir mit der <i>ZipOutputStream</i> Klasse, die uns bei der 
Erstellung des Archivs zur Seite steht. Im Prinzip ist alles ein umgekehrter Vorgang zum 
Entzippen: hier erstellen wir einen <i>ZipEntry</i>, und anstatt da&szlig; wir die Datei aus dem
Archiv auslesen, schreiben wir sie in das Archiv.
</p>

<p>
Verwendet wird das Programm wie folgt:
</p>

<pre style="background='silver';">
createzipfile c:\verzeichnis c:\zipfile.zip
</pre>

<p>
Ich denke da&szlig; das Erzeugen eines Archivs um nichts schwieriger ist als das Auslesen von Dateien
aus einem Archiv.
</p>

<h2>Schlu&szlig;bemerkung</h2>
<p>
Ich habe heute nur die Verwendung der Zip Klassen in der Library gezeigt. Allerdings werden die
GZip Klassen v&ouml;llig analog verwendet, da sie von denselben Basisklassen ableiten. Zip ahoi!
</p>
<h2>Download des Codes</h2>
<p><a href="../Code/20011115.zip">Klicken Sie hier</a>, um den Download zu starten.</p>
<h2>Verwandte Artikel</h2>
<p>
<a href="20000803.htm">Die String Klasse in C#</a><br>
<a href="20000804.htm">Directory Browsing a la .NET</a><br>
<a href="20010123.htm">Eine Eurokonvertierungskomponente in C# erstellen</a><br>

</p>
<h2>Links zu anderen Sites</h2>
<p>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Eicsharpcode%2Enet%2FOpenSource%2FSharpZipLib%2F">#ZipLib (SharpZipLib) Download</a><br>

</p>

<h2>Wenn Sie jetzt Fragen haben...</h2>
<p>
Wenn Sie Fragen rund um die in diesem Artikel vorgestellte Technologie haben, dann schauen Sie einfach bei uns
in den <a href="http://glengamoi.com/forums/">Community Foren der deutschen .NET Community</a> vorbei. Die Teilnehmer 
helfen Ihnen gerne, wenn Sie sich zur im Artikel vorgestellten Technologie weiterbilden m&ouml;chten.
</p>

<p>
<a href="http://glengamoi.com/forums/"><img src="../images/glengamoi.com_250.gif" width="250" height="80" alt="" border="0"></a>
</p>


<p>
Eine weitere sehr hilfreiche Resource ist das <a href="http://aspxfiles.com/">deutsche ASP.NET Wiki</a>,
das als zentrale Anlaufstelle f&uuml;r Tips, Tricks, Know How und alles N&uuml;tzliche was man in seinem Alltag als 
(ASP).NET-Entwickler so braucht und entdeckt gedacht ist. 
</p>

<p>
Haben Sie Fragen die sich direkt auf den Inhalt des Artikels beziehen, dann schreiben Sie dem Autor! Unsere Autoren
freuen sich &uuml;ber Feedback zu ihren Artikeln. Ein einfacher Klick auf die <i>Autor kontaktieren</i>
Schaltfl&auml;che (weiter unten) und schon haben Sie ein f&uuml;r diesen Artikel personalisiertes Anfrageformular.
</p>

<p>&nbsp;</p>
<p>
Und zu guter Letzt m&ouml;chten wir Sie bitten, den Artikel zu bewerten. Damit helfen Sie uns, 
die Qualit&auml;t der Artikel zu verbessern - und anderen Lesern bei der Auswahl der Artikel,
die sie lesen sollten.
</p>

<FORM METHOD="POST" STYLE="margin-bottom: 0px;" NAME="formRating" ACTION="/service/bewerten.asp">
<INPUT TYPE="HIDDEN" NAME="ArticleId" VALUE="20011115" />
<CENTER>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
	<TD ALIGN="CENTER" VALIGN="MIDDLE" COLSPAN="7">Bewerten Sie diesen Artikel</TD>
</TR>
<TR>
	<TD><EM>&nbsp;Sehr gut&nbsp;</EM></TD>
	<TD><INPUT TYPE="radio" value="1" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="2" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="3" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="4" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="5" NAME="radioRating" /></TD>
	<TD ALIGN="right"><EM>&nbsp;Nicht gen&uuml;gend</EM></TD>
	<TD ROWSPAN="2" VALIGN="middle">&nbsp;<INPUT TYPE="submit" VALUE="Werten!" /></TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD ALIGN="CENTER">&nbsp;1</TD>
	<TD ALIGN="CENTER">&nbsp;2</TD>
	<TD ALIGN="CENTER">&nbsp;3</TD>
	<TD ALIGN="CENTER">&nbsp;4</TD>
	<TD ALIGN="CENTER">&nbsp;5</TD>
	<TD>&nbsp;</TD>
</TR>
</TABLE>
</FORM>
</center>
&nbsp;<P>
<center>
<p><table><tr><td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="pagetitle" value="Eine Klasse f&uuml;r sich - die .NET Zip Library"><input type="hidden" name="pageurl" value="http://www.aspheute.com/artikel/20011115.htm"><input type="image" src="../images/layout/senden.png" width="107" height="20" border="0" alt="Schicken Sie diese Seite einem Freund!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="Author" value="Christoph Wille"><input type="hidden" name="AuthorEmail" value="christophw@alphasierrapapa.com"><input type="hidden" name="Artikel" value="20011115"><input type="image" src="../images/layout/kontakt.png" width="107" height="20" border="0" alt="Kontaktieren Sie den Autor!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top><a href="../PrinterFriendly/20011115.htm"><img src="../images/layout/druck.png" width="118" height="20" border="0" alt="F&uuml;r Ausdruck optimierte Seite"></a></td>
</tr></table></p>
</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
