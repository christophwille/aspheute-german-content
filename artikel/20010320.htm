<HTML>
<HEAD>
<TITLE>In VB Komponenten auf ASP Objekte zugreifen (Variante 1)</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="7 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="Wie aus dem Titel ersichtlich ist, kann man aus Komponenten generell auf mehrere Arten und Weisen auf die ASP Objekte wie Request oder Response zugreifen. Heute bespreche ich den Einsatz der Page-Level Event Methoden...">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,Page-Level,OnStartPage,OnEndPage,ScriptingContext,IScriptingContext,MTS,event methods,Response,Request,Server,Komponente,Visual Basic">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff"  BACKGROUND="../images/layout/aspheutemainbg.gif" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<MAP NAME="titlebar">
<!--<AREA SHAPE=RECT COORDS="116,46,191,61" HREF="http://www.aspaktuell.com" ALT="ASP Aktuell">-->
<!--<AREA SHAPE=RECT COORDS="192,46,255,61" HREF="http://www.aspwelt.com" ALT="ASP Welt">-->
<AREA SHAPE=RECT COORDS="256,46,432,61" HREF="http://www.aspgerman.com/aspgerman/" ALT="ASP German">
<AREA SHAPE=RECT COORDS="115,15,269,42" HREF="../default.htm" ALT="Homepage">
<AREA SHAPE=RECT COORDS="278,26,587,42" HREF="../default.htm" ALT="Homepage">
</MAP>

<div style="position:absolute;left:0px;top:30px">
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td background="../images/layout/aspheutetitle.gif">
<img src="../images/layout/blind.gif" width="715" height="73" usemap="#titlebar" border="0">
</td>
<td width="100%" background="../images/layout/aspheutetitleext.gif">
&nbsp;
</td>
<td background="../images/layout/aspheutetitleend.gif">
<img src="../images/layout/blind.gif" width="25" height="1">
</td>
</tr>
</table>
</div>

<div style="position:absolute;left:1px;top:115px">
<table width="110" border="0" cellspacing="0" cellpadding="0">
<tr><td width="110"><img src="../Images/spacer.gif" width="110" height="1" alt="" border="0"></td></tr>
<tr>
<td background="../images/layout/aspheuteheader.gif" class="header" height=16 width="110">
<p>Liste</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">

<p class="content">
<a href="../kategorien/dotNET%202dot0.htm">.NET 2.0 (1)</a><br>
<a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein (16)</a><br>
<a href="../kategorien/dotNET%20Fu.htm">.NET Fu (5)</a><br>
<a href="../kategorien/ADOdotNET.htm">ADO.NET (11)</a><br>
<a href="../kategorien/Aprilscherz.htm">Aprilscherz (3)</a><br>
<a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen (44)</a><br>
<a href="../kategorien/ASP%20Tricks.htm">ASP Tricks (83)</a><br>
<a href="../kategorien/ASPdotNET.htm">ASP.NET (44)</a><br>
<a href="../kategorien/ASPIntranetdotde.htm">ASPIntranet.de (5)</a><br>
<a href="../kategorien/Csharp.htm">C# (28)</a><br>
<a href="../kategorien/Datenbank.htm">Datenbank (44)</a><br>
<a href="../kategorien/Dokumentation.htm">Dokumentation (4)</a><br>
<a href="../kategorien/IIS%206dot0.htm">IIS 6.0 (1)</a><br>
<a href="../kategorien/Komponenten.htm">Komponenten (29)</a><br>
<a href="../kategorien/Optimierung.htm">Optimierung (10)</a><br>
<a href="../kategorien/Server.htm">Server (21)</a><br>
<a href="../kategorien/Sicherheit.htm">Sicherheit (34)</a><br>
<a href="../kategorien/Tee%20Off.htm">Tee Off (6)</a><br>
<a href="../kategorien/VBdotNET.htm">VB.NET (6)</a><br>
<a href="../kategorien/WAP.htm">WAP (8)</a><br>
<a href="../kategorien/Web%20Services.htm">Web Services (11)</a><br>
<a href="../kategorien/XML.htm">XML (9)</a><br>


<br>
<a href="/syndication/rss.xml"><img src="../Images/rss_small.png" width="25" height="10" alt="RSS 2.0 - Die neuesten f&uuml;nf Artikel auf AspHeute.com" border="0"></a>

</p><!-- </p> remains -->


<br>

</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearch.gif" class="header" height=16 width="110">
<p>Suchen</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearchext.gif" class="header" width="110">
<form class="content" ACTION="REMOVED" METHOD="GET">
<div>
<input class="Newsletter" type="text" size="10" name="CiRestriction">
<span class="spacer2"><br></span>
<span class="spacer4"><br></span>
<INPUT TYPE="HIDDEN" NAME="CiMaxRecordsPerPage" VALUE="10">
<INPUT TYPE="HIDDEN" NAME="CiSort" VALUE="rank[d]">
<INPUT TYPE="HIDDEN" NAME="HTMLQueryForm" VALUE="../default.htm">
<img src="../images/layout/blind.gif" width="41" height="1"><input type="image" src="../images/layout/aspheutesearchenter.gif" border="0" width="49" height="14"><br>
<span class="spacer4"><br></span>
</div>
</form>
</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">
<p class="content">
<a href="/REMOVED/" title="Our most popular articles translated into English">English Articles</a><br>
<a href="/REMOVED/" title="Visit our Chinese content section">Chinese Articles</a><br>
<a href="../autoren/UnsereAutoren.htm" title="Unsere Autoren">Unsere Autoren</a><br>
&nbsp;<br>
<a href="/REMOVED/link2us.asp" title="Setzen Sie einen Link zu AspHeute!">Link zu AspHeute</a><br>
<a href="/REMOVED/impressum.asp" title="Das Impressum von AspHeute">Impressum</a><br>
<a href="/REMOVED/advertise.asp" title="Werben auch Sie auf AspHeute">Werben</a><br>
<a href="/REMOVED/kontakt.asp" title="Teilen Sie uns Ihre W&uuml;nsche, Beschwerden und Anregungen mit">Anfragen</a><br>
</p>
</td>
</tr>
</table>
</div>



<!-- Content starts here  -->
<div style="position:absolute;left:120px;top:108px">
<table cellspacing="0" cellpadding="0"><!--Tabelle aussen-->
<tr><!--Tabelle aussen, 1/2-->
<td><!--Tabelle aussen, 1/1-->
    <table border=0 align=center><tr><td align=center>


</td></tr></table>

<H1>In VB Komponenten auf ASP Objekte zugreifen (Variante 1)</H1>
<p>
Geschrieben von: <a href="../autoren/christophwille.htm">Christoph Wille</a><br>
Kategorie: <a href="../kategorien/Komponenten.htm">Komponenten</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20010320"></SCRIPT>
</p>
<p>
Wie aus dem Titel ersichtlich ist, kann man aus Komponenten generell (und im heutigen Artikel
Visual Basic im speziellen) auf mehrere Arten und Weisen auf die ASP Objekte wie Request oder Response
zugreifen. Heute bespreche ich den Einsatz der Page-Level Event Methoden, ein weiterer Artikel wird sich
dann mit der moderneren Methode des ObjectContexts auseinandersetzen.
</p>
<p>
Die angesprochenen Page-Level Event Methoden sind <i>OnStartPage</i> und <i>OnEndPage</i>. Wie aus den
Namen bereits hervorgeht, wird die erstere aufgerufen wenn die Bearbeitung der ASP Seite beginnt, und
die letztere wenn alle Scriptbl&ouml;cke zu laufen aufgeh&ouml;rt haben. An <i>OnStartPage</i> wird ein Objekt
namens <i>ScriptingContext</i> &uuml;bergeben, aus dem man die ASP Objekte "extrahieren" - und ab dann
genauso wie in ASP mit VBScript verwenden kann. <i>OnEndPage</i> dient haupts&auml;chlich zum CleanUp und
kann optional implementiert werden.
</p>

<h2>Eine Hello World Komponente erstellen</h2>
<p>
Wieder einmal ist "Hello World!" das Opfer unserer ersten Gehversuche am Weg zur ersten eigenen 
Komponente. Diese wird eine simple Methode namens <i>SayHello</i> haben, um den Zugriff auf die
ASP Objekte zu verdeutlichen (ohne durch zuviel an Funktionalit&auml;t den Blick auf das wichtige zu
verstellen).
</p>

<p>
Zuallererst m&uuml;ssen wir uns ein Projekt in Visual Basic erstellen:
</p>

<IMG SRC="Bilder/200103/20010320_01.png" width="446" height="426" alt="" border="0">

<p>
Durch Auswahl des Projekttyps <b>ActiveX DLL</b> wird ein Projekt plus einer leeren Klasse f&uuml;r
uns erzeugt, was bereits f&uuml;r unsere Zwecke mehr als ausreicht. Benennen Sie das Projekt auf <b>AspHeute</b>,
und die Klasse auf <b>DemoComponent</b> um.
</p>

<p>
Da wir auf ASP Objekte zugreifen, m&uuml;ssen wir unserem VB Projekt sagen, wie diese definiert sind - dies
geschieht indem man einen Verweis auf die Typenbibliothek von ASP legt (Men&uuml; Project/References):
</p>

<IMG SRC="Bilder/200103/20010320_02.png" width="449" height="357" alt="" border="0">

<p>
Nun sind wir sozusagen "all set" und k&ouml;nnen zum Code schreiben anfangen. Das nachfolgende Listing
zeigt alle ben&ouml;tigten Zeilen unserer Hello World Komponente (im Klassenmodul von <i>DemoComponent</i>
einf&uuml;gen):
</p>

<pre style="background='silver';">
Dim objResponse As ASPTypeLibrary.Response

Public Sub OnStartPage(sc As ScriptingContext)
  Set objResponse = sc.Response
End Sub

Public Sub SayHello()
  objResponse.Write "Hello World"
End Sub
</pre>

<p>
Da die Komponente einfach gehalten ist, sticht der Infrastrukturcode in <i>OnStartPage</i> deutlich
heraus. Diese Funktion wird bei der Instanzierung des Objekts aufgerufen, und referenziert aus dem
<i>ScriptingContext</i> das <i>Response</i> Objekt (erspart sp&auml;ter Zugriffe auf diese Eigenschaft und ist somit
schneller). <i>SayHello</i> bedient sich dann der Variable <i>objResponse</i>, um auf das ASP <i>Response</i>
Objekt durchzugreifen - alle anderen Objekte w&uuml;rden auch funktionieren (aber eines mu&szlig;te ich mir 
herauspicken).
</p>

<p>
Im Editor sieht das dann wie folgt aus:
</p>

<IMG SRC="Bilder/200103/20010320_03.png" width="704" height="534" alt="" border="0">

<p>
Bevor wir das Projekt kompilieren, g&ouml;nnen wir uns noch einen kleinen "Luxus", und deklarieren die
Komponente korrekt f&uuml;r <i>Unattended Execution</i> (Men&uuml; Project/Properties):
</p>

<IMG SRC="Bilder/200103/20010320_04.png" width="418" height="377" alt="" border="0">

<p>
Diese Einstellung ist f&uuml;r Serverkomponenten extrem wichtig, da somit unsichtbare, nicht-anklickbare
Fehlerdialogboxen vollst&auml;ndig unterbunden werden. Ohne dieser Einstellung kann man schon mal den IIS
"einfrieren" (diesen Zustand kann man unter IIS5 mit <i>iisreset.exe /restart</i> beheben, IIS4 hat leider
kein vergleichbares Utility).
</p>

<p>
Die Komponente ist fertig - was fehlt ist nur der Aufruf von <i>File/Make AspHeute.dll</i> und die
nachfolgende Registrierung mit <i>regsvr32.exe aspheute.dll</i> - und schon ist die Komponente 
einsatzbereit.
</p>

<h2>Die Komponente verwenden</h2>
<p>
Der einfachste Code zur Verwendung unserer neuen Komponente braucht nur zwei Zeilen lang zu sein -
die Instanzierung und der Aufruf der <i>SayHello</i> Methode:
</p>

<pre style="background='silver';">
Set xObj = CreateObject("AspHeute.DemoComponent")
xObj.SayHello
</pre>

<p>
Wenn man diese Seite aufruft, bekommt man allerdings eine Fehlermeldung die irritierend sein k&ouml;nnte:
</p>

<pre style="background='silver';">
AspHeute error '800a005b' 
Object variable or With block variable not set 
/aspheute/oldcomponent/sonicht.asp, line 3 
</pre>

<p>
Dieser Fehler kommt aus der <i>SayHello</i> Funktion - da VBScript's <i>CreateObject</i> die
<i>OnStartPage</i> Methode nicht aufruft, ist die Variable <i>objResponse</i> nicht gesetzt.
Dieser Fehler kann einem auch bei kommerziellen Komponenten passieren, die die <i>OnStartPage</i>
Methode verwenden!
</p>

<p>
Um diese Fehlermeldung zu umgehen, mu&szlig; man Objekte, die eine <i>OnStartPage</i> Methode haben, mittels
<i>Server.CreateObject</i> instanzieren - weil nur <i>Server.CreateObject</i> die Page-Level Event
Methoden aufruft. Da <i>Server.CreateObject</i> sowieso schneller ist als <i>CreateObject</i>,
gibt es eigentlich eh' keinen Grund, dies nicht zu machen (<b>korrekt.asp</b>):
</p>

<pre style="background='silver';">
Set xObj = Server.CreateObject("AspHeute.DemoComponent")
xObj.SayHello
</pre>

<p>
Die Response an den Client ist "Hello World", was beweist, da&szlig; unsere kleine Komponente brav ihren
Dienst verrichtet.
</p>

<h2>Schlu&szlig;bemerkung</h2>
<p>
Wir haben heute eine kleine Komponente erstellt, die sich der Page-Level Event Methoden bedient.
Aus Gr&uuml;nden der Performance soll man diese Variante aber nicht mehr exzessiv verwenden - und
statt dessen den <i>ObjectContext</i>. Aber das ist ein anderes Thema (eines weiteren Artikels).
</p>
<h2>Download des Codes</h2>
<p><a href="../Code/20010320.zip">Klicken Sie hier</a>, um den Download zu starten.</p>
<h2>Verwandte Artikel</h2>
<p>
<a href="20010322.htm">In VB Komponenten auf ASP Objekte zugreifen (Variante 2)</a><br>
<a href="20020408.htm">Klassenauflistungen mit dem Dictionary-Objekt</a><br>

</p>

<h2>Wenn Sie jetzt Fragen haben...</h2>
<p>
Wenn Sie Fragen rund um die in diesem Artikel vorgestellte Technologie haben, dann schauen Sie einfach bei uns
in den <a href="http://glengamoi.com/forums/">Community Foren der deutschen .NET Community</a> vorbei. Die Teilnehmer 
helfen Ihnen gerne, wenn Sie sich zur im Artikel vorgestellten Technologie weiterbilden m&ouml;chten.
</p>

<p>
<a href="http://glengamoi.com/forums/"><img src="../images/glengamoi.com_250.gif" width="250" height="80" alt="" border="0"></a>
</p>


<p>
Haben Sie Fragen die sich direkt auf den Inhalt des Artikels beziehen, dann schreiben Sie dem Autor! Unsere Autoren
freuen sich &uuml;ber Feedback zu ihren Artikeln. Ein einfacher Klick auf die <i>Autor kontaktieren</i>
Schaltfl&auml;che (weiter unten) und schon haben Sie ein f&uuml;r diesen Artikel personalisiertes Anfrageformular.
</p>

<p>&nbsp;</p>
<p>
Und zu guter Letzt m&ouml;chten wir Sie bitten, den Artikel zu bewerten. Damit helfen Sie uns, 
die Qualit&auml;t der Artikel zu verbessern - und anderen Lesern bei der Auswahl der Artikel,
die sie lesen sollten.
</p>

<FORM METHOD="POST" STYLE="margin-bottom: 0px;" NAME="formRating" ACTION="/service/bewerten.asp">
<INPUT TYPE="HIDDEN" NAME="ArticleId" VALUE="20010320" />
<CENTER>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
	<TD ALIGN="CENTER" VALIGN="MIDDLE" COLSPAN="7">Bewerten Sie diesen Artikel</TD>
</TR>
<TR>
	<TD><EM>&nbsp;Sehr gut&nbsp;</EM></TD>
	<TD><INPUT TYPE="radio" value="1" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="2" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="3" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="4" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="5" NAME="radioRating" /></TD>
	<TD ALIGN="right"><EM>&nbsp;Nicht gen&uuml;gend</EM></TD>
	<TD ROWSPAN="2" VALIGN="middle">&nbsp;<INPUT TYPE="submit" VALUE="Werten!" /></TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD ALIGN="CENTER">&nbsp;1</TD>
	<TD ALIGN="CENTER">&nbsp;2</TD>
	<TD ALIGN="CENTER">&nbsp;3</TD>
	<TD ALIGN="CENTER">&nbsp;4</TD>
	<TD ALIGN="CENTER">&nbsp;5</TD>
	<TD>&nbsp;</TD>
</TR>
</TABLE>
</FORM>
</center>
&nbsp;<P>
<center>
<p><table><tr><td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="pagetitle" value="In VB Komponenten auf ASP Objekte zugreifen (Variante 1)"><input type="hidden" name="pageurl" value="http://www.aspheute.com/artikel/20010320.htm"><input type="image" src="../images/layout/senden.png" width="107" height="20" border="0" alt="Schicken Sie diese Seite einem Freund!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="Author" value="Christoph Wille"><input type="hidden" name="AuthorEmail" value="christophw@alphasierrapapa.com"><input type="hidden" name="Artikel" value="20010320"><input type="image" src="../images/layout/kontakt.png" width="107" height="20" border="0" alt="Kontaktieren Sie den Autor!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top><a href="../PrinterFriendly/20010320.htm"><img src="../images/layout/druck.png" width="118" height="20" border="0" alt="F&uuml;r Ausdruck optimierte Seite"></a></td>
</tr></table></p>
</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
