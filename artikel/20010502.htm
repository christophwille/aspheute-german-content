<HTML>
<HEAD>
<TITLE>Logfiles mit Access auswerten</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="7 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="Das Auswerten von Logdateien ist eine wichtige Angelegenheit - man erf&auml;hrt nicht nur, woran die Kunden am meisten interessiert sind, sondern auch, wo sich Fehler in einer Website eingeschlichen haben.">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,Logfile,Logdatei,Statistik,Webserverstatistik,Statistikauswertung,Logfileauswertung,Logauswertung,Access">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff"  BACKGROUND="../images/layout/aspheutemainbg.gif" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<MAP NAME="titlebar">
<!--<AREA SHAPE=RECT COORDS="116,46,191,61" HREF="http://www.aspaktuell.com" ALT="ASP Aktuell">-->
<!--<AREA SHAPE=RECT COORDS="192,46,255,61" HREF="http://www.aspwelt.com" ALT="ASP Welt">-->
<AREA SHAPE=RECT COORDS="256,46,432,61" HREF="http://www.aspgerman.com/aspgerman/" ALT="ASP German">
<AREA SHAPE=RECT COORDS="115,15,269,42" HREF="../default.htm" ALT="Homepage">
<AREA SHAPE=RECT COORDS="278,26,587,42" HREF="../default.htm" ALT="Homepage">
</MAP>

<div style="position:absolute;left:0px;top:30px">
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td background="../images/layout/aspheutetitle.gif">
<img src="../images/layout/blind.gif" width="715" height="73" usemap="#titlebar" border="0">
</td>
<td width="100%" background="../images/layout/aspheutetitleext.gif">
&nbsp;
</td>
<td background="../images/layout/aspheutetitleend.gif">
<img src="../images/layout/blind.gif" width="25" height="1">
</td>
</tr>
</table>
</div>

<div style="position:absolute;left:1px;top:115px">
<table width="110" border="0" cellspacing="0" cellpadding="0">
<tr><td width="110"><img src="../Images/spacer.gif" width="110" height="1" alt="" border="0"></td></tr>
<tr>
<td background="../images/layout/aspheuteheader.gif" class="header" height=16 width="110">
<p>Liste</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">

<p class="content">
<a href="../kategorien/dotNET%202dot0.htm">.NET 2.0 (1)</a><br>
<a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein (16)</a><br>
<a href="../kategorien/dotNET%20Fu.htm">.NET Fu (5)</a><br>
<a href="../kategorien/ADOdotNET.htm">ADO.NET (11)</a><br>
<a href="../kategorien/Aprilscherz.htm">Aprilscherz (3)</a><br>
<a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen (44)</a><br>
<a href="../kategorien/ASP%20Tricks.htm">ASP Tricks (83)</a><br>
<a href="../kategorien/ASPdotNET.htm">ASP.NET (44)</a><br>
<a href="../kategorien/ASPIntranetdotde.htm">ASPIntranet.de (5)</a><br>
<a href="../kategorien/Csharp.htm">C# (28)</a><br>
<a href="../kategorien/Datenbank.htm">Datenbank (44)</a><br>
<a href="../kategorien/Dokumentation.htm">Dokumentation (4)</a><br>
<a href="../kategorien/IIS%206dot0.htm">IIS 6.0 (1)</a><br>
<a href="../kategorien/Komponenten.htm">Komponenten (29)</a><br>
<a href="../kategorien/Optimierung.htm">Optimierung (10)</a><br>
<a href="../kategorien/Server.htm">Server (21)</a><br>
<a href="../kategorien/Sicherheit.htm">Sicherheit (34)</a><br>
<a href="../kategorien/Tee%20Off.htm">Tee Off (6)</a><br>
<a href="../kategorien/VBdotNET.htm">VB.NET (6)</a><br>
<a href="../kategorien/WAP.htm">WAP (8)</a><br>
<a href="../kategorien/Web%20Services.htm">Web Services (11)</a><br>
<a href="../kategorien/XML.htm">XML (9)</a><br>


<br>
<a href="/syndication/rss.xml"><img src="../Images/rss_small.png" width="25" height="10" alt="RSS 2.0 - Die neuesten f&uuml;nf Artikel auf AspHeute.com" border="0"></a>

</p><!-- </p> remains -->


<br>

</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearch.gif" class="header" height=16 width="110">
<p>Suchen</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearchext.gif" class="header" width="110">
<form class="content" ACTION="REMOVED" METHOD="GET">
<div>
<input class="Newsletter" type="text" size="10" name="CiRestriction">
<span class="spacer2"><br></span>
<span class="spacer4"><br></span>
<INPUT TYPE="HIDDEN" NAME="CiMaxRecordsPerPage" VALUE="10">
<INPUT TYPE="HIDDEN" NAME="CiSort" VALUE="rank[d]">
<INPUT TYPE="HIDDEN" NAME="HTMLQueryForm" VALUE="../default.htm">
<img src="../images/layout/blind.gif" width="41" height="1"><input type="image" src="../images/layout/aspheutesearchenter.gif" border="0" width="49" height="14"><br>
<span class="spacer4"><br></span>
</div>
</form>
</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">
<p class="content">
<a href="/REMOVED/" title="Our most popular articles translated into English">English Articles</a><br>
<a href="/REMOVED/" title="Visit our Chinese content section">Chinese Articles</a><br>
<a href="../autoren/UnsereAutoren.htm" title="Unsere Autoren">Unsere Autoren</a><br>
&nbsp;<br>
<a href="/REMOVED/link2us.asp" title="Setzen Sie einen Link zu AspHeute!">Link zu AspHeute</a><br>
<a href="/REMOVED/impressum.asp" title="Das Impressum von AspHeute">Impressum</a><br>
<a href="/REMOVED/advertise.asp" title="Werben auch Sie auf AspHeute">Werben</a><br>
<a href="/REMOVED/kontakt.asp" title="Teilen Sie uns Ihre W&uuml;nsche, Beschwerden und Anregungen mit">Anfragen</a><br>
</p>
</td>
</tr>
</table>
</div>



<!-- Content starts here  -->
<div style="position:absolute;left:120px;top:108px">
<table cellspacing="0" cellpadding="0"><!--Tabelle aussen-->
<tr><!--Tabelle aussen, 1/2-->
<td><!--Tabelle aussen, 1/1-->
    <table border=0 align=center><tr><td align=center>


</td></tr></table>

<H1>Logfiles mit Access auswerten</H1>
<p>
Geschrieben von: <a href="../autoren/christophwille.htm">Christoph Wille</a><br>
Kategorie: <a href="../kategorien/Server.htm">Server</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20010502"></SCRIPT>
</p>
<p>
Das Auswerten von Logdateien ist eine wichtige Angelegenheit - man erf&auml;hrt nicht nur,
woran die Kunden am meisten interessiert sind, sondern auch, wo sich Fehler in einer
Website eingeschlichen haben als auch ob jemand versucht hat, die Website zu cracken.
Es gibt sehr viel hervorragende Reportingsoftware (einige Links am Ende des Artikels),
die aber die ad hoc Abfragem&ouml;glichkeit einer Datenbank vermissen lassen.
</p>

<p>
Unter ad hoc verstehe ich, da&szlig; ich auf spezielle Bereiche "hineinzoomen" kann - und das
mit der gesamten Power, die mir SQL an die Hand gibt. Klarerweise mu&szlig; ich die Logfiles
in eine Datenbank importieren, um mit SQL darauf zugreifen zu k&ouml;nnen. Als Einstieg in
das Auswerten per Datenbank kann man Access verwenden - wird die Menge der Eintr&auml;ge
allerdings gro&szlig;, sollte man auf SQL Server umsatteln.
</p>

<p>
Die Frage des Imports habe ich h&auml;ndisch gecodet, da Access gewisse "Schw&auml;chen" bei
gro&szlig;en Import-Datenmengen mit potentiell fehlerhaften Zeilen hat. Allerdings - und das
aus Faulheitsgr&uuml;nden - habe ich ein Log mit nur einer einzigen Zeile importiert, um automatisch die 
Tabelle <b>Logs</b> anhand meiner Logfilefelder zu generieren, die da w&auml;ren: <i>
date, 
time, 
c-ip, 
cs-username, 
s-sitename, 
s-computername, 
s-ip cs-method, 
cs-uri-stem, 
cs-uri-query, 
sc-status, 
sc-win32-status, 
sc-bytes, 
cs-bytes, 
time-taken, 
s-port, 
cs-version, 
cs(User-Agent),
cs(Cookie),
cs(Referer)
</i>.
</p>

<p>
Es ist durchaus sehr wahrscheinlich, da&szlig; Ihre Logfiles andere Felder beinhalten. Die Beispieldatenbank
<b>blank.mdb</b> enth&auml;lt jedenfalls eine Tabelle, die dem obigen Logfileformat entspricht, sowie
eine kleine VBA Methode, die uns den Import korrekt formatierter Logdateien erlaubt:
</p>

<pre style="background='silver';">
Sub ImportLog(ByVal strLogfile As String)
    Dim fs As Scripting.FileSystemObject, f As Scripting.TextStream
    Dim strContent As String, arrStrings As Variant, i As Long
    Dim db As DAO.Database, rs As DAO.Recordset
    
    Set fs = New Scripting.FileSystemObject
    Set f = fs.OpenTextFile(strLogfile, ForReading, False)
    
    Set db = CurrentDb()
    Set rs = db.OpenRecordset("Logs")
    
    Do While f.AtEndOfStream &lt;&gt; True
        strContent = f.ReadLine()
        arrStrings = Split(strContent, " ")
        If UBound(arrStrings) = 19 Then
            If IsDate(arrStrings(0)) Then
              rs.AddNew
                For i = 0 To UBound(arrStrings)
                    rs.Fields(i + 1).Value = Left(arrStrings(i), 255)
                Next
              rs.Update
            End If
        Else
            ' line does not fit our log file format
        End If
    Loop
    
    f.Close
    Set f = Nothing
    Set fs = Nothing
End Sub
</pre>

<p>
Der Aufruf ist einfach mit <i>ImportLog "logfile.txt"</i>, und kann in ein nettes
Eingabeformular eingebaut werden - auf das ich verzichtet habe. Der Code selbst ist
nur Auslesen einer Datei mit dem FileSystemObject und Eintragen der Daten in die 
Datenbank via DAO 3.6. Ich habe einige wenige Datenintegrit&auml;tschecks eingebaut, wie zB
da&szlig; ich eine gewisse Anzahl von Spalten im Logfile erwarte, sowie da&szlig; die erste Spalte
ein Datum ist.
</p>

<p>
Damit kann man nun alle Logfiles in die Datenbank importieren, und man hat - nichts. Gut,
einen riesengro&szlig;en Datenfriedhof, der ohne weitere Analyse klarerweise v&ouml;llig umsonst angelegt
wurde. Aber das wollen wir nun &auml;ndern.
</p>

<p>
Ich m&ouml;chte mir exemplarisch einige Szenarien herausgreifen. Das erste? Ich will wissen,
welche Aufrufe nicht erfolgreich waren, also 404er Fehler ausgel&ouml;st haben. Dazu &ouml;ffne
ich den Query Designer, und baue mir folgende Abfrage:
</p>

<IMG SRC="Bilder/200105/20010502_1.png" width="448" height="306" alt="" border="0">

<p>
Ich bekomme nun eine Liste aller Seiten, die einen 404er HTTP Status ausgel&ouml;st haben. Was ich
noch nicht wei&szlig; ist, wie oft. Alles was ich tun mu&szlig; ist ein Count Feld hinzuzuf&uuml;gen:
</p>

<IMG SRC="Bilder/200105/20010502_3.png" width="456" height="305" alt="" border="0">

<p>
Jetzt wei&szlig; ich, wie oft eine bestimmte Seite nicht gefunden wurde - und kann mittels
dem <i>cs(Referer)</i> Feld auf die Suche gehen, woher die Leute auf diese Seite gelangen - und
somit die Site f&uuml;r die User verbessern.
</p>

<p>
Ein weiterer Anwendungsfall w&auml;re es, sich die Aufrufsh&auml;ufigkeit bestimmter Seiten
anzeigen zu lassen. Dies kann zwar auch jede Reportingsoftware, aber wir k&ouml;nnen hier
und da etwas f&uuml;rs Auge tun:
</p>

<IMG SRC="Bilder/200105/20010502_2.png" width="563" height="324" alt="" border="0">

<p>
Das waren jetzt zwei anhand von SQL gezeigte Beispiele - Anwendungsf&auml;lle gibt es viel
mehr, rangierend vom Aufsp&uuml;ren von 500er Fehlern (ASP Engine) bis hin zum Tracken von
Hackern basierend auf speziellen 404er Fehlern. SQL ist leistungsf&auml;hig, und die Logfiles
ein "Quell" von wichtigen Informationen &uuml;ber Kunden, Hacker und Spider (gerade die!).
</p>

<h2>Schlu&szlig;bemerkung</h2>
<p>
Es waren heute nur Beispielauswertungen - man kann die Datenbank mit den Reportingf&auml;higkeiten
von Access sogar zu einem tollen Website-Statistiktool ausbauen.
</p>
<h2>Download des Codes</h2>
<p><a href="../Code/20010502.zip">Klicken Sie hier</a>, um den Download zu starten.</p>
<h2>Verwandte Artikel</h2>
<p>
<a href="20010517.htm">Gratis Loganalyse mit Analog</a><br>
<a href="20011204.htm">IIS, was machst du gerade?</a><br>
<a href="20000530.htm">Lesen von Textdateien</a><br>
<a href="20021030.htm">Logfiles auswerten mit Webalizer</a><br>

</p>
<h2>Links zu anderen Sites</h2>
<p>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Emediahouse%2Ecom%2Fstatisticsserver%2F">MediaHouse Statistics Server</a><br>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Ewebtrends%2Ecom%2F">WebTrends</a><br>

</p>

<h2>Wenn Sie jetzt Fragen haben...</h2>
<p>
Wenn Sie Fragen rund um die in diesem Artikel vorgestellte Technologie haben, dann schauen Sie einfach bei uns
in den <a href="http://glengamoi.com/forums/">Community Foren der deutschen .NET Community</a> vorbei. Die Teilnehmer 
helfen Ihnen gerne, wenn Sie sich zur im Artikel vorgestellten Technologie weiterbilden m&ouml;chten.
</p>

<p>
<a href="http://glengamoi.com/forums/"><img src="../images/glengamoi.com_250.gif" width="250" height="80" alt="" border="0"></a>
</p>


<p>
Haben Sie Fragen die sich direkt auf den Inhalt des Artikels beziehen, dann schreiben Sie dem Autor! Unsere Autoren
freuen sich &uuml;ber Feedback zu ihren Artikeln. Ein einfacher Klick auf die <i>Autor kontaktieren</i>
Schaltfl&auml;che (weiter unten) und schon haben Sie ein f&uuml;r diesen Artikel personalisiertes Anfrageformular.
</p>

<p>&nbsp;</p>
<p>
Und zu guter Letzt m&ouml;chten wir Sie bitten, den Artikel zu bewerten. Damit helfen Sie uns, 
die Qualit&auml;t der Artikel zu verbessern - und anderen Lesern bei der Auswahl der Artikel,
die sie lesen sollten.
</p>

<FORM METHOD="POST" STYLE="margin-bottom: 0px;" NAME="formRating" ACTION="/service/bewerten.asp">
<INPUT TYPE="HIDDEN" NAME="ArticleId" VALUE="20010502" />
<CENTER>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
	<TD ALIGN="CENTER" VALIGN="MIDDLE" COLSPAN="7">Bewerten Sie diesen Artikel</TD>
</TR>
<TR>
	<TD><EM>&nbsp;Sehr gut&nbsp;</EM></TD>
	<TD><INPUT TYPE="radio" value="1" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="2" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="3" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="4" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="5" NAME="radioRating" /></TD>
	<TD ALIGN="right"><EM>&nbsp;Nicht gen&uuml;gend</EM></TD>
	<TD ROWSPAN="2" VALIGN="middle">&nbsp;<INPUT TYPE="submit" VALUE="Werten!" /></TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD ALIGN="CENTER">&nbsp;1</TD>
	<TD ALIGN="CENTER">&nbsp;2</TD>
	<TD ALIGN="CENTER">&nbsp;3</TD>
	<TD ALIGN="CENTER">&nbsp;4</TD>
	<TD ALIGN="CENTER">&nbsp;5</TD>
	<TD>&nbsp;</TD>
</TR>
</TABLE>
</FORM>
</center>
&nbsp;<P>
<center>
<p><table><tr><td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="pagetitle" value="Logfiles mit Access auswerten"><input type="hidden" name="pageurl" value="http://www.aspheute.com/artikel/20010502.htm"><input type="image" src="../images/layout/senden.png" width="107" height="20" border="0" alt="Schicken Sie diese Seite einem Freund!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="Author" value="Christoph Wille"><input type="hidden" name="AuthorEmail" value="christophw@alphasierrapapa.com"><input type="hidden" name="Artikel" value="20010502"><input type="image" src="../images/layout/kontakt.png" width="107" height="20" border="0" alt="Kontaktieren Sie den Autor!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top><a href="../PrinterFriendly/20010502.htm"><img src="../images/layout/druck.png" width="118" height="20" border="0" alt="F&uuml;r Ausdruck optimierte Seite"></a></td>
</tr></table></p>
</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
