<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HTML>
<HEAD>
<TITLE>signup.asp</TITLE>
<STYLE>
BODY {
  font-family: "sans-serif";
  bgcolor: "#FFFFFF";
}

PRE {
  font-family: "monospaced";
  }

#statement {
  color: "#0000FF"; /* Color for Script Statements (things like Call, Dim, If...Then...Else, etc) */
  }

#function {
  color: "#FF0000"; /* Color for Script Functions (things like Instr, Abs, etc) */
  }

#script {
  color: "#800000"; /* Color for anything that is not in one of the above script categories, but is
                      contained inside script delimeters */
  }

#scripton {
  color: "#FF00FF"; /* Color for anything that is not in one of the above script categories, but is
                      contained inside script delimeters, inside quotation marks */
  }

#html {
  color: "#0000FF"; /* Color for any non-script html output */
  }

#base {
  color: "#000000"; /* Color for any non-script, non-html output */
  }

#comment {
  color: "#008000"; /* Color for any commented code */
  }

#linenum {
  color: "#808080"; /* Color for the line numbers */
  }
</STYLE>
</HEAD>

<BODY>

<pre><span id="linenum">001&nbsp;&nbsp;</span><span id="html">&lt;HTML&gt;</span><br><span id="linenum">002&nbsp;&nbsp;</span><span id="html">&lt;HEAD&gt;</span><br><span id="linenum">003&nbsp;&nbsp;</span><span id="html">&lt;TITLE&gt;</span>Dein Eintrag in das G&auml;stebuch<span id="html">&lt;/TITLE&gt;</span><br><span id="linenum">004&nbsp;&nbsp;</span><span id="html">&lt;/HEAD&gt;</span><br><span id="linenum">005&nbsp;&nbsp;</span><span id="html">&lt;BODY BGCOLOR="#ffffff"&gt;</span><br><span id="linenum">006&nbsp;&nbsp;</span><br><span id="linenum">007&nbsp;&nbsp;</span><span id="html">&lt;H1&gt;</span>Dein Eintrag in das G&auml;stebuch<span id="html">&lt;/H1&gt;</span><br><span id="linenum">008&nbsp;&nbsp;</span><span id="script">&lt;%<br><span id="linenum">009&nbsp;&nbsp;</span>strConnection = <span id="scripton">"Driver={Microsoft Access Driver (*.mdb)};DBQ="</span><br><span id="linenum">010&nbsp;&nbsp;</span>strConnection = strConnection & Server.MapPath(<span id="scripton">"guestbook2000.mdb"</span>) <br><span id="linenum">011&nbsp;&nbsp;</span>strConnection = strConnection & <span id="scripton">";DriverId=25;FIL=MS Access;MaxBufferSize=512;PageTimeout=5;"</span><br><span id="linenum">012&nbsp;&nbsp;</span><br><span id="linenum">013&nbsp;&nbsp;</span>strFinal = <span id="function">Trim</span>(Request.Form(<span id="scripton">"FinalSubmit"</span>))<br><span id="linenum">014&nbsp;&nbsp;</span><br><span id="linenum">015&nbsp;&nbsp;</span>strComment = <span id="function">Trim</span>(Request.Form(<span id="scripton">"Comment"</span>))<br><span id="linenum">016&nbsp;&nbsp;</span>strName = <span id="function">Trim</span>(Request.Form(<span id="scripton">"Name"</span>))<br><span id="linenum">017&nbsp;&nbsp;</span>strEmail = <span id="function">Trim</span>(Request.Form(<span id="scripton">"eMail"</span>))<br><span id="linenum">018&nbsp;&nbsp;</span>strURL = <span id="function">Trim</span>(Request.Form(<span id="scripton">"URL"</span>))<br><span id="linenum">019&nbsp;&nbsp;</span><br><span id="linenum">020&nbsp;&nbsp;</span><span id="statement">If </span><span id="scripton">"Yes"</span> &lt;&gt; strFinal <span id="statement">Then</span><br><span id="linenum">021&nbsp;&nbsp;</span>	<span id="statement">If </span><span id="scripton">""</span> = strName Or <span id="function">Len</span>(strEmail) &lt; 6 Or 0 = Instr(strEmail,<span id="scripton">"@"</span>) Or 0 = Instr(strEmail,<span id="scripton">"."</span>) <span id="statement">Then</span><br><span id="linenum">022&nbsp;&nbsp;</span>		Response.Write <span id="scripton">"Nicht alle ben&ouml;tigten Felder (Name, Emailadresse) wurden korrekt eingegeben!"</span><br><span id="linenum">023&nbsp;&nbsp;</span>	<span id="statement">Else</span><br><span id="linenum">024&nbsp;&nbsp;</span>%&gt;</span><br><span id="linenum">025&nbsp;&nbsp;</span><span id="html">&lt;p&gt;</span><br><span id="linenum">026&nbsp;&nbsp;</span>Bevor Dein Eintrag bei uns ins G&auml;stebuch aufgenommen wird, kontrolliere ihn bitte noch einmal:<span id="html">&lt;br&gt;</span><br><span id="linenum">027&nbsp;&nbsp;</span><span id="html">&lt;ul&gt;</span><br><span id="linenum">028&nbsp;&nbsp;</span><span id="html">&lt;li&gt;</span>Dein Name: <span id="script">&lt;%=SafeHtmlEncode(strName)%&gt;</span><br><span id="linenum">029&nbsp;&nbsp;</span><span id="html">&lt;li&gt;</span>Deine Emailadresse: <span id="script">&lt;%=SafeHtmlEncode(strEmail)%&gt;</span><br><span id="linenum">030&nbsp;&nbsp;</span><span id="script">&lt;% <span id="statement">If </span>strURL &lt;&gt; <span id="scripton">""</span> <span id="statement"><span id="statement">Then</span> </span>Response.Write <span id="scripton">"&lt;li&gt;Deine Homepage: http://"</span> & SafeHtmlEncode(strUrl) %&gt;</span><br><span id="linenum">031&nbsp;&nbsp;</span><span id="script">&lt;% <span id="statement">If </span>strComment &lt;&gt; <span id="scripton">""</span> <span id="statement"><span id="statement">Then</span> </span>Response.Write <span id="scripton">"&lt;li&gt;Dein Kommentar: "</span> & SafeHtmlEncode(strComment) %&gt;</span><br><span id="linenum">032&nbsp;&nbsp;</span><span id="html">&lt;/ul&gt;</span><br><span id="linenum">033&nbsp;&nbsp;</span>Wenn alles stimmt, klicke auf "Eintrag so abschicken!". Danke.<br><span id="linenum">034&nbsp;&nbsp;</span><span id="html">&lt;/p&gt;</span><br><span id="linenum">035&nbsp;&nbsp;</span><br><span id="linenum">036&nbsp;&nbsp;</span><span id="html">&lt;form METHOD=POST ACTION="<span id="script">&lt;%=Request.ServerVariables(<span id="scripton">"SCRIPT_NAME"</span>)%&gt;</span>"&gt;</span><br><span id="linenum">037&nbsp;&nbsp;</span><span id="html">&lt;input type="hidden" name="Name" value="<span id="script">&lt;%=SafeHtmlEncode(strName)%&gt;</span>"&gt;</span><br><span id="linenum">038&nbsp;&nbsp;</span><span id="html">&lt;input type="hidden" name="eMail" value="<span id="script">&lt;%=SafeHtmlEncode(strEmail)%&gt;</span>"&gt;</span><br><span id="linenum">039&nbsp;&nbsp;</span><span id="html">&lt;input type="hidden" name="URL" value="<span id="script">&lt;%=SafeHtmlEncode(strUrl)%&gt;</span>"&gt;</span><br><span id="linenum">040&nbsp;&nbsp;</span><span id="html">&lt;input type="hidden" name="Comment" value="<span id="script">&lt;%=SafeHtmlEncode(strComment)%&gt;</span>"&gt;</span><br><span id="linenum">041&nbsp;&nbsp;</span><span id="html">&lt;input type="hidden" name="FinalSubmit" value="Yes"&gt;</span><br><span id="linenum">042&nbsp;&nbsp;</span><span id="html">&lt;input type="submit" value="Eintrag so abschicken"&gt;</span><br><span id="linenum">043&nbsp;&nbsp;</span><span id="html">&lt;/form&gt;</span><br><span id="linenum">044&nbsp;&nbsp;</span><span id="script">&lt;%<br><span id="linenum">045&nbsp;&nbsp;</span>	<span id="statement">End If</span><br><span id="linenum">046&nbsp;&nbsp;</span><span id="statement">Else</span><br><span id="linenum">047&nbsp;&nbsp;</span>	<span id="comment">' we are submitted and going to the database</span><br><span id="linenum">048&nbsp;&nbsp;</span>	<span id="statement">If </span><span id="scripton">""</span> = strName Or <span id="function">Len</span>(strEmail) &lt; 6 <span id="statement">Then</span><br><span id="linenum">049&nbsp;&nbsp;</span>		Response.Write <span id="scripton">"&lt;p&gt;Nicht alle ben&ouml;tigten Felder (Name, Emailadresse) wurden korrekt eingegeben!&lt;/p&gt;"</span><br><span id="linenum">050&nbsp;&nbsp;</span>	<span id="statement">Else</span><br><span id="linenum">051&nbsp;&nbsp;</span>		<span id="statement">Set </span>bc = Server.<span id="function">CreateObject</span>(<span id="scripton">"MSWC.BrowserType"</span>)<br><span id="linenum">052&nbsp;&nbsp;</span>		strPlatform = bc.Platform<br><span id="linenum">053&nbsp;&nbsp;</span>		strBrowser = bc.Browser & <span id="scripton">" "</span> & bc.Version<br><span id="linenum">054&nbsp;&nbsp;</span>		<span id="statement">Set </span>bc = <span id="statement">Nothing</span><br><span id="linenum">055&nbsp;&nbsp;</span>		strDate = <span id="function">DatePart</span>(<span id="scripton">"d"</span>,Date) & <span id="scripton">"."</span> & <span id="function">DatePart</span>(<span id="scripton">"m"</span>,Date) & <span id="scripton">"."</span> & <span id="function">DatePart</span>(<span id="scripton">"yyyy"</span>,Date)<br><span id="linenum">056&nbsp;&nbsp;</span>		<br><span id="linenum">057&nbsp;&nbsp;</span>		<span id="comment">' shorten to correct database lengths</span><br><span id="linenum">058&nbsp;&nbsp;</span>		strName = <span id="function">Left</span>(SafeHtmlEncode(strName),50)<br><span id="linenum">059&nbsp;&nbsp;</span>		strEmail = <span id="function">Left</span>(SafeHtmlEncode(strEmail),50)<br><span id="linenum">060&nbsp;&nbsp;</span>		strURL = <span id="function">Left</span>(SafeHtmlEncode(strURL),50)<br><span id="linenum">061&nbsp;&nbsp;</span>		strBrowser = <span id="function">Left</span>(SafeHtmlEncode(strBrowser),20)<br><span id="linenum">062&nbsp;&nbsp;</span>		strPlatform = <span id="function">Left</span>(SafeHtmlEncode(strPlatform),20)<br><span id="linenum">063&nbsp;&nbsp;</span>		strComment = SafeHtmlEncode(strComment)<br><span id="linenum">064&nbsp;&nbsp;</span>		strIPAddress = <span id="function">Trim</span>(Request.ServerVariables(<span id="scripton">"REMOTE_ADDR"</span>))<br><span id="linenum">065&nbsp;&nbsp;</span>		arrBits = <span id="function">Split</span>(strIPAddress,<span id="scripton">"."</span>)<br><span id="linenum">066&nbsp;&nbsp;</span>		<span id="statement">If </span>(<span id="function">UBound</span>(arrBits) &lt;&gt; 3) <span id="statement">Then</span><br><span id="linenum">067&nbsp;&nbsp;</span>			Response.Write <span id="scripton">"Fatal Error parsing IP address of client!"</span><br><span id="linenum">068&nbsp;&nbsp;</span>			Response.End<br><span id="linenum">069&nbsp;&nbsp;</span>		<span id="statement">End If</span><br><span id="linenum">070&nbsp;&nbsp;</span>		<br><span id="linenum">071&nbsp;&nbsp;</span>		<span id="statement">Set </span>conn = <span id="function">CreateObject</span>(<span id="scripton">"ADODB.Connection"</span>)<br><span id="linenum">072&nbsp;&nbsp;</span>		conn.Open strConnection<br><span id="linenum">073&nbsp;&nbsp;</span>		<span id="statement">Set </span>rs = CreateObject (<span id="scripton">"ADODB.Recordset"</span>)<br><span id="linenum">074&nbsp;&nbsp;</span>		rs.Cursortype = 1<br><span id="linenum">075&nbsp;&nbsp;</span>		rs.Locktype = 3<br><span id="linenum">076&nbsp;&nbsp;</span>		rs.Open <span id="scripton">"SELECT * FROM Guestbook WHERE IdField=-1"</span>, conn<br><span id="linenum">077&nbsp;&nbsp;</span>		rs.AddNew<br><span id="linenum">078&nbsp;&nbsp;</span>			rs.fields(<span id="scripton">"Name"</span>) = strName<br><span id="linenum">079&nbsp;&nbsp;</span>			rs.fields(<span id="scripton">"EmailAddress"</span>) = strEmail<br><span id="linenum">080&nbsp;&nbsp;</span>			rs.fields(<span id="scripton">"Homepage"</span>) = strURL<br><span id="linenum">081&nbsp;&nbsp;</span>			rs.fields(<span id="scripton">"Comment"</span>) = strComment<br><span id="linenum">082&nbsp;&nbsp;</span>			rs.fields(<span id="scripton">"Browser"</span>) = strBrowser<br><span id="linenum">083&nbsp;&nbsp;</span>			rs.fields(<span id="scripton">"OperatingSystem"</span>) = strPlatform<br><span id="linenum">084&nbsp;&nbsp;</span>			rs.fields(<span id="scripton">"EntryDate"</span>) = strDate<br><span id="linenum">085&nbsp;&nbsp;</span>			rs.fields(<span id="scripton">"IP1"</span>) = arrBits(0)<br><span id="linenum">086&nbsp;&nbsp;</span>			rs.fields(<span id="scripton">"IP2"</span>) = arrBits(1)<br><span id="linenum">087&nbsp;&nbsp;</span>			rs.fields(<span id="scripton">"IP3"</span>) = arrBits(2)<br><span id="linenum">088&nbsp;&nbsp;</span>			rs.fields(<span id="scripton">"IP4"</span>) = arrBits(3)<br><span id="linenum">089&nbsp;&nbsp;</span>		rs.Update<br><span id="linenum">090&nbsp;&nbsp;</span>		rs.Close<br><span id="linenum">091&nbsp;&nbsp;</span>		conn.Close<br><span id="linenum">092&nbsp;&nbsp;</span>		Response.Write <span id="scripton">"&lt;p&gt;Vielen Dank f&uuml;r Deinen G&auml;stebucheintrag! Wir freuen uns, da&szlig; Du uns Deine Meinung gesagt hast.&lt;/p&gt;"</span><br><span id="linenum">093&nbsp;&nbsp;</span>		Response.Write <span id="scripton">"&lt;p&gt;&lt;a href="</span><span id="scripton">"entries.asp"</span><span id="scripton">"&gt;Liste&lt;/A&gt; der G&auml;stebucheintr&auml;ge.&lt;/p&gt;"</span><br><span id="linenum">094&nbsp;&nbsp;</span>	<span id="statement">End If</span><br><span id="linenum">095&nbsp;&nbsp;</span><span id="statement">End If</span><br><span id="linenum">096&nbsp;&nbsp;</span><br><span id="linenum">097&nbsp;&nbsp;</span><span id="statement">Function </span>SafeHtmlEncode(strIn)<br><span id="linenum">098&nbsp;&nbsp;</span>	<span id="statement">If </span><span id="statement">Not </span>Is<span id="statement">Null</span>(strIn) <span id="statement">Then</span><br><span id="linenum">099&nbsp;&nbsp;</span>		SafeHtmlEncode = Server.HtmlEncode(strIn)<br><span id="linenum">100&nbsp;&nbsp;</span>	<span id="statement">Else</span><br><span id="linenum">101&nbsp;&nbsp;</span>		SafeHtmlEncode = <span id="scripton">""</span><br><span id="linenum">102&nbsp;&nbsp;</span>	<span id="statement">End If</span><br><span id="linenum">103&nbsp;&nbsp;</span><span id="statement">End Function</span><br><span id="linenum">104&nbsp;&nbsp;</span>%&gt;</span><br><span id="linenum">105&nbsp;&nbsp;</span><br><span id="linenum">106&nbsp;&nbsp;</span><span id="html">&lt;/BODY&gt;</span><br><span id="linenum">107&nbsp;&nbsp;</span><span id="html">&lt;/HTML&gt;</span><br></pre>
</BODY>
</HTML>
