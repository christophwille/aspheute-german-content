<HTML>
<HEAD>
<TITLE>CAPICOM One</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="7 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="Relativ unbemerkt hat Microsoft im Vorjahr CAPICOM - einen COM Client f&uuml;r das CryptoAPI - released. Dabei handelt sich um ein Set sehr n&uuml;tzlicher kryptographischer Komponenten...">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,CryptoAPI,CAPICOM,RC2,3DES,Encryption,Decryption,Security,COM,Automation,Sicherheit,Verschlüsselung">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff"  BACKGROUND="../images/layout/aspheutemainbg.gif" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<MAP NAME="titlebar">
<!--<AREA SHAPE=RECT COORDS="116,46,191,61" HREF="http://www.aspaktuell.com" ALT="ASP Aktuell">-->
<!--<AREA SHAPE=RECT COORDS="192,46,255,61" HREF="http://www.aspwelt.com" ALT="ASP Welt">-->
<AREA SHAPE=RECT COORDS="256,46,432,61" HREF="http://www.aspgerman.com/aspgerman/" ALT="ASP German">
<AREA SHAPE=RECT COORDS="115,15,269,42" HREF="../default.htm" ALT="Homepage">
<AREA SHAPE=RECT COORDS="278,26,587,42" HREF="../default.htm" ALT="Homepage">
</MAP>

<div style="position:absolute;left:0px;top:30px">
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td background="../images/layout/aspheutetitle.gif">
<img src="../images/layout/blind.gif" width="715" height="73" usemap="#titlebar" border="0">
</td>
<td width="100%" background="../images/layout/aspheutetitleext.gif">
&nbsp;
</td>
<td background="../images/layout/aspheutetitleend.gif">
<img src="../images/layout/blind.gif" width="25" height="1">
</td>
</tr>
</table>
</div>

<div style="position:absolute;left:1px;top:115px">
<table width="110" border="0" cellspacing="0" cellpadding="0">
<tr><td width="110"><img src="../Images/spacer.gif" width="110" height="1" alt="" border="0"></td></tr>
<tr>
<td background="../images/layout/aspheuteheader.gif" class="header" height=16 width="110">
<p>Liste</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">

<p class="content">
<a href="../kategorien/dotNET%202dot0.htm">.NET 2.0 (1)</a><br>
<a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein (16)</a><br>
<a href="../kategorien/dotNET%20Fu.htm">.NET Fu (5)</a><br>
<a href="../kategorien/ADOdotNET.htm">ADO.NET (11)</a><br>
<a href="../kategorien/Aprilscherz.htm">Aprilscherz (3)</a><br>
<a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen (44)</a><br>
<a href="../kategorien/ASP%20Tricks.htm">ASP Tricks (83)</a><br>
<a href="../kategorien/ASPdotNET.htm">ASP.NET (44)</a><br>
<a href="../kategorien/ASPIntranetdotde.htm">ASPIntranet.de (5)</a><br>
<a href="../kategorien/Csharp.htm">C# (28)</a><br>
<a href="../kategorien/Datenbank.htm">Datenbank (44)</a><br>
<a href="../kategorien/Dokumentation.htm">Dokumentation (4)</a><br>
<a href="../kategorien/IIS%206dot0.htm">IIS 6.0 (1)</a><br>
<a href="../kategorien/Komponenten.htm">Komponenten (29)</a><br>
<a href="../kategorien/Optimierung.htm">Optimierung (10)</a><br>
<a href="../kategorien/Server.htm">Server (21)</a><br>
<a href="../kategorien/Sicherheit.htm">Sicherheit (34)</a><br>
<a href="../kategorien/Tee%20Off.htm">Tee Off (6)</a><br>
<a href="../kategorien/VBdotNET.htm">VB.NET (6)</a><br>
<a href="../kategorien/WAP.htm">WAP (8)</a><br>
<a href="../kategorien/Web%20Services.htm">Web Services (11)</a><br>
<a href="../kategorien/XML.htm">XML (9)</a><br>


<br>
<a href="/syndication/rss.xml"><img src="../Images/rss_small.png" width="25" height="10" alt="RSS 2.0 - Die neuesten f&uuml;nf Artikel auf AspHeute.com" border="0"></a>

</p><!-- </p> remains -->


<br>

</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearch.gif" class="header" height=16 width="110">
<p>Suchen</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearchext.gif" class="header" width="110">
<form class="content" ACTION="REMOVED" METHOD="GET">
<div>
<input class="Newsletter" type="text" size="10" name="CiRestriction">
<span class="spacer2"><br></span>
<span class="spacer4"><br></span>
<INPUT TYPE="HIDDEN" NAME="CiMaxRecordsPerPage" VALUE="10">
<INPUT TYPE="HIDDEN" NAME="CiSort" VALUE="rank[d]">
<INPUT TYPE="HIDDEN" NAME="HTMLQueryForm" VALUE="../default.htm">
<img src="../images/layout/blind.gif" width="41" height="1"><input type="image" src="../images/layout/aspheutesearchenter.gif" border="0" width="49" height="14"><br>
<span class="spacer4"><br></span>
</div>
</form>
</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">
<p class="content">
<a href="/REMOVED/" title="Our most popular articles translated into English">English Articles</a><br>
<a href="/REMOVED/" title="Visit our Chinese content section">Chinese Articles</a><br>
<a href="../autoren/UnsereAutoren.htm" title="Unsere Autoren">Unsere Autoren</a><br>
&nbsp;<br>
<a href="/REMOVED/link2us.asp" title="Setzen Sie einen Link zu AspHeute!">Link zu AspHeute</a><br>
<a href="/REMOVED/impressum.asp" title="Das Impressum von AspHeute">Impressum</a><br>
<a href="/REMOVED/advertise.asp" title="Werben auch Sie auf AspHeute">Werben</a><br>
<a href="/REMOVED/kontakt.asp" title="Teilen Sie uns Ihre W&uuml;nsche, Beschwerden und Anregungen mit">Anfragen</a><br>
</p>
</td>
</tr>
</table>
</div>



<!-- Content starts here  -->
<div style="position:absolute;left:120px;top:108px">
<table cellspacing="0" cellpadding="0"><!--Tabelle aussen-->
<tr><!--Tabelle aussen, 1/2-->
<td><!--Tabelle aussen, 1/1-->
    <table border=0 align=center><tr><td align=center>


</td></tr></table>

<H1>CAPICOM One</H1>
<p>
Geschrieben von: <a href="../autoren/christophwille.htm">Christoph Wille</a><br>
Kategorie: <a href="../kategorien/Sicherheit.htm">Sicherheit</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20020115"></SCRIPT>
</p>
<p>
Relativ unbemerkt hat Microsoft im Vorjahr CAPICOM - einen COM Client f&uuml;r das CryptoAPI - im "Windschatten" von
Windows XP released. Dabei handelt sich um ein Set sehr n&uuml;tzlicher kryptographischer Komponenten, die in jeder Programmiersprache mit
Automation Unterst&uuml;tzung verwendet werden k&ouml;nnen - von Visual Basic bis hin zur kleinen Verwandtschaft in ASP, VBScript.
</p>
<p>
CAPICOM bietet Komponenten zur Ver- und Entschl&uuml;sselung (in der Version 1.0 sind nur symmetrische Algorithmen
mit dabei), Komponenten zur Signierung von Daten und der bequemen Handhabung von Zertifikaten (mit und 
ohne User Interface, je nach Wunsch). Im heutigen Artikel beschr&auml;nke ich mich auf Ver- und Entschl&uuml;sselung,
da dies speziell f&uuml;r ASP ein gr&ouml;&szlig;eres Anwendungsgebiet findet.
</p>

<h2>Installation</h2>
<p>
Der erste Schritt ist der Download des CAPICOM Redistributables als Teil des Platform SDK's. Von der
<a href="http://www.microsoft.com/downloads/release.asp?releaseid=30316" target="_blank">Downloadseite</a>
holen wir uns ein selbstextrahierendes Archiv, das die Datei <b>capicom.dll</b> im <b>x86</b> Unterverzeichnis
des Zielverzeichnisses speichert. Diese <b>capicom.dll</b> kopiert man in <b>system32</b> Verzeichnis, und f&uuml;hrt dann
noch folgenden Befehl aus:
</p>

<pre style="background='silver';">
regsvr32 capicom.dll 
</pre>

<p>
Wenn man Anwendungen verteilt, kann man diese DLL in das Setup aufnehmen, und am Zielrechner automatisch
registrieren lassen.
</p>

<h2>Verschl&uuml;sseln von Daten</h2>
<p>
CAPICOM ist erfolgreich installiert - nun hei&szlig;t es, sich mit den neuen Komponenten vertraut zu machen.
Was ist da besser, als ein kleines Beispiel zu programmieren: es soll Text mit Triple-DES verschl&uuml;sseln,
und an den Client ausgeben. Da&szlig; dies wirklich leicht implementiert werden kann, zeigt der Sourcecode
von <b>encrypt.asp</b>:
</p>

<pre style="background='silver';">
&lt;%
Const CAPICOM_ENCRYPTION_ALGORITHM_RC2 = 0 ' Use RSA RC2 encryption. 
Const CAPICOM_ENCRYPTION_ALGORITHM_RC4 = 1 ' Use RSA RC4 encryption. 
Const CAPICOM_ENCRYPTION_ALGORITHM_DES = 2 ' Use DES encryption. 
Const CAPICOM_ENCRYPTION_ALGORITHM_3DES = 3 ' Use triple DES encryption. 

strTestMessage = "Hello World!"
strPassphrase = "A#0x?\$dE&lt;"	' NIEMALS die Passphrase "herumliegen" lassen

Set xEncrypt = Server.CreateObject("CAPICOM.EncryptedData")
xEncrypt.Content = strTestMessage
xEncrypt.SetSecret strPassphrase
xEncrypt.Algorithm.Name = CAPICOM_ENCRYPTION_ALGORITHM_3DES
strEncryptedMsg = xEncrypt.Encrypt()

Response.Write strEncryptedMsg
%&gt;
</pre>

<p>
Zuerst erstellt man das Objekt, weist den zu verschl&uuml;sselnden Text der Eigenschaft <i>Content</i> zu,
setzt das Secret mittels <i>SetSecret</i> Methode, und dann m&uuml;&szlig;te man nur noch <i>Encrypt</i> aufrufen.
Um festzulegen, mittels welchem Algorithmus verschl&uuml;sselt wird, bedient man sich der <i>Algorithm</i>
Eigenschaft, die ein gleichnamiges Objekt liefert, das die <i>Name</i> Eigenschaft besitzt - und hier
kann man dann aus vier Algorithmen w&auml;hlen: RC2, RC4, DES und Triple-DES.
</p>
<p>
Wer jemals in das normale C API des CryptoAPI hineingeschnuppert hat, der wird ob der leichten 
Verwendbarkeit entz&uuml;ckt sein. Und es wird auch nicht schwieriger, wenn man einstellen will, welche
Schl&uuml;ssell&auml;nge f&uuml;r den jeweiligen Algorithmus verwendet werden soll. Ein paar Konstanten mehr, sonst
nichts, wie der Code in <b>highencpack.asp</b> demonstriert:
</p>

<pre style="background='silver';">
&lt;%
Const CAPICOM_ENCRYPTION_ALGORITHM_RC2 = 0 ' Use RSA RC2 encryption. 
Const CAPICOM_ENCRYPTION_ALGORITHM_RC4 = 1 ' Use RSA RC4 encryption. 
Const CAPICOM_ENCRYPTION_ALGORITHM_DES = 2 ' Use DES encryption. 
Const CAPICOM_ENCRYPTION_ALGORITHM_3DES = 3 ' Use triple DES encryption. 

Const CAPICOM_KEY_LENGTH_MAXIMUM = 0 ' Use the maximum key length available...
Const CAPICOM_KEY_LENGTH_40_BITS = 1 ' Use 40-bit keys. 
Const CAPICOM_KEY_LENGTH_56_BITS = 2 ' Use 56-bit keys if available. 
Const CAPICOM_KEY_LENGTH_128_BITS = 3 ' Use 128-bit keys if available 

strTestMessage = "Hello World!"
strPassphrase = "A#0x?\$dE&lt;"	' NIEMALS die Passphrase "herumliegen" lassen

Set xEncrypt = Server.CreateObject("CAPICOM.EncryptedData")
xEncrypt.Content = strTestMessage
xEncrypt.SetSecret strPassphrase

' Key lengths for DES and 3DES encryption are standard and the key length 
' property is ignored when these algorithms are used. 
xEncrypt.Algorithm.Name = CAPICOM_ENCRYPTION_ALGORITHM_RC4
xEncrypt.Algorithm.KeyLength = CAPICOM_KEY_LENGTH_128_BITS

strEncryptedMsg = xEncrypt.Encrypt()

Response.Write strEncryptedMsg
%&gt;
</pre>

<h2>Entschl&uuml;sseln</h2>
<p>
Fast selbstverst&auml;ndlich funktioniert das Entschl&uuml;sseln &auml;hnlich einfach wie das Verschl&uuml;sseln. Der
Unterschied ist, da&szlig; man die Funktion <i>Decrypt</i> mit dem Ciphertext "f&uuml;ttern" mu&szlig;, und bei der 
<i>Content</i> Eigenschaft kommt dann der Plaintext wieder heraus (<b>decrypt.asp</b>):
</p>

<pre style="background='silver';">
&lt;%
Const CAPICOM_ENCRYPTION_ALGORITHM_3DES = 3 ' Use triple DES encryption. 

strCipherText = "MGoGCSsGAQQBgjdYA6BdMFsGCisGAQQBgjdYAwGgTTBLAgMBAAACAmYDAgIAwAQI" &amp; vbCrlf &amp; _
   "JZjDl4H5hRIEEOdot2WroaM35Vr5FVAl/e8EIL7qaJJeuMBQC4625aKdH8u8hgd5" &amp; vbCrlf &amp; _
   "rsyBD3jAok7fbdCG"

strPassphrase = "A#0x?\$dE&lt;"	' NIEMALS die Passphrase "herumliegen" lassen

Set xEncrypt = Server.CreateObject("CAPICOM.EncryptedData")
xEncrypt.SetSecret strPassphrase
xEncrypt.Algorithm.Name = CAPICOM_ENCRYPTION_ALGORITHM_3DES
xEncrypt.Decrypt(strCipherText)
strPlainText = xEncrypt.Content

Response.Write strPlainText
%&gt;
</pre>

<p>
Zur Aufl&ouml;sung - es kommt nat&uuml;rlich "Hello World!" beim Client an.
</p>

<h2>Schlu&szlig;bemerkung</h2>
<p>
Ver- und Entschl&uuml;sseln ist nur ein Feature von CAPICOM - ein sehr n&uuml;tzliches. F&uuml;r eine
Besprechung der weiteren Features empfehle ich die Links am Ende dieses Artikels.
</p>
<h2>Download des Codes</h2>
<p><a href="../Code/20020115.zip">Klicken Sie hier</a>, um den Download zu starten.</p>
<h2>Verwandte Artikel</h2>
<p>
<a href="20010528.htm">Aber bitte mit Rijndael</a><br>
<a href="20020429.htm">Benutzerverwaltung leicht gemacht: Teil 1</a><br>
<a href="20010330.htm">Passw&ouml;rter mit SHA1 absichern</a><br>
<a href="20040105.htm">Passw&ouml;rter speichern - aber richtig!</a><br>
<a href="20000920.htm">PGP-Verschl&uuml;sselung bei Dateien</a><br>
<a href="20010924.htm">Unknackbare Verschl&uuml;sselung mit Onetime Pads</a><br>
<a href="20000921.htm">Ver- und entschl&uuml;sseln von Texten mit PGP</a><br>

</p>
<h2>Links zu anderen Sites</h2>
<p>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fmsdn%2Emicrosoft%2Ecom%2Flibrary%2Fen%2Dus%2Fsecurity%2FSecurity%2Fcapicom%5Fstart%5Fpage%2Easp">CAPICOM Dokumentation</a><br>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fmsdn%2Emicrosoft%2Ecom%2Flibrary%2Fdefault%2Easp%3Furl%3D%2Flibrary%2Fen%2Dus%2Fdnsecure%2Fhtml%2Fintcapicom%2Easp">Introducing CAPICOM</a><br>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Emicrosoft%2Ecom%2Fdownloads%2Frelease%2Easp%3Freleaseid%3D30316">Platform SDK Redistributable: CAPICOM 1.0A</a><br>

</p>

<h2>Wenn Sie jetzt Fragen haben...</h2>
<p>
Wenn Sie Fragen rund um die in diesem Artikel vorgestellte Technologie haben, dann schauen Sie einfach bei uns
in den <a href="http://glengamoi.com/forums/">Community Foren der deutschen .NET Community</a> vorbei. Die Teilnehmer 
helfen Ihnen gerne, wenn Sie sich zur im Artikel vorgestellten Technologie weiterbilden m&ouml;chten.
</p>

<p>
<a href="http://glengamoi.com/forums/"><img src="../images/glengamoi.com_250.gif" width="250" height="80" alt="" border="0"></a>
</p>


<p>
Haben Sie Fragen die sich direkt auf den Inhalt des Artikels beziehen, dann schreiben Sie dem Autor! Unsere Autoren
freuen sich &uuml;ber Feedback zu ihren Artikeln. Ein einfacher Klick auf die <i>Autor kontaktieren</i>
Schaltfl&auml;che (weiter unten) und schon haben Sie ein f&uuml;r diesen Artikel personalisiertes Anfrageformular.
</p>

<p>&nbsp;</p>
<p>
Und zu guter Letzt m&ouml;chten wir Sie bitten, den Artikel zu bewerten. Damit helfen Sie uns, 
die Qualit&auml;t der Artikel zu verbessern - und anderen Lesern bei der Auswahl der Artikel,
die sie lesen sollten.
</p>

<FORM METHOD="POST" STYLE="margin-bottom: 0px;" NAME="formRating" ACTION="/service/bewerten.asp">
<INPUT TYPE="HIDDEN" NAME="ArticleId" VALUE="20020115" />
<CENTER>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
	<TD ALIGN="CENTER" VALIGN="MIDDLE" COLSPAN="7">Bewerten Sie diesen Artikel</TD>
</TR>
<TR>
	<TD><EM>&nbsp;Sehr gut&nbsp;</EM></TD>
	<TD><INPUT TYPE="radio" value="1" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="2" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="3" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="4" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="5" NAME="radioRating" /></TD>
	<TD ALIGN="right"><EM>&nbsp;Nicht gen&uuml;gend</EM></TD>
	<TD ROWSPAN="2" VALIGN="middle">&nbsp;<INPUT TYPE="submit" VALUE="Werten!" /></TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD ALIGN="CENTER">&nbsp;1</TD>
	<TD ALIGN="CENTER">&nbsp;2</TD>
	<TD ALIGN="CENTER">&nbsp;3</TD>
	<TD ALIGN="CENTER">&nbsp;4</TD>
	<TD ALIGN="CENTER">&nbsp;5</TD>
	<TD>&nbsp;</TD>
</TR>
</TABLE>
</FORM>
</center>
&nbsp;<P>
<center>
<p><table><tr><td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="pagetitle" value="CAPICOM One"><input type="hidden" name="pageurl" value="http://www.aspheute.com/artikel/20020115.htm"><input type="image" src="../images/layout/senden.png" width="107" height="20" border="0" alt="Schicken Sie diese Seite einem Freund!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="Author" value="Christoph Wille"><input type="hidden" name="AuthorEmail" value="christophw@alphasierrapapa.com"><input type="hidden" name="Artikel" value="20020115"><input type="image" src="../images/layout/kontakt.png" width="107" height="20" border="0" alt="Kontaktieren Sie den Autor!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top><a href="../PrinterFriendly/20020115.htm"><img src="../images/layout/druck.png" width="118" height="20" border="0" alt="F&uuml;r Ausdruck optimierte Seite"></a></td>
</tr></table></p>
</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
