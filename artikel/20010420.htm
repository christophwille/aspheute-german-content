<HTML>
<HEAD>
<TITLE>Ein einfacher Query Analyzer</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="7 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="Der heutige Artikel befa&szlig;t sich mit einem altbekannten Thema - SQL Statements. Heute coden wir ein ASP Formular, in dem man bequem Statements eingeben kann, und dann eine dementsprechende Ausgabe erh&auml;lt.">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,Query Analyzer,Input,SQL Statement,SQL,Query,Abfrage,Test">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff"  BACKGROUND="../images/layout/aspheutemainbg.gif" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<MAP NAME="titlebar">
<!--<AREA SHAPE=RECT COORDS="116,46,191,61" HREF="http://www.aspaktuell.com" ALT="ASP Aktuell">-->
<!--<AREA SHAPE=RECT COORDS="192,46,255,61" HREF="http://www.aspwelt.com" ALT="ASP Welt">-->
<AREA SHAPE=RECT COORDS="256,46,432,61" HREF="http://www.aspgerman.com/aspgerman/" ALT="ASP German">
<AREA SHAPE=RECT COORDS="115,15,269,42" HREF="../default.htm" ALT="Homepage">
<AREA SHAPE=RECT COORDS="278,26,587,42" HREF="../default.htm" ALT="Homepage">
</MAP>

<div style="position:absolute;left:0px;top:30px">
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td background="../images/layout/aspheutetitle.gif">
<img src="../images/layout/blind.gif" width="715" height="73" usemap="#titlebar" border="0">
</td>
<td width="100%" background="../images/layout/aspheutetitleext.gif">
&nbsp;
</td>
<td background="../images/layout/aspheutetitleend.gif">
<img src="../images/layout/blind.gif" width="25" height="1">
</td>
</tr>
</table>
</div>

<div style="position:absolute;left:1px;top:115px">
<table width="110" border="0" cellspacing="0" cellpadding="0">
<tr><td width="110"><img src="../Images/spacer.gif" width="110" height="1" alt="" border="0"></td></tr>
<tr>
<td background="../images/layout/aspheuteheader.gif" class="header" height=16 width="110">
<p>Liste</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">

<p class="content">
<a href="../kategorien/dotNET%202dot0.htm">.NET 2.0 (1)</a><br>
<a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein (16)</a><br>
<a href="../kategorien/dotNET%20Fu.htm">.NET Fu (5)</a><br>
<a href="../kategorien/ADOdotNET.htm">ADO.NET (11)</a><br>
<a href="../kategorien/Aprilscherz.htm">Aprilscherz (3)</a><br>
<a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen (44)</a><br>
<a href="../kategorien/ASP%20Tricks.htm">ASP Tricks (83)</a><br>
<a href="../kategorien/ASPdotNET.htm">ASP.NET (44)</a><br>
<a href="../kategorien/ASPIntranetdotde.htm">ASPIntranet.de (5)</a><br>
<a href="../kategorien/Csharp.htm">C# (28)</a><br>
<a href="../kategorien/Datenbank.htm">Datenbank (44)</a><br>
<a href="../kategorien/Dokumentation.htm">Dokumentation (4)</a><br>
<a href="../kategorien/IIS%206dot0.htm">IIS 6.0 (1)</a><br>
<a href="../kategorien/Komponenten.htm">Komponenten (29)</a><br>
<a href="../kategorien/Optimierung.htm">Optimierung (10)</a><br>
<a href="../kategorien/Server.htm">Server (21)</a><br>
<a href="../kategorien/Sicherheit.htm">Sicherheit (34)</a><br>
<a href="../kategorien/Tee%20Off.htm">Tee Off (6)</a><br>
<a href="../kategorien/VBdotNET.htm">VB.NET (6)</a><br>
<a href="../kategorien/WAP.htm">WAP (8)</a><br>
<a href="../kategorien/Web%20Services.htm">Web Services (11)</a><br>
<a href="../kategorien/XML.htm">XML (9)</a><br>


<br>
<a href="/syndication/rss.xml"><img src="../Images/rss_small.png" width="25" height="10" alt="RSS 2.0 - Die neuesten f&uuml;nf Artikel auf AspHeute.com" border="0"></a>

</p><!-- </p> remains -->


<br>

</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearch.gif" class="header" height=16 width="110">
<p>Suchen</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearchext.gif" class="header" width="110">
<form class="content" ACTION="REMOVED" METHOD="GET">
<div>
<input class="Newsletter" type="text" size="10" name="CiRestriction">
<span class="spacer2"><br></span>
<span class="spacer4"><br></span>
<INPUT TYPE="HIDDEN" NAME="CiMaxRecordsPerPage" VALUE="10">
<INPUT TYPE="HIDDEN" NAME="CiSort" VALUE="rank[d]">
<INPUT TYPE="HIDDEN" NAME="HTMLQueryForm" VALUE="../default.htm">
<img src="../images/layout/blind.gif" width="41" height="1"><input type="image" src="../images/layout/aspheutesearchenter.gif" border="0" width="49" height="14"><br>
<span class="spacer4"><br></span>
</div>
</form>
</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">
<p class="content">
<a href="/REMOVED/" title="Our most popular articles translated into English">English Articles</a><br>
<a href="/REMOVED/" title="Visit our Chinese content section">Chinese Articles</a><br>
<a href="../autoren/UnsereAutoren.htm" title="Unsere Autoren">Unsere Autoren</a><br>
&nbsp;<br>
<a href="/REMOVED/link2us.asp" title="Setzen Sie einen Link zu AspHeute!">Link zu AspHeute</a><br>
<a href="/REMOVED/impressum.asp" title="Das Impressum von AspHeute">Impressum</a><br>
<a href="/REMOVED/advertise.asp" title="Werben auch Sie auf AspHeute">Werben</a><br>
<a href="/REMOVED/kontakt.asp" title="Teilen Sie uns Ihre W&uuml;nsche, Beschwerden und Anregungen mit">Anfragen</a><br>
</p>
</td>
</tr>
</table>
</div>



<!-- Content starts here  -->
<div style="position:absolute;left:120px;top:108px">
<table cellspacing="0" cellpadding="0"><!--Tabelle aussen-->
<tr><!--Tabelle aussen, 1/2-->
<td><!--Tabelle aussen, 1/1-->
    <table border=0 align=center><tr><td align=center>


</td></tr></table>

<H1>Ein einfacher Query Analyzer</H1>
<p>
Geschrieben von: <a href="../autoren/christianholm.htm">Christian Holm</a><br>
Kategorie: <a href="../kategorien/Datenbank.htm">Datenbank</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20010420"></SCRIPT>
</p>
<p>
Der heutige Artikel befa&szlig;t sich mit einem altbekannten Thema - SQL Statements. Hierbei wird aber nicht auf die
einzelnen SQL Statements eingegangen, sondern wie man sich ein ASP Formular codet, in dem man bequem Statements
eingeben kann, und dann eine dementsprechende Ausgabe erh&auml;lt.
</p>

<p>
Das Formular sollte die M&ouml;glichkeit bieten, ein beliebiges SQL Statement einzugeben. Nach einem erfolgten Postback
sollte anhand der Eingabe das Statement ausgef&uuml;hrt werden, und falls m&ouml;glich ein Ergebnis angezeigt werden.
Den Sourcecode zu diesem Beispiel finden Sie im Download in der Datei <b>ExSQL.asp</b>.
</p>

<p>
Das Eingabeformular enth&auml;lt keine Stolpersteine:
</p>

<pre style="background='silver';">
&lt;form method="post"&gt;
&lt;table cellpadding="2" cellspacing="2" border="0"&gt;
  &lt;tr&gt;
     &lt;td valign="top"&gt;SQL Statement:&lt;/td&gt;
     &lt;td&gt;  
       &lt;textarea name="txtSQLStmt" rows="8" cols="60"&gt;&lt;%=strSQLStmt%&gt;
       &lt;/textarea&gt;
     &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
      &lt;td colspan="2" align="right"&gt;&lt;input type="submit" value="Execute"&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
&lt;/form&gt;
</pre>

<p>
Interessanter hingegen ist der eigentliche Sourcecode. Damit dieser etwas mehr Komfort bzw. Sicherheit bietet, habe ich
zus&auml;tzlich eine Fehlerbehandlung integriert. Gehen wir also den Sourcecode schrittweise durch:
</p>

<pre style="background='silver';">
If bIsPostback Then
    Set objConn = Server.CreateObject("ADODB.Connection")
    objConn.Open strConn
    
    On Error Resume Next
    Set objRS = objConn.Execute(strSQLStmt)

    If Err.Number &lt;&gt; 0 Then
      Response.Write "&lt;p&gt;Fehler bei der Ausf&uuml;hrung des SQL Statements:&lt;br&gt;&lt;b&gt;"
      Response.Write Err.Source &amp; ", " &amp; Err.Description &amp; "&lt;/b&gt;&lt;/p&gt;"
    Else
</pre>

<p>
Dieser Teil wird ausgef&uuml;hrt, wenn ein PostBack stattgefunden hat. Die Variable <i>bIsPostback</i> wurde so
vorher mit
</p>

<pre style="background='silver';">
bIsPostback = CLng(Request.ServerVariables("CONTENT_LENGTH"))
</pre>

<p>
zugewiesen. Nach der Instanzierung des <i>Connection</i> Objektes und &Ouml;ffnung der Verbindung zur Datenbank (als
Beispiel wurde hier die Northwind Datenbank hardcodiert) beginnt die Fehlerbehandlung. Falls die <i>Number</i>
Property des <i>Err</i> Objektes ungleich 0 ist, ist ein Fehler aufgetreten. Dieser wird dann mit den
Properties <i>Source</i> und <i>Description</i> beschrieben.
</p>

<p>
Da die <i>Execute</i> Methode eine interessante Fehlerquelle darstellt, ist diese in der Fehlerbehandlung 
nat&uuml;rlich miteinbezogen. Als n&auml;chstes folgt die Alternativbedingung der If-Verzweigung, 
die ausgef&uuml;hrt wird wenn kein Fehler aufgetreten ist:
</p>

<pre style="background='silver';">
Response.Write "&lt;table cellpadding=""2"" cellspacing=""2"" border=""2""&gt;"
  For FieldIndex = 1 To objRS.Fields.Count - 1
     Response.Write "  &lt;th&gt;" &amp; objRS.Fields(FieldIndex).Name &amp; "&lt;/th&gt; "
  Next

  While Not objRS.EOF
    Response.Write "&lt;tr&gt;"
    For FieldIndex = 1 To objRS.Fields.Count - 1
        Response.Write "&lt;td&gt;" &amp; objRS(FieldIndex) &amp; "&lt;/td&gt;"
    Next
  
    Response.Write "&lt;/tr&gt;"
    objRS.MoveNext
  Wend
  
  Response.Write "&lt;/table&gt;"
</pre>

<p>
Dieser Code z.B. erlaubt es unabh&auml;ngig von der vorhandenen Spaltenzahl einer Datenbank des eingegebenen <i>SELECT</i> 
Statements alle Datens&auml;tze zur&uuml;ckzugeben die der Bedingung im Statement gen&uuml;gen. Zwecks der &Uuml;bersicht werden die 
gewonnenen Datens&auml;tze in einer HTML Tabelle ausgegeben.
</p>

<p>
Ausgef&uuml;hrt in einem Browser erh&auml;lt man nach Eingabe eines SQL-Statements folgendes Ergebnis:
</p>

<IMG SRC="Bilder/200104/20010420_1.png" width="593" height="530" alt="" border="0">

<p>
Es funktionieren nicht nur SELECT Statements - auch DELETE oder INSERT k&ouml;nnen ohne Probleme in diesem "Query
Analyzer" abgesetzt werden.
</p>

<h2>Schlu&szlig;bemerkung</h2>
<p>
Dies war ein einfaches, erweiterbares Beispielskript, das den praktischen Zweck des Query Analyzers des SQL Servers
auf ASP Basis widerspiegelt.
</p>
<h2>Download des Codes</h2>
<p><a href="../Code/20010420.zip">Klicken Sie hier</a>, um den Download zu starten.</p>
<h2>Verwandte Artikel</h2>
<p>
<a href="20001124.htm">Aktualisieren von Daten mit dem UPDATE Statement</a><br>
<a href="20001023.htm">Das SQL Join Statement</a><br>
<a href="20001127.htm">Datens&auml;tze mit dem DELETE Statement l&ouml;schen</a><br>
<a href="20001201.htm">Die SQL ORDER BY Clause</a><br>
<a href="20001107.htm">Einf&uuml;gen eines Datensatzes mit dem INSERT Statement</a><br>
<a href="20020322.htm">Query Express f&uuml;r MSDE</a><br>
<a href="20020903.htm">Stored Procedures einfach erstellt</a><br>
<a href="20020410.htm">Yet Another Access Database Administration Tool</a><br>

</p>
<h2>Links zu anderen Sites</h2>
<p>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Emicrosoft%2Ecom%2Fdata%2F">Aktuelle MDAC (ADO) Versionen</a><br>

</p>

<h2>Wenn Sie jetzt Fragen haben...</h2>
<p>
Wenn Sie Fragen rund um die in diesem Artikel vorgestellte Technologie haben, dann schauen Sie einfach bei uns
in den <a href="http://glengamoi.com/forums/">Community Foren der deutschen .NET Community</a> vorbei. Die Teilnehmer 
helfen Ihnen gerne, wenn Sie sich zur im Artikel vorgestellten Technologie weiterbilden m&ouml;chten.
</p>

<p>
<a href="http://glengamoi.com/forums/"><img src="../images/glengamoi.com_250.gif" width="250" height="80" alt="" border="0"></a>
</p>


<p>
Haben Sie Fragen die sich direkt auf den Inhalt des Artikels beziehen, dann schreiben Sie dem Autor! Unsere Autoren
freuen sich &uuml;ber Feedback zu ihren Artikeln. Ein einfacher Klick auf die <i>Autor kontaktieren</i>
Schaltfl&auml;che (weiter unten) und schon haben Sie ein f&uuml;r diesen Artikel personalisiertes Anfrageformular.
</p>

<p>&nbsp;</p>
<p>
Und zu guter Letzt m&ouml;chten wir Sie bitten, den Artikel zu bewerten. Damit helfen Sie uns, 
die Qualit&auml;t der Artikel zu verbessern - und anderen Lesern bei der Auswahl der Artikel,
die sie lesen sollten.
</p>

<FORM METHOD="POST" STYLE="margin-bottom: 0px;" NAME="formRating" ACTION="/service/bewerten.asp">
<INPUT TYPE="HIDDEN" NAME="ArticleId" VALUE="20010420" />
<CENTER>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
	<TD ALIGN="CENTER" VALIGN="MIDDLE" COLSPAN="7">Bewerten Sie diesen Artikel</TD>
</TR>
<TR>
	<TD><EM>&nbsp;Sehr gut&nbsp;</EM></TD>
	<TD><INPUT TYPE="radio" value="1" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="2" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="3" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="4" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="5" NAME="radioRating" /></TD>
	<TD ALIGN="right"><EM>&nbsp;Nicht gen&uuml;gend</EM></TD>
	<TD ROWSPAN="2" VALIGN="middle">&nbsp;<INPUT TYPE="submit" VALUE="Werten!" /></TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD ALIGN="CENTER">&nbsp;1</TD>
	<TD ALIGN="CENTER">&nbsp;2</TD>
	<TD ALIGN="CENTER">&nbsp;3</TD>
	<TD ALIGN="CENTER">&nbsp;4</TD>
	<TD ALIGN="CENTER">&nbsp;5</TD>
	<TD>&nbsp;</TD>
</TR>
</TABLE>
</FORM>
</center>
&nbsp;<P>
<center>
<p><table><tr><td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="pagetitle" value="Ein einfacher Query Analyzer"><input type="hidden" name="pageurl" value="http://www.aspheute.com/artikel/20010420.htm"><input type="image" src="../images/layout/senden.png" width="107" height="20" border="0" alt="Schicken Sie diese Seite einem Freund!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="Author" value="Christian Holm"><input type="hidden" name="AuthorEmail" value="office@holmcs.com"><input type="hidden" name="Artikel" value="20010420"><input type="image" src="../images/layout/kontakt.png" width="107" height="20" border="0" alt="Kontaktieren Sie den Autor!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top><a href="../PrinterFriendly/20010420.htm"><img src="../images/layout/druck.png" width="118" height="20" border="0" alt="F&uuml;r Ausdruck optimierte Seite"></a></td>
</tr></table></p>
</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
