<HTML>
<HEAD>
<TITLE>Ein G&auml;stebuch in ASP erstellen - Teil 1</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="7 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="Lernen sie die Datenbank f&uuml;r ein G&auml;stebuch zu erstellen. Bauen sie ein Eingabeformular, und speichern sie die &uuml;berpr&uuml;ften Daten in die Datenbank.">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,ADO,ASP,Gästebuch,Guestbook,Sourcecode,Datenbank,AspGerman">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff"  BACKGROUND="../images/layout/aspheutemainbg.gif" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<MAP NAME="titlebar">
<!--<AREA SHAPE=RECT COORDS="116,46,191,61" HREF="http://www.aspaktuell.com" ALT="ASP Aktuell">-->
<!--<AREA SHAPE=RECT COORDS="192,46,255,61" HREF="http://www.aspwelt.com" ALT="ASP Welt">-->
<AREA SHAPE=RECT COORDS="256,46,432,61" HREF="http://www.aspgerman.com/aspgerman/" ALT="ASP German">
<AREA SHAPE=RECT COORDS="115,15,269,42" HREF="../default.htm" ALT="Homepage">
<AREA SHAPE=RECT COORDS="278,26,587,42" HREF="../default.htm" ALT="Homepage">
</MAP>

<div style="position:absolute;left:0px;top:30px">
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td background="../images/layout/aspheutetitle.gif">
<img src="../images/layout/blind.gif" width="715" height="73" usemap="#titlebar" border="0">
</td>
<td width="100%" background="../images/layout/aspheutetitleext.gif">
&nbsp;
</td>
<td background="../images/layout/aspheutetitleend.gif">
<img src="../images/layout/blind.gif" width="25" height="1">
</td>
</tr>
</table>
</div>

<div style="position:absolute;left:1px;top:115px">
<table width="110" border="0" cellspacing="0" cellpadding="0">
<tr><td width="110"><img src="../Images/spacer.gif" width="110" height="1" alt="" border="0"></td></tr>
<tr>
<td background="../images/layout/aspheuteheader.gif" class="header" height=16 width="110">
<p>Liste</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">

<p class="content">
<a href="../kategorien/dotNET%202dot0.htm">.NET 2.0 (1)</a><br>
<a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein (16)</a><br>
<a href="../kategorien/dotNET%20Fu.htm">.NET Fu (5)</a><br>
<a href="../kategorien/ADOdotNET.htm">ADO.NET (11)</a><br>
<a href="../kategorien/Aprilscherz.htm">Aprilscherz (3)</a><br>
<a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen (44)</a><br>
<a href="../kategorien/ASP%20Tricks.htm">ASP Tricks (83)</a><br>
<a href="../kategorien/ASPdotNET.htm">ASP.NET (44)</a><br>
<a href="../kategorien/ASPIntranetdotde.htm">ASPIntranet.de (5)</a><br>
<a href="../kategorien/Csharp.htm">C# (28)</a><br>
<a href="../kategorien/Datenbank.htm">Datenbank (44)</a><br>
<a href="../kategorien/Dokumentation.htm">Dokumentation (4)</a><br>
<a href="../kategorien/IIS%206dot0.htm">IIS 6.0 (1)</a><br>
<a href="../kategorien/Komponenten.htm">Komponenten (29)</a><br>
<a href="../kategorien/Optimierung.htm">Optimierung (10)</a><br>
<a href="../kategorien/Server.htm">Server (21)</a><br>
<a href="../kategorien/Sicherheit.htm">Sicherheit (34)</a><br>
<a href="../kategorien/Tee%20Off.htm">Tee Off (6)</a><br>
<a href="../kategorien/VBdotNET.htm">VB.NET (6)</a><br>
<a href="../kategorien/WAP.htm">WAP (8)</a><br>
<a href="../kategorien/Web%20Services.htm">Web Services (11)</a><br>
<a href="../kategorien/XML.htm">XML (9)</a><br>


<br>
<a href="/syndication/rss.xml"><img src="../Images/rss_small.png" width="25" height="10" alt="RSS 2.0 - Die neuesten f&uuml;nf Artikel auf AspHeute.com" border="0"></a>

</p><!-- </p> remains -->


<br>

</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearch.gif" class="header" height=16 width="110">
<p>Suchen</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearchext.gif" class="header" width="110">
<form class="content" ACTION="REMOVED" METHOD="GET">
<div>
<input class="Newsletter" type="text" size="10" name="CiRestriction">
<span class="spacer2"><br></span>
<span class="spacer4"><br></span>
<INPUT TYPE="HIDDEN" NAME="CiMaxRecordsPerPage" VALUE="10">
<INPUT TYPE="HIDDEN" NAME="CiSort" VALUE="rank[d]">
<INPUT TYPE="HIDDEN" NAME="HTMLQueryForm" VALUE="../default.htm">
<img src="../images/layout/blind.gif" width="41" height="1"><input type="image" src="../images/layout/aspheutesearchenter.gif" border="0" width="49" height="14"><br>
<span class="spacer4"><br></span>
</div>
</form>
</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">
<p class="content">
<a href="/REMOVED/" title="Our most popular articles translated into English">English Articles</a><br>
<a href="/REMOVED/" title="Visit our Chinese content section">Chinese Articles</a><br>
<a href="../autoren/UnsereAutoren.htm" title="Unsere Autoren">Unsere Autoren</a><br>
&nbsp;<br>
<a href="/REMOVED/link2us.asp" title="Setzen Sie einen Link zu AspHeute!">Link zu AspHeute</a><br>
<a href="/REMOVED/impressum.asp" title="Das Impressum von AspHeute">Impressum</a><br>
<a href="/REMOVED/advertise.asp" title="Werben auch Sie auf AspHeute">Werben</a><br>
<a href="/REMOVED/kontakt.asp" title="Teilen Sie uns Ihre W&uuml;nsche, Beschwerden und Anregungen mit">Anfragen</a><br>
</p>
</td>
</tr>
</table>
</div>



<!-- Content starts here  -->
<div style="position:absolute;left:120px;top:108px">
<table cellspacing="0" cellpadding="0"><!--Tabelle aussen-->
<tr><!--Tabelle aussen, 1/2-->
<td><!--Tabelle aussen, 1/1-->
    <table border=0 align=center><tr><td align=center>


</td></tr></table>

<H1>Ein G&auml;stebuch in ASP erstellen - Teil 1</H1>
<p>
Geschrieben von: <a href="../autoren/christophwille.htm">Christoph Wille</a><br>
Kategorie: <a href="../kategorien/Datenbank.htm">Datenbank</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20000331"></SCRIPT>
</p>
<p>
Willkommen zum ersten Artikel in einer Serie von insgesamt drei. Das Ziel ist es, am Ende der Serie ein voll funktionsf&auml;higes
G&auml;stebuch mit ASP und ADO zu erstellen. Im ersten Artikel besch&auml;ftigen wir uns mit dem Datenbankdesign
und dem Erstellen eines Eintrages in das G&auml;stebuch (Teil 2 behandelt dann die Ausgabe, und Teil 3 die 
Administration des G&auml;stebuchs).
</p>
<p>
Bevor ich mit dem Datenbankdesign beginne, 
sehen wir uns einmal ein typisches Eingabeformular f&uuml;r ein G&auml;stebuch an:
</p>
<p>
<IMG SRC="Bilder/200003/20000331_2.png" width="581" height="475" alt="Eingabeformular" border="0">
</p>
<p>
Der Benutzer mu&szlig; Name und Emailadresse angeben, die Angabe der Homepage beziehungsweise eines 
Kommentars ist freiwillig. Um das Formular einfach zu halten, habe ich auf die &Uuml;berpr&uuml;fung der
Eingabe vor dem Abschicken des Formulars an den Server verzichtet, man kann dies allerdings leicht
zum <a href="20000331_code1.htm" target="_blank">Sourcecode</a> mittels JavaScript Routinen
anf&uuml;gen.
</p>
<p>
Auf diesem Bildschirmphoto sind bereits vier Felder zu sehen, die in der Datenbank ebenfalls abgelegt
werden m&uuml;ssen: Name, Emailadresse, Homepage und Kommentar. 
</p>
<p>
Neben diesen explizit abgefragten 
Benutzereingaben kann man allerdings auch einiges an implizit &uuml;ber den Benutzer erhaltenen Information
ablegen. So zum Beispiel schickt jeder Browser seine Kennung (User Agent Header) mit, aus der der
Hersteller, die Version sowie das verwendete Betriebssystem mit Hilfe der BrowserType Komponente
ermittelt werden kann.
</p>
<p>
Weiters erh&auml;lt man noch die IP Adresse des Client Computers mitgeteilt (Achtung: dies k&ouml;nnte auch ein
Proxy Server sein!). Als letzte verwertbare Information bleibt dann noch das aktuelle Datum des Servers,
allerdings sollte man hier darauf vorbereitet sein, eine Korrektur auf Grund der Zeitzonen 
vorzunehmen.
</p>
<p>
Damit ergibt sich folgendes Design f&uuml;r die Tabelle <b>Guestbook</b>:
</p>
<p>
<IMG SRC="Bilder/200003/20000331_1.png" width="274" height="226" alt="Tabelle Guestbook" border="0">
</p>
<p>
Die Felder sind von ihren Namen klar identifizierbar, allerdings d&uuml;rften bei einigen Datentypen
Fragen auftreten, so zum Beispiel bei <i>EntryDate</i> (Datum des Eintrags). Warum speichere ich das 
nicht als Datumstyp, sondern als Text? Der Grund ist, da&szlig; ich das Datum nicht zum Sortieren brauche
(daf&uuml;r reicht <i>IdField</i>), und ich es somit bereits korrekt formatiert in der Datenbank ablegen kann,
was mich unabh&auml;ngig von der Landeseinstellung des Webservers macht (man k&ouml;nnte es Faulheit nennen).
</p>
<p>
Die IP Adresse habe ich in vier Felder des Types <b>Byte</b> zerlegt, womit nur 4 Byte Speicherplatz 
verbraucht werden. H&auml;tte ich im Gegensatz dazu die IP Adresse (192.192.192.192) als Textfeld 
gespeichert, w&auml;re der Speicherplatzverbrauch 15 Byte gewesen - 11 Byte gespart.
</p>
<p>
Das letzte Feld <i>IsEntryLive</i> wird in der Implementierung des G&auml;stebuchs im Moment nicht verwendet,
allerdings k&ouml;nnte man es dazu verwenden, einen Eintrag erst nach Pr&uuml;fung durch den Administrator
freizuschalten. In der Datenbank ist der Standardwert True vorgegeben.
</p>
<p>
Jetzt, da die Datenbank fertig ist, k&ouml;nnen wir uns Gedanken machen, was passieren soll, wenn der
Benutzer Daten eingibt und das Formular abschickt. Dazu habe ich eine kleine Process flow Graphik
gezeichnet:
</p>
<p>
<IMG SRC="Bilder/200003/20000331_3.png" width="517" height="205" alt="Process flow" border="0">
</p>
<p>
Das Eingabeformular <i>signupform.htm</i> ist statisch und f&uuml;hrt keine serverseitigen Aktionen durch.
Die ASP Datei, auf die die eingegebenen Daten gepostet werden (<i>signup.asp</i>), hat allerdings
sehr viele Aufgaben zu erledigen. Im ersten Schritt wird kontrolliert, ob der Benutzer plausible Daten
eingeben hat - und wenn nicht, ihn auffordert, die fehlenden/falschen Daten einzugeben. Nach dieser
Erstkontrolle postet signup.asp auf sich selbst, und f&uuml;hrt die Einf&uuml;geoperation in die Datenbank durch.
</p>
<p>
Der <a href="20000331_code1.htm" target="_blank">Code f&uuml;r signupform.htm</a> ist simpel, der <a href="20000331_code2.htm" target="_blank">Code f&uuml;r signup.asp</a>
bedarf allerdings einiger Erkl&auml;rungen. 
</p>
<p>
Zuerst werden alle Felder ausgelesen (Zeilen 13 bis 18), und dann einer einfachen - leicht f&uuml;r 
eigene Zwecke erweiterbaren - &Uuml;berpr&uuml;fung unterzogen (Zeile 21). Eine Zeile vorher allerdings findet
die &Uuml;berpr&uuml;fung statt, ob dies jetzt der Datenkontrolldurchlauf ist, oder das Einf&uuml;gen in die Datenbank
durchgef&uuml;hrt werden soll (<i>strFinal</i>). Der Teil der Datenkontrolle zieht sich von Zeile 21 bis
45, der Teil f&uuml;r die Einf&uuml;geoperation in die Datenbank von Zeile 47 bis 94.
</p>
<p>
Der Datenkontrolldurchlauf beeinhaltet keine nennenswerten Tricks, in dieser Hinsicht interessanter
ist die Einf&uuml;geoperation. Zuerst wird mit Hilfe des <b>BrowserType</b> Objekts der Browser und das
Betriebssystem ermittelt. Wichtig zu beachten ist, da&szlig; das BrowserType Objekt diese Daten nur dann
bereitstellen kann, wenn es den Browser kennt - dies bedeutet, er mu&szlig; in der Datei <b>browscap.ini</b>
definiert sein (aktuelle Versionen dieser Datei findet man bei AspTracker.com - ein Link
befindet sich am Ende des Artikels).
</p>
<p>
Das Datum wird mit Hilfe der <i>DatePart</i> Funktion in Zeile 55 zusammengebaut, und danach folgt ein
Block (58-63), der die Felder auf die richtige L&auml;nge k&uuml;rzt (sonst gibt es Einf&uuml;gefehler in die Datenbank).
Darauf folgend wird die IP Adresse in vier Blocks zerlegt, und zwar mit Hilfe der <i>Split</i> Funktion aus
VBScript.
</p>
<p>
Um das Einf&uuml;gen in die Datenbank angenehm zu gestalten, habe ich ein Recordset Objekt ge&ouml;ffnet. Dieses
hat allerdings eine spezielle Eigenschaft - es kann keine Zeilen aufweisen, da das <i>WHERE</i> Statement
mit <b>IdField-1</b> niemals erf&uuml;llt sein kann (AutoNumber Felder beginnen bei 1). Der Sinn und Zweck
eines leeren Recordsets besteht darin, da&szlig; es sehr schnell ge&ouml;ffnet wird, speziell wenn die Anzahl der
Eintr&auml;ge in das G&auml;stebuch steigt.
</p>
<p>
Zum Schlu&szlig; bleibt mir nur noch die Funktion <b>SafeHtmlEncode</b> zu erw&auml;hnen - diese macht ihrem 
Namen alle Ehre, da <i>Server.HtmlEncode</i> bei Null-Werten einen Fehler produziert, und diese Funktion nichts
anderes macht, als diesen Fehler zu verhindern. 
</p>
<p>
Damit w&uuml;nsche ich ihnen auch schon viel Spa&szlig; beim
Ausprobieren des Sourcecodes, und ich hoffe wir lesen uns wieder beim 2 Artikel der G&auml;stebuchserie.
</p>
<h2>Download des Codes</h2>
<p><a href="../Code/20000331.zip">Klicken Sie hier</a>, um den Download zu starten.</p>
<h2>Verwandte Artikel</h2>
<p>
<a href="20000403.htm">Ein G&auml;stebuch in ASP erstellen - Teil 2</a><br>
<a href="20000404.htm">Ein G&auml;stebuch in ASP erstellen - Teil 3</a><br>

</p>
<h2>Links zu anderen Sites</h2>
<p>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Easptracker%2Ecom">browscap.ini Update</a><br>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Easpgerman%2Ecom%2Faspgerman%2Fguestbook%2F">Live Gästebuch</a><br>

</p>

<h2>Wenn Sie jetzt Fragen haben...</h2>
<p>
Wenn Sie Fragen rund um die in diesem Artikel vorgestellte Technologie haben, dann schauen Sie einfach bei uns
in den <a href="http://glengamoi.com/forums/">Community Foren der deutschen .NET Community</a> vorbei. Die Teilnehmer 
helfen Ihnen gerne, wenn Sie sich zur im Artikel vorgestellten Technologie weiterbilden m&ouml;chten.
</p>

<p>
<a href="http://glengamoi.com/forums/"><img src="../images/glengamoi.com_250.gif" width="250" height="80" alt="" border="0"></a>
</p>


<p>
Haben Sie Fragen die sich direkt auf den Inhalt des Artikels beziehen, dann schreiben Sie dem Autor! Unsere Autoren
freuen sich &uuml;ber Feedback zu ihren Artikeln. Ein einfacher Klick auf die <i>Autor kontaktieren</i>
Schaltfl&auml;che (weiter unten) und schon haben Sie ein f&uuml;r diesen Artikel personalisiertes Anfrageformular.
</p>

<p>&nbsp;</p>
<p>
Und zu guter Letzt m&ouml;chten wir Sie bitten, den Artikel zu bewerten. Damit helfen Sie uns, 
die Qualit&auml;t der Artikel zu verbessern - und anderen Lesern bei der Auswahl der Artikel,
die sie lesen sollten.
</p>

<FORM METHOD="POST" STYLE="margin-bottom: 0px;" NAME="formRating" ACTION="/service/bewerten.asp">
<INPUT TYPE="HIDDEN" NAME="ArticleId" VALUE="20000331" />
<CENTER>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
	<TD ALIGN="CENTER" VALIGN="MIDDLE" COLSPAN="7">Bewerten Sie diesen Artikel</TD>
</TR>
<TR>
	<TD><EM>&nbsp;Sehr gut&nbsp;</EM></TD>
	<TD><INPUT TYPE="radio" value="1" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="2" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="3" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="4" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="5" NAME="radioRating" /></TD>
	<TD ALIGN="right"><EM>&nbsp;Nicht gen&uuml;gend</EM></TD>
	<TD ROWSPAN="2" VALIGN="middle">&nbsp;<INPUT TYPE="submit" VALUE="Werten!" /></TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD ALIGN="CENTER">&nbsp;1</TD>
	<TD ALIGN="CENTER">&nbsp;2</TD>
	<TD ALIGN="CENTER">&nbsp;3</TD>
	<TD ALIGN="CENTER">&nbsp;4</TD>
	<TD ALIGN="CENTER">&nbsp;5</TD>
	<TD>&nbsp;</TD>
</TR>
</TABLE>
</FORM>
</center>
&nbsp;<P>
<center>
<p><table><tr><td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="pagetitle" value="Ein G&auml;stebuch in ASP erstellen - Teil 1"><input type="hidden" name="pageurl" value="http://www.aspheute.com/artikel/20000331.htm"><input type="image" src="../images/layout/senden.png" width="107" height="20" border="0" alt="Schicken Sie diese Seite einem Freund!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="Author" value="Christoph Wille"><input type="hidden" name="AuthorEmail" value="christophw@alphasierrapapa.com"><input type="hidden" name="Artikel" value="20000331"><input type="image" src="../images/layout/kontakt.png" width="107" height="20" border="0" alt="Kontaktieren Sie den Autor!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top><a href="../PrinterFriendly/20000331.htm"><img src="../images/layout/druck.png" width="118" height="20" border="0" alt="F&uuml;r Ausdruck optimierte Seite"></a></td>
</tr></table></p>
</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
