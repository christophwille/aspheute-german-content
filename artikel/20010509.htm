<HTML>
<HEAD>
<TITLE>Neue Inhalte einer Web Site f&uuml;r den Benutzer hervorheben</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="7 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="Es gibt bestimmte Web Sites, auf die wir regelm&auml;&szlig;ig zugreifen. Gerade hier ist es von Vorteil auf den ersten Blick zu sehen, welche Beitr&auml;ge neu und welche schon bekannt sind.">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,Cookie,Cookies,Hervorhebung,Aktuelle News,Newsflash">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff"  BACKGROUND="../images/layout/aspheutemainbg.gif" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<MAP NAME="titlebar">
<!--<AREA SHAPE=RECT COORDS="116,46,191,61" HREF="http://www.aspaktuell.com" ALT="ASP Aktuell">-->
<!--<AREA SHAPE=RECT COORDS="192,46,255,61" HREF="http://www.aspwelt.com" ALT="ASP Welt">-->
<AREA SHAPE=RECT COORDS="256,46,432,61" HREF="http://www.aspgerman.com/aspgerman/" ALT="ASP German">
<AREA SHAPE=RECT COORDS="115,15,269,42" HREF="../default.htm" ALT="Homepage">
<AREA SHAPE=RECT COORDS="278,26,587,42" HREF="../default.htm" ALT="Homepage">
</MAP>

<div style="position:absolute;left:0px;top:30px">
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td background="../images/layout/aspheutetitle.gif">
<img src="../images/layout/blind.gif" width="715" height="73" usemap="#titlebar" border="0">
</td>
<td width="100%" background="../images/layout/aspheutetitleext.gif">
&nbsp;
</td>
<td background="../images/layout/aspheutetitleend.gif">
<img src="../images/layout/blind.gif" width="25" height="1">
</td>
</tr>
</table>
</div>

<div style="position:absolute;left:1px;top:115px">
<table width="110" border="0" cellspacing="0" cellpadding="0">
<tr><td width="110"><img src="../Images/spacer.gif" width="110" height="1" alt="" border="0"></td></tr>
<tr>
<td background="../images/layout/aspheuteheader.gif" class="header" height=16 width="110">
<p>Liste</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">

<p class="content">
<a href="../kategorien/dotNET%202dot0.htm">.NET 2.0 (1)</a><br>
<a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein (16)</a><br>
<a href="../kategorien/dotNET%20Fu.htm">.NET Fu (5)</a><br>
<a href="../kategorien/ADOdotNET.htm">ADO.NET (11)</a><br>
<a href="../kategorien/Aprilscherz.htm">Aprilscherz (3)</a><br>
<a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen (44)</a><br>
<a href="../kategorien/ASP%20Tricks.htm">ASP Tricks (83)</a><br>
<a href="../kategorien/ASPdotNET.htm">ASP.NET (44)</a><br>
<a href="../kategorien/ASPIntranetdotde.htm">ASPIntranet.de (5)</a><br>
<a href="../kategorien/Csharp.htm">C# (28)</a><br>
<a href="../kategorien/Datenbank.htm">Datenbank (44)</a><br>
<a href="../kategorien/Dokumentation.htm">Dokumentation (4)</a><br>
<a href="../kategorien/IIS%206dot0.htm">IIS 6.0 (1)</a><br>
<a href="../kategorien/Komponenten.htm">Komponenten (29)</a><br>
<a href="../kategorien/Optimierung.htm">Optimierung (10)</a><br>
<a href="../kategorien/Server.htm">Server (21)</a><br>
<a href="../kategorien/Sicherheit.htm">Sicherheit (34)</a><br>
<a href="../kategorien/Tee%20Off.htm">Tee Off (6)</a><br>
<a href="../kategorien/VBdotNET.htm">VB.NET (6)</a><br>
<a href="../kategorien/WAP.htm">WAP (8)</a><br>
<a href="../kategorien/Web%20Services.htm">Web Services (11)</a><br>
<a href="../kategorien/XML.htm">XML (9)</a><br>


<br>
<a href="/syndication/rss.xml"><img src="../Images/rss_small.png" width="25" height="10" alt="RSS 2.0 - Die neuesten f&uuml;nf Artikel auf AspHeute.com" border="0"></a>

</p><!-- </p> remains -->


<br>

</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearch.gif" class="header" height=16 width="110">
<p>Suchen</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearchext.gif" class="header" width="110">
<form class="content" ACTION="REMOVED" METHOD="GET">
<div>
<input class="Newsletter" type="text" size="10" name="CiRestriction">
<span class="spacer2"><br></span>
<span class="spacer4"><br></span>
<INPUT TYPE="HIDDEN" NAME="CiMaxRecordsPerPage" VALUE="10">
<INPUT TYPE="HIDDEN" NAME="CiSort" VALUE="rank[d]">
<INPUT TYPE="HIDDEN" NAME="HTMLQueryForm" VALUE="../default.htm">
<img src="../images/layout/blind.gif" width="41" height="1"><input type="image" src="../images/layout/aspheutesearchenter.gif" border="0" width="49" height="14"><br>
<span class="spacer4"><br></span>
</div>
</form>
</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">
<p class="content">
<a href="/REMOVED/" title="Our most popular articles translated into English">English Articles</a><br>
<a href="/REMOVED/" title="Visit our Chinese content section">Chinese Articles</a><br>
<a href="../autoren/UnsereAutoren.htm" title="Unsere Autoren">Unsere Autoren</a><br>
&nbsp;<br>
<a href="/REMOVED/link2us.asp" title="Setzen Sie einen Link zu AspHeute!">Link zu AspHeute</a><br>
<a href="/REMOVED/impressum.asp" title="Das Impressum von AspHeute">Impressum</a><br>
<a href="/REMOVED/advertise.asp" title="Werben auch Sie auf AspHeute">Werben</a><br>
<a href="/REMOVED/kontakt.asp" title="Teilen Sie uns Ihre W&uuml;nsche, Beschwerden und Anregungen mit">Anfragen</a><br>
</p>
</td>
</tr>
</table>
</div>



<!-- Content starts here  -->
<div style="position:absolute;left:120px;top:108px">
<table cellspacing="0" cellpadding="0"><!--Tabelle aussen-->
<tr><!--Tabelle aussen, 1/2-->
<td><!--Tabelle aussen, 1/1-->
    <table border=0 align=center><tr><td align=center>


</td></tr></table>

<H1>Neue Inhalte einer Web Site f&uuml;r den Benutzer hervorheben</H1>
<p>
Geschrieben von: <a href="../autoren/fredericganner.htm">Frederic Ganner</a><br>
Kategorie: <a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20010509"></SCRIPT>
</p>
<p>
Es gibt bestimmte Web Sites, auf die wir regelm&auml;&szlig;ig zugreifen. Gerade hier ist es von Vorteil auf den ersten Blick zu 
sehen, welche Beitr&auml;ge neu und welche schon bekannt sind. Am einfachsten ist das mit Hilfe hervorhebender Grafiken zu 
erreichen  - vor allem farbliche Unterschiede erh&ouml;hen die Aufnahmegeschwindigkeit dieser relevanten Informationen 
um ein Vielfaches.
</p>

<IMG SRC="Bilder/200105/20010509_1.png" width="292" height="282" alt="" border="0">

<p>
Wie auf dem obigen Bild zu erkennen ist, werden jedem Beitrag eine der zwei charakteristischen Grafiken zugewiesen. 
Um zu entscheiden, ob der Benutzer den jeweiligen Datensatz schon kennt, m&uuml;ssen wir den Zeitpunkt, an dem der Beitrag 
erstellt wurde mit dem Zeitpunkt an dem der User die Seite zuletzt besucht hat vergleichen. Hierf&uuml;r speichern wir 
jedes Mal, wenn der User auf die Seite zugreift, die aktuelle Zeit in einen Cookie. Beim Durchlaufen der Datens&auml;tze 
findet schlie&szlig;lich der Abgleich der zwei Zeitpunkte statt, und es wird entschieden, welches Bild angezeigt wird.
</p>

<p>
Unser Vorgehen f&uuml;r den Code sieht demnach wie folgt aus:
</p>

<ul>
    <li>Auslesen des Cookies</li>
    <li>Erstellen des Recordset-Objekts</li>
    <li>Ausgeben der HTML-Seite mit den richtigen Grafiken</li>
</ul>

<h2>Auslesen des Cookies</h2>

<pre style="background='silver';">
&lt;% @LANGUAGE = "VBSCRIPT" %&gt;
&lt;% Option Explicit %&gt;
&lt;%
Const cstrCookieName = "visit"
Dim objCookieValue, dtLastVisit, bFirstVisit, strConnStr, Inhalte

objCookieValue = Request.Cookies(cstrCookieName)
If IsDate(objCookieValue) Then
    dtLastVisit = CDate(objCookieValue)
    bFirstVisit = False
Else
    ' dieser Fall tritt auch ein, wenn User Cookies nicht erlaubt
    dtLastVisit = CDate("1/1/1990")
    bFirstVisit = True
End If

Response.Cookies(cstrCookieName).Expires = DateAdd("d",365,Date())
Response.Cookies(cstrCookieName) = Now()
</pre>

<p>
Zuerst lesen wir den Cookie aus. Wenn der User schon einen Cookie besitzt, speichern wir den in ein Datum 
umgewandelten Wert in der Variable <i>dtLastVisit</i>. Ist der Besucher dagegen zum ersten Mal auf der Seite, wird die 
Variable <i>dtLastVisit</i> mit einem Datum, das weit in der Vergangenheit liegt, belegt. Somit erscheinen f&uuml;r 
Erstbesucher bei allen Beitr&auml;gen die "neu"-Grafiken. 
</p>

<p>
Da wir nun den ben&ouml;tigten Zeitpunkt in einer Variable gespeichert haben, &uuml;berschreiben wir den Cookie auf dem 
Client-Rechner mit der aktuellen Zeit, die wir dann beim n&auml;chsten Besuch verwenden k&ouml;nnen. Das gr&ouml;&szlig;te Problem bei 
diesem Feature sind die Datentypen der Datumsfelder. Bei der Verwendung von VBScript ist es m&ouml;glich den String aus 
dem Cookie in ein Datum-Objekt zu konvertieren. Bei JScript mu&szlig; man im schlimmsten Fall die Strings aufparsen und 
nacheinander von der Sekunde bis zum Jahr einzeln auswerten.
</p>

<h2>Erstellen des Recordset-Objekts</h2>

<p>
Dem heutigen Artikel liegt eine Beispieldatenbank bei, die fiktive Artikel speichert - und wir bauen f&uuml;r diese 
Artikel eine Seite &auml;hnlich zu bekannten Newssites auf, wo nur die Titel und das Erstellungsdatum angezeigt werden 
(das Beispiel kann leicht um Zusammenfassungen, Links usw. erweitert werden). Der folgende Code zeigt das Auslesen der 
Artikeltabelle:
</p>

<pre style="background='silver';">
strConnStr = "Provider=Microsoft.Jet.OLEDB.4.0;" &amp; _
      "Data Source=C:\yourpath\neueinhalte.mdb"

Set Inhalte = Server.CreateObject("ADODB.Recordset")
Inhalte.ActiveConnection = strConnStr
Inhalte.Source = "SELECT Titel, Zeit FROM Artikel ORDER BY ID DESC"
Inhalte.CursorType = 0
Inhalte.CursorLocation = 2
Inhalte.LockType = 3
Inhalte.Open
%&gt;
</pre>

<p>
In diesem Abschnitt wird ein Recordset-Objekt (<i>Inhalte</i>) erstellt, das die einzelnen Beitr&auml;ge und die Zeitpunkte 
der Erstellung enth&auml;lt. Die Datenbank enth&auml;lt neben den Spalten <i>Inhalt</i> und <i>Zeit</i> noch eine <i>ID</i>-Spalte, 
nach deren Werten die Datens&auml;tze absteigend (DESC) geordnet werden.
</p>

<h2>Anzeigen der korrekten Grafiken</h2>

<p>
Letzlich fehlt noch die Auswertung welchen Content der Web Seite der User noch nicht gesehen hat und welchen schon. 
Dies habe ich unter Zuhilfenahme von zwei selbst geschriebenen VBScript Funktionen 
(<i>ShowNewsImage</i> und <i>MyDateFormat</i>) gel&ouml;st:
</p>

<pre style="background='silver';">
&lt;HTML&gt;
&lt;BODY bgcolor="#999999"&gt;
&lt;p&gt;
&lt;%
If Not bFirstVisit Then
    Response.Write "Letzter Besuch am: " &amp; MyDateFormat(dtLastVisit)
Else
    Response.Write "Ihr erster Besuch auf der Seite!"
End If
%&gt;
&lt;/p&gt;
&lt;table cellspacing="2"&gt;	
&lt;%
While Not Inhalte.EOF
%&gt; 
 &lt;tr&gt;
  &lt;td&gt;
	&lt;img src="&lt;%=ShowNewsImage(Inhalte.Fields("Zeit"), dtLastVisit)%&gt;.gif" border="0"&gt;
  &lt;/td&gt;
  &lt;td&gt;
    &lt;%= Inhalte.Fields("Titel") %&gt;&lt;br>
  &lt;/td>
  &lt;td>
    &amp;nbsp;&amp;nbsp;Eintrag erstellt: &lt;%=MyDateFormat(Inhalte.Fields("Zeit")) %&gt;
  &lt;/td&gt;
 &lt;/tr&gt;
&lt;%
 Inhalte.MoveNext
Wend
Inhalte.Close
Set Inhalte = Nothing
%&gt;	
&lt;/table&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;
</pre>

<p>
In diesem Teil der Seite geben wir alle Datens&auml;tze des Recordsets in einer Tabelle aus. Weiters werden der Zeitpunkt 
aus dem Cookie (<i>dtLastVisit</i>) und der Zeitpunkt der Erstellung des Beitrags verglichen (<i>Inhalte.Fields("Zeit")</i>). 
Das geschieht durch die Funktion <i>ShowNewsImage</i>, welche in einem separaten VBScript Block zu finden ist:
</p>

<pre style="background='silver';">
&lt;script language="vbscript" runat="server"&gt;
Function ShowNewsImage(ByVal timeOfEntry, ByVal timeOfLastVisit)
 If timeOfEntry &gt; timeOfLastVisit Then
  ShowNewsImage = "neu"
 Else
  ShowNewsImage = "alt"
 End If
End Function

Function MyDateFormat(dtDate)
 If Not IsDate(dtDate) Then
   MyDateFormat = ""
 Else
   MyDateFormat = Day(dtDate) &amp; "." &amp; Month(dtDate) &amp; "." &amp; Year(dtDate)
 End If
End Function
&lt;/script&gt;
</pre>

<p>
Die <i>ShowNewsImage</i> Funktion erwartet zwei Zeitpunkte als Parameter. F&uuml;r alle Beitr&auml;ge deren Erstellungsdatum 
(<i>timeOfEntry</i>) gr&ouml;&szlig;er als das letzte Besuchsdatum (<i>timeOfLastVisit</i>) ist, wird der String "neu" in 
die Seite geschrieben, und umgekehrt. Die Icons, die wir f&uuml;r die Kennzeichnung verwenden, m&uuml;ssen deshalb in 
diesem Fall "neu.gif" bzw. "alt.gif" genannt werden, da der Dateiname f&uuml;r die jeweilige Grafik im ersten Teil 
des Sourcecodes so ermittelt wird (siehe <i>IMG</i>-Tag). 
</p>

<p>
Mit Hilfe der Funktion <i>MyDateFormat</i> wird zu guter Letzt noch das Datum an dem der Beitrag erstellt wurde einfach 
lesbar formatiert (=immer Deutsch, egal welcher Webserver) in die Seite geschrieben. Mit dem eigentlichen Feature 
hat dies aber nichts zu tun. Es dient in diesem Fall nur dazu, alte und neue Beitr&auml;ge voneinander zu unterscheiden.
</p>

<h2>Schlu&szlig;bemerkung</h2>

<p>
Wenn dieses Feature in ein Forum oder eine Newsseite eingebaut wird, hat diese sicherlich eine bessere Usability 
f&uuml;r Besucher, die die Site h&auml;ufig besuchen. Blicken wir &uuml;ber den Einsatz eines GIF-Bildes hinaus, ergeben sich viele 
weitere M&ouml;glichkeiten dieses Feature einzusetzen: von der Ver&auml;nderung der Stylesheets f&uuml;r die &Uuml;berschriften 
der neuen Artikel , bis hin zur kompletten Trennung des Layouts in "alte" und "neue" Beitr&auml;ge. 
</p>
<h2>Download des Codes</h2>
<p><a href="../Code/20010509.zip">Klicken Sie hier</a>, um den Download zu starten.</p>
<h2>Verwandte Artikel</h2>
<p>
<a href="20010306.htm">Dynamische Stylesheets</a><br>
<a href="20000907.htm">Einfacher Test, ob der Browser Cookies annimmt</a><br>
<a href="20000413.htm">Probleme beim Verarbeiten von Datumswerten</a><br>
<a href="20001004.htm">Sprache des Benutzers erkennen</a><br>

</p>

<h2>Wenn Sie jetzt Fragen haben...</h2>
<p>
Wenn Sie Fragen rund um die in diesem Artikel vorgestellte Technologie haben, dann schauen Sie einfach bei uns
in den <a href="http://glengamoi.com/forums/">Community Foren der deutschen .NET Community</a> vorbei. Die Teilnehmer 
helfen Ihnen gerne, wenn Sie sich zur im Artikel vorgestellten Technologie weiterbilden m&ouml;chten.
</p>

<p>
<a href="http://glengamoi.com/forums/"><img src="../images/glengamoi.com_250.gif" width="250" height="80" alt="" border="0"></a>
</p>


<p>
Haben Sie Fragen die sich direkt auf den Inhalt des Artikels beziehen, dann schreiben Sie dem Autor! Unsere Autoren
freuen sich &uuml;ber Feedback zu ihren Artikeln. Ein einfacher Klick auf die <i>Autor kontaktieren</i>
Schaltfl&auml;che (weiter unten) und schon haben Sie ein f&uuml;r diesen Artikel personalisiertes Anfrageformular.
</p>

<p>&nbsp;</p>
<p>
Und zu guter Letzt m&ouml;chten wir Sie bitten, den Artikel zu bewerten. Damit helfen Sie uns, 
die Qualit&auml;t der Artikel zu verbessern - und anderen Lesern bei der Auswahl der Artikel,
die sie lesen sollten.
</p>

<FORM METHOD="POST" STYLE="margin-bottom: 0px;" NAME="formRating" ACTION="/service/bewerten.asp">
<INPUT TYPE="HIDDEN" NAME="ArticleId" VALUE="20010509" />
<CENTER>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
	<TD ALIGN="CENTER" VALIGN="MIDDLE" COLSPAN="7">Bewerten Sie diesen Artikel</TD>
</TR>
<TR>
	<TD><EM>&nbsp;Sehr gut&nbsp;</EM></TD>
	<TD><INPUT TYPE="radio" value="1" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="2" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="3" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="4" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="5" NAME="radioRating" /></TD>
	<TD ALIGN="right"><EM>&nbsp;Nicht gen&uuml;gend</EM></TD>
	<TD ROWSPAN="2" VALIGN="middle">&nbsp;<INPUT TYPE="submit" VALUE="Werten!" /></TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD ALIGN="CENTER">&nbsp;1</TD>
	<TD ALIGN="CENTER">&nbsp;2</TD>
	<TD ALIGN="CENTER">&nbsp;3</TD>
	<TD ALIGN="CENTER">&nbsp;4</TD>
	<TD ALIGN="CENTER">&nbsp;5</TD>
	<TD>&nbsp;</TD>
</TR>
</TABLE>
</FORM>
</center>
&nbsp;<P>
<center>
<p><table><tr><td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="pagetitle" value="Neue Inhalte einer Web Site f&uuml;r den Benutzer hervorheben"><input type="hidden" name="pageurl" value="http://www.aspheute.com/artikel/20010509.htm"><input type="image" src="../images/layout/senden.png" width="107" height="20" border="0" alt="Schicken Sie diese Seite einem Freund!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="Author" value="Frederic Ganner"><input type="hidden" name="AuthorEmail" value="F.Ganner@technomad.de"><input type="hidden" name="Artikel" value="20010509"><input type="image" src="../images/layout/kontakt.png" width="107" height="20" border="0" alt="Kontaktieren Sie den Autor!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top><a href="../PrinterFriendly/20010509.htm"><img src="../images/layout/druck.png" width="118" height="20" border="0" alt="F&uuml;r Ausdruck optimierte Seite"></a></td>
</tr></table></p>
</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
