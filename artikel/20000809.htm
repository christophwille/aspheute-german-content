<HTML>
<HEAD>
<TITLE>Performance Monitoring a la .NET</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="7 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="In diesem Artikel zeigt der Autor, wie man mit ASP.NET und dem MS .NET Framework ein einfaches Web-basiertes Performance-Monitoring implementieren kann.">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,Performance Monitoring,performance counter,.NET,system.diagnostics,namespace,assembly,PerformanceCounter,PerformanceCounterCategory,ASP.NET">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff"  BACKGROUND="../images/layout/aspheutemainbg.gif" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<MAP NAME="titlebar">
<!--<AREA SHAPE=RECT COORDS="116,46,191,61" HREF="http://www.aspaktuell.com" ALT="ASP Aktuell">-->
<!--<AREA SHAPE=RECT COORDS="192,46,255,61" HREF="http://www.aspwelt.com" ALT="ASP Welt">-->
<AREA SHAPE=RECT COORDS="256,46,432,61" HREF="http://www.aspgerman.com/aspgerman/" ALT="ASP German">
<AREA SHAPE=RECT COORDS="115,15,269,42" HREF="../default.htm" ALT="Homepage">
<AREA SHAPE=RECT COORDS="278,26,587,42" HREF="../default.htm" ALT="Homepage">
</MAP>

<div style="position:absolute;left:0px;top:30px">
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td background="../images/layout/aspheutetitle.gif">
<img src="../images/layout/blind.gif" width="715" height="73" usemap="#titlebar" border="0">
</td>
<td width="100%" background="../images/layout/aspheutetitleext.gif">
&nbsp;
</td>
<td background="../images/layout/aspheutetitleend.gif">
<img src="../images/layout/blind.gif" width="25" height="1">
</td>
</tr>
</table>
</div>

<div style="position:absolute;left:1px;top:115px">
<table width="110" border="0" cellspacing="0" cellpadding="0">
<tr><td width="110"><img src="../Images/spacer.gif" width="110" height="1" alt="" border="0"></td></tr>
<tr>
<td background="../images/layout/aspheuteheader.gif" class="header" height=16 width="110">
<p>Liste</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">

<p class="content">
<a href="../kategorien/dotNET%202dot0.htm">.NET 2.0 (1)</a><br>
<a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein (16)</a><br>
<a href="../kategorien/dotNET%20Fu.htm">.NET Fu (5)</a><br>
<a href="../kategorien/ADOdotNET.htm">ADO.NET (11)</a><br>
<a href="../kategorien/Aprilscherz.htm">Aprilscherz (3)</a><br>
<a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen (44)</a><br>
<a href="../kategorien/ASP%20Tricks.htm">ASP Tricks (83)</a><br>
<a href="../kategorien/ASPdotNET.htm">ASP.NET (44)</a><br>
<a href="../kategorien/ASPIntranetdotde.htm">ASPIntranet.de (5)</a><br>
<a href="../kategorien/Csharp.htm">C# (28)</a><br>
<a href="../kategorien/Datenbank.htm">Datenbank (44)</a><br>
<a href="../kategorien/Dokumentation.htm">Dokumentation (4)</a><br>
<a href="../kategorien/IIS%206dot0.htm">IIS 6.0 (1)</a><br>
<a href="../kategorien/Komponenten.htm">Komponenten (29)</a><br>
<a href="../kategorien/Optimierung.htm">Optimierung (10)</a><br>
<a href="../kategorien/Server.htm">Server (21)</a><br>
<a href="../kategorien/Sicherheit.htm">Sicherheit (34)</a><br>
<a href="../kategorien/Tee%20Off.htm">Tee Off (6)</a><br>
<a href="../kategorien/VBdotNET.htm">VB.NET (6)</a><br>
<a href="../kategorien/WAP.htm">WAP (8)</a><br>
<a href="../kategorien/Web%20Services.htm">Web Services (11)</a><br>
<a href="../kategorien/XML.htm">XML (9)</a><br>


<br>
<a href="/syndication/rss.xml"><img src="../Images/rss_small.png" width="25" height="10" alt="RSS 2.0 - Die neuesten f&uuml;nf Artikel auf AspHeute.com" border="0"></a>

</p><!-- </p> remains -->


<br>

</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearch.gif" class="header" height=16 width="110">
<p>Suchen</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearchext.gif" class="header" width="110">
<form class="content" ACTION="REMOVED" METHOD="GET">
<div>
<input class="Newsletter" type="text" size="10" name="CiRestriction">
<span class="spacer2"><br></span>
<span class="spacer4"><br></span>
<INPUT TYPE="HIDDEN" NAME="CiMaxRecordsPerPage" VALUE="10">
<INPUT TYPE="HIDDEN" NAME="CiSort" VALUE="rank[d]">
<INPUT TYPE="HIDDEN" NAME="HTMLQueryForm" VALUE="../default.htm">
<img src="../images/layout/blind.gif" width="41" height="1"><input type="image" src="../images/layout/aspheutesearchenter.gif" border="0" width="49" height="14"><br>
<span class="spacer4"><br></span>
</div>
</form>
</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">
<p class="content">
<a href="/REMOVED/" title="Our most popular articles translated into English">English Articles</a><br>
<a href="/REMOVED/" title="Visit our Chinese content section">Chinese Articles</a><br>
<a href="../autoren/UnsereAutoren.htm" title="Unsere Autoren">Unsere Autoren</a><br>
&nbsp;<br>
<a href="/REMOVED/link2us.asp" title="Setzen Sie einen Link zu AspHeute!">Link zu AspHeute</a><br>
<a href="/REMOVED/impressum.asp" title="Das Impressum von AspHeute">Impressum</a><br>
<a href="/REMOVED/advertise.asp" title="Werben auch Sie auf AspHeute">Werben</a><br>
<a href="/REMOVED/kontakt.asp" title="Teilen Sie uns Ihre W&uuml;nsche, Beschwerden und Anregungen mit">Anfragen</a><br>
</p>
</td>
</tr>
</table>
</div>



<!-- Content starts here  -->
<div style="position:absolute;left:120px;top:108px">
<table cellspacing="0" cellpadding="0"><!--Tabelle aussen-->
<tr><!--Tabelle aussen, 1/2-->
<td><!--Tabelle aussen, 1/1-->
    <table border=0 align=center><tr><td align=center>


</td></tr></table>

<H1>Performance Monitoring a la .NET</H1>
<p>
Geschrieben von: <a href="../autoren/christophwille.htm">Christoph Wille</a><br>
Kategorie: <a href="../kategorien/ASPdotNET.htm">ASP.NET</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20000809"></SCRIPT>
</p>
<p>
Im Artikel <a href="20000428.htm">Einf&uuml;hrung in Performance Monitoring</a> habe ich 
grunds&auml;tzlich erkl&auml;rt, wie Performance Monitoring funktioniert. Im daran anschlie&szlig;enden Artikel
<a href="20000502.htm">Monitoring von ASP</a> ging es dann darum die Performance
Counter innerhalb einer ASP Seite auszulesen - mit Hilfe einer Komponente. 
</p>
<p>
Im heutigen Artikel werde ich Ihnen zeigen, um wieviel einfacher es in ASP.NET unter Zuhilfenahme des
<i>System.Diagnostics</i> Namespaces des .NET Frameworks geht. Keine externen Komponenten mehr, daf&uuml;r umso
mehr Funktionalit&auml;t. Man kann sogar Teile des NT Performance Monitors nachbauen, ohne wirklich viel Zeit
daf&uuml;r aufwenden zu m&uuml;ssen.
</p>
<p>
Voraussetzung um den Sourcecode dieses Artikels verwenden zu k&ouml;nnen ist eine Installation des Microsoft .NET Framework SDK's
auf einem Webserver. Weiters ist es von Vorteil, da&szlig; der Leser schon Grundkenntnisse bzw. Erfahrung in
Programmiertechniken besitzt - es finden sich etliche Artikel auf diesem Server, um das notwendige Wissen von Grund auf zu erlernen. 
</p>
<p>
Sicherheitshinweis: die Beispielannahme ist, da&szlig; der ASP.NET Worker Prozess unter dem SYSTEM Konto l&auml;uft
(standardm&auml;&szlig;ig l&auml;uft er unter dem ASPNET Account). Bitte &auml;ndern Sie <i>processModel</i> in <i>machine.config</i> entsprechend
ab, oder geben nur Administratoren Zugriff auf die Dateien (Impersonation).
</p>

<h2>Was ist das Ziel des Artikels?</h2>
<p>
Schauen Sie sich den folgenden Screenshot an, das ist die Add Counters Dialogbox des Performance
Monitors:
</p>

<IMG SRC="Bilder/200008/20000809_1.png" width="398" height="313" border="0" alt="">

<p>
In diesem Artikel m&ouml;chte ich Ihnen zeigen, wie man diese Dialogbox (fast) ident in ASP.NET nachprogrammieren
kann, ohne in die Tiefen der Windows Programmierung eintauchen zu m&uuml;ssen. Die einzig prominente
Auslassung ist die Auswahl des Computers, und zwar deswegen, weil man sich damit schnell Sicherheitsprobleme
einhandelt - da das Auslesen von Performance Countern mehr Rechte ben&ouml;tigt, als der anonyme Websiteuser
hat.
</p>


<h2>Die ersten Schritte</h2>
<p>
Starten wir also mit einem minimalen Beispiel. Dieses testet nur, ob ein spezifischer Counter in der 
Kategorie "ASP.NET" auf dem Rechner, auf dem es abl&auml;uft, installiert ist (<b>basictest.aspx</b>).
</p>

<pre style="background='silver';">
&lt;% @Page Language="C#" %&gt;
&lt;% @Import Namespace="System.Diagnostics" %&gt;
&lt;%
if ( !PerformanceCounterCategory.CounterExists("State Server Sessions Active", 
     "ASP.NET", ".") ) 
{
  Response.Write("No state server counters on this machine");
}
else
{
  Response.Write("State Server counter is available.");
}
%&gt;
</pre>

<p>
Hinweisen m&ouml;chte ich speziell auf das <i>@Import Namespace</i> Statement: dieses ben&ouml;tige ich, damit der Namespace
<i>System.Diagnostics</i> korrekt zu meiner ASP.NET Seite gebunden wird. Sonst kann ich das <i>PerformanceCounterCategory</i>
Objekt (hier die Klasse mit einer statischen Methode) nicht verwenden.
</p>

<h2>Kategorien abfragen</h2>
<p>
Gehen wir nun zu einem etwas umfangreicheren und funktionalerem Beispiel - das Auflisten aller
Performance Counter Kategorien in einer Drop Down Liste (<b>listcounters.aspx</b>).
</p>

<pre style="background='silver';">
&lt;% @Page Language=&quot;C#&quot; %&gt;
&lt;% @Import Namespace=&quot;System.Diagnostics&quot; %&gt;
&lt;% @Import Namespace=&quot;System.Collections&quot; %&gt;
&lt;script language=&quot;C#&quot; runat=&quot;server&quot;&gt;
void Page_Load(Object Src, EventArgs E) 
{
  if (!Page.IsPostBack)
  {
    ArrayList arrItems = new ArrayList();
    PerformanceCounterCategory[] arrCategories = 
	          PerformanceCounterCategory.GetCategories();
    for (int i=0; i &lt; arrCategories.Length;i++)
      arrItems.Add(arrCategories[i].CategoryName);
    Category.DataSource = arrItems;
    Category.DataBind();
  }
}
&lt;/script&gt;

&lt;html&gt;
&lt;body&gt;

&lt;h3&gt;Performance Counter Kategorien auflisten&lt;/h3&gt;

&lt;form runat=&quot;server&quot; method=&quot;post&quot;&gt;
Kategorie:  
&lt;asp:dropdownlist id=&quot;Category&quot; runat=&quot;server&quot;/&gt;
&lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre>

<p>
Z&auml;umen wir das Pferd von hinten auf, und zwar beim Formular: das ist ein Web Form, der nur eine
einzige Drop Down Liste beinhaltet. Diese hat den Namen <i>Category</i>, und ist leer. Woher kommen
also die Eintr&auml;ge in dieser Liste?
</p>
<p>
Gef&uuml;llt wird diese Drop Down im <i>Page_Load</i> Event. Dieses wird jedesmal aufgerufen, wenn die
Seite ausgef&uuml;hrt wird, also auch dann, wenn es sich bereits um einen Post Back mit Resultaten handelt.
Da der View State die Eintr&auml;ge f&uuml;r uns managt, kann man darauf verzichten, die Liste nochmals aufzuf&uuml;llen.
</p>
<p>
Der interessante Teil des Codes, der die Kategorien ausliest ist folgender:
</p>

<pre style="background='silver';">
PerformanceCounterCategory[] arrCategories = 
         PerformanceCounterCategory.GetCategories();
</pre>

<p>
Damit habe ich ein Array von <i>PerformanceCounterCategory</i> Objekten in der Hand, das in der Eigenschaft
<i>CategoryName</i> den Namen der Kategorie speichert. Und wie bekomme ich nun dieses Array in die Drop Down
Liste? Eine Brute-Force Variante zeigt dieser Code:
</p>

<pre style="background='silver';">
ArrayList arrItems = new ArrayList();
for (int i=0; i &lt; arrCategories.Length;i++)
      arrItems.Add(arrCategories[i].CategoryName);
Category.DataSource = arrItems;
Category.DataBind();
</pre>

<p>
Einfach das Array von <i>PerformanceCounterCategory</i> Objekten durchlaufen, die <i>CategoryName</i>'s herauskopieren
und in eine einfache <i>ArrayList</i> stecken. Diese kann als <i>DataSource</i> dem Drop Down zugewiesen werden, und mit
<i>DataBind</i> wird die Liste dann aufgef&uuml;llt.
</p>
<p>
Da&szlig; das Herumkopieren nicht wahnsinnig elegant geschweige denn performancef&ouml;rderlich ist, sieht man leicht.
In den n&auml;chsten Beispielen zeige ich dann, wie es schneller und besser geht, und wie einfach ASP.NET 
diesen Task f&uuml;r uns macht.
</p>

<h2>Hilfetexte zu Kategorien und Countern anzeigen</h2>
<p>
Gehen wir mit dem Beispiel einen Schritt weiter. Der Performance Monitor kann zu jeder Kategorie
als auch zu jedem Counter einen Hilfetext anzeigen. W&auml;re es nicht toll, wenn unsere Applikation das
auch k&ouml;nnte? Der folgende Code zeigt, wie man es f&uuml;r die Kategorien realisiert (<b>categoryhelp.aspx</b>).
</p>

<pre style="background='silver';">
&lt;% @Page Language=&quot;C#&quot; %&gt;
&lt;% @Import Namespace=&quot;System.Diagnostics&quot; %&gt;
&lt;% @Import Namespace=&quot;System.Collections&quot; %&gt;
&lt;script language=&quot;C#&quot; runat=&quot;server&quot;&gt;
void Page_Load(Object Src, EventArgs E) 
{
  if (!Page.IsPostBack)
  {
    PerformanceCounterCategory[] arrCategories = 
         PerformanceCounterCategory.GetCategories();
    Category.DataSource = arrCategories;
    Category.DataBind();
  }
}

void OnDisplayCategory(Object sender, EventArgs e)
{
  string strCategory = Category.SelectedItem.Value;
  PerformanceCounterCategory pcInfo = 
         new PerformanceCounterCategory(strCategory);
  Message.Text = pcInfo.CategoryHelp;
}
&lt;/script&gt;

&lt;html&gt;
&lt;body&gt;

&lt;h3&gt;Performance Counter Hilfe&lt;/h3&gt;

&lt;form runat=&quot;server&quot; method=&quot;post&quot;&gt;
Kategorie:  
&lt;asp:dropdownlist id=&quot;Category&quot; AutoPostBack=&quot;True&quot; 
    DataTextField=&quot;CategoryName&quot; DataValueField=&quot;CategoryName&quot;
      runat=server OnSelectedIndexChanged=&quot;OnDisplayCategory&quot;/&gt;

&lt;p&gt;&lt;b&gt;Hilfetext:&lt;/b&gt;&amp;nbsp;
&lt;asp:Label id=&quot;Message&quot; runat=&quot;server&quot; /&gt;
&lt;/p&gt;
&lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre>

<p>
Gut, fangen wir wieder von hinten an. Das Formular sieht jetzt bereits deutlich umfangreicher aus
als zuvor. Die wichtigsten &Auml;nderungen betreffen die Drop Down Liste: 
</p>

<ul>
	<li>Das <i>AutoPostBack</i> Attribut gibt an, da&szlig; wenn sich die Auswahl &auml;ndert, das Formular an den Server
	gepostet wird.
	<li>Passiert das, so wird am Server die Methode <i>OnDisplayCategory</i> aufgerufen, die im Attribut
	<i>OnSelectedIndexChanged</i> definiert ist
	<li>Last but not least haben wir die Attribute <i>DataTextField</i> und <i>DataValueField</i> - diese definieren,
	welche Eigenschaften auf den Items der <i>DataSource</i> aufgerufen werden sollen, um die Werte und Anzeigewerte
	auszulesen.
</ul>

<p>
Die letzten beiden Attribute sind unser Ticket zur Vereinfachung des <i>Page_Load</i> Codes: adieu zus&auml;tzliche
Collection, ASP.NET &uuml;bernimmt das jetzt alles f&uuml;r uns, und zwar ohne Umkopieren!
</p>

<pre style="background='silver';">
PerformanceCounterCategory[] arrCategories = 
         PerformanceCounterCategory.GetCategories();
Category.DataSource = arrCategories;
Category.DataBind();
</pre>

<p>
Das Event <i>OnDisplayCategory</i> ist im Grund sehr einfach gehalten. Die selektierte Kategorie wird
ausgelesen, damit ein <i>PerformanceCounterCategory</i> Objekt erstellt, und von diesem die <i>CategoryHelp</i>
Eigenschaft ausgelesen. Und um es dem Benutzer auch pr&auml;sentieren zu k&ouml;nnen, wird dieser String in
eine Label Control geschrieben (als <i>SPAN</i> Tag im Browser repr&auml;sentiert).
</p>
<p>
Damit haben wir allerdings erst einen Teil der Miete - die Performance Counter Kategorien. Ein 
Schritt weiter ist das Anzeigen der Counter f&uuml;r die jeweilige Kategorie, sowie der Hilfetexte
f&uuml;r die Counter. Da der Sourcecode daf&uuml;r doch etwas "l&auml;nglich" ist, kann man das
<a href="20000809_1.htm" target="_blank">Listing</a> hier betrachten
<a href="20000809_1.htm" target="_blank">(<b>fullhelp.aspx</b>)</a>.
</p>
<p>
Die wichtigste Neuerung ist eine Listbox f&uuml;r die Performance Counter:
</p>

<pre style="background='silver';">
&lt;asp:ListBox id=&quot;Counters&quot; Width=&quot;200px&quot; runat=&quot;server&quot; 
  DataTextField=&quot;CounterName&quot; DataValueField=&quot;CounterName&quot;
  AutoPostBack=&quot;True&quot; 
  runat=server OnSelectedIndexChanged=&quot;OnHelpCounter&quot;/&gt;
</pre>

<p>
Diese Listbox l&ouml;st ebenfalls ein <i>AutoPostBack</i> aus, und ich verwende wieder <i>DataTextField</i> und <i>DataValueField</i>
um die Werte hineinzuschreiben. Um das zum Laufen zu bringen, mu&szlig; ich nat&uuml;rlich den Code in 
<i>OnDisplayCategory</i> dahingehend adaptieren, da&szlig; auch die <i>Counters</i> Listbox mit Daten gef&uuml;llt wird,
nicht nur das Label mit der Hilfe &uuml;ber die Kategorie:
</p>

<pre style="background='silver';">
PerformanceCounter[] arrCntrs = pcInfo.GetCounters();
Counters.DataSource = arrCntrs;
Counters.DataBind();
</pre>

<p>
Zu guter Letzt mu&szlig; man noch den Hilfetext f&uuml;r den Counter anzeigen, und dies geschieht in <i>OnHelpCounter</i>:
</p>

<pre style="background='silver';">
void OnHelpCounter(Object sender, EventArgs e)
{
  string strCategory = Category.SelectedItem.Value;
  string strCounter = Counters.SelectedItem.Value;
  try
  {
    PerformanceCounter pcInfo = new PerformanceCounter(strCategory, strCounter);
    CounterHelp.Text = pcInfo.CounterHelp;
  }
  catch
  {
     // drop dead silently - mostly on category changes
  }
}
</pre>

<p>
Wie man sieht, nicht gerade "Magic", aber sehr effektiv. Man hat zwar sehr viele Roundtrips zum Server,
aber theoretisch k&ouml;nnte man mit versteckten SPAN's und Client-side Code arbeiten, um es Netzwerk-effizienter
zu machen.
</p>

<h2>Performance Counter Werte abfragen</h2>
<p>
Wir n&auml;hern uns unserem Ziel mit Riesenschritten - also was fehlt uns noch? Das prominenteste sind
die Instanzen der Counter. Instanzen f&uuml;r Counter werden f&uuml;r eine ganze Kategorie definiert, allerdings
hat nicht jeder Counter der Kategorie auch Instanzen. Ein Beispiel f&uuml;r Instanzen w&auml;re etwa die
<i>Processor</i> Kategorie, wo jeder Prozessor &uuml;ber eine Instanz angesprochen werden kann (oder
alle auf einmal).
</p>
<p>
Ebenso fehlt auf der Liste der To-Do's noch das Abfragen des Wertes des Performance Counters. Auch das habe ich 
in das Abschlu&szlig;beispiel eingebaut, das sich dem Anwender wie folgt pr&auml;sentiert:
</p>

<IMG SRC="Bilder/200008/20000809_2.png" width="594" height="384" border="0" alt="">

<p>
Aus &Uuml;bersichtlichkeitsgr&uuml;nden im Sourcecode habe ich den Code f&uuml;r die Hilfetexte herausgenommen,
damit man sich auf das Wesentliche konzentrieren kann. Zeilenm&auml;&szlig;ig gesehen ist das
<a href="20000809_2.htm" target="_blank">Listing</a> dennoch lange genug!
<a href="20000809_2.htm" target="_blank">(<b>querycounter.aspx</b>)</a>
</p>
<p>
Starten wir aus alter Gewohnheit "wieder mal" beim Formularcode:
</p>

<pre style="background='silver';">
&lt;form runat=&quot;server&quot; method=&quot;post&quot;&gt;
&lt;table width=&quot;400&quot;&gt;
&lt;tr&gt;&lt;td&gt;Kategorie:&lt;/td&gt;&lt;td&gt;Counter:&lt;/td&gt;&lt;td&gt;Instances&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;
&lt;asp:dropdownlist id=&quot;Category&quot;  AutoPostBack=&quot;True&quot; 
	DataTextField=&quot;CategoryName&quot; DataValueField=&quot;CategoryName&quot;
	runat=server OnSelectedIndexChanged=&quot;OnDisplayCategory&quot; /&gt;
&lt;/td&gt;&lt;td valign=&quot;top&quot;&gt;
&lt;asp:ListBox id=&quot;Counters&quot; Width=&quot;200px&quot; runat=&quot;server&quot; 
	DataTextField=&quot;CounterName&quot; DataValueField=&quot;CounterName&quot;
  	AutoPostBack=&quot;True&quot; 
	OnSelectedIndexChanged=&quot;OnCounterInfo&quot;/&gt;
&lt;/td&gt;&lt;td valign=&quot;top&quot;&gt;
&lt;asp:ListBox id=&quot;CounterInstances&quot; Width=&quot;100px&quot; runat=&quot;server&quot; /&gt;
&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
&lt;asp:button OnClick=&quot;SubmitBtn_Click&quot; text=&quot;Lookup&quot; runat=&quot;server&quot;/&gt;
&lt;/form&gt;
</pre>

<p>
Wie man sehen kann, ist eine weitere Listbox dazugekommen, und zwar f&uuml;r die etwaigen Instanzen eines
Counters. Sonst hat sich eigentlich nichts ge&auml;ndert. Ach ja, eine Schaltfl&auml;che namens "Lookup" ist dazugekommen,
die einen Postback ausl&ouml;st, der dann das Auslesen des Performance Counters triggert.
</p>
<p>
Was uns zum Event <i>OnCounterInfo</i> bringt - dieses hat so einige &Auml;nderungen &uuml;ber sich ergehen lassen
m&uuml;ssen:
</p>

<pre style="background='silver';">
void OnCounterInfo(Object sender, EventArgs e)
{
	string strCategory = Category.SelectedItem.Value;
	CounterInstances.Items.Clear();
	
	PerformanceCounterCategory pcCat = new PerformanceCounterCategory(strCategory);
	string[] arrInstanceNames = pcCat.GetInstanceNames();
	if (arrInstanceNames.GetLength(0) > 1)
	{
	  CounterInstances.DataSource = arrInstanceNames;
	  CounterInstances.DataBind();
	}
}
</pre>

<p>
Wie ich bereits ausgef&uuml;hrt habe, sind die Instanzen pro Kategorie definiert, allerdings mu&szlig; nicht
jeder Counter der Kategorie die Instanzen auch zur Verf&uuml;gung stellen - daher wird die 
<i>CounterInstances</i> Listbox nach Bedarf mit Werten gef&uuml;llt. Und ab diesem Zeitpunkt kann
man durch Klicken auf die Lookup Schaltfl&auml;che den aktuellen Wert ermitteln:
</p>

<pre style="background='silver';">
void SubmitBtn_Click(Object sender, EventArgs e) 
{
  string strCat = Category.SelectedItem.Value;
  string strCounter = Counters.SelectedItem.Value;
  string strInstance = "";
  
  if (CounterInstances.Items.Count > 0)
    strInstanceName = CounterInstances.SelectedItem.Value;
    
  PerformanceCounter pc = 
        new PerformanceCounter(strCat, strCounter, strInstance);

  float dResult = pc.NextValue();
  Message.Text = "&lt;" + strCat + "&gt; [" + strCounter + 
	               "] {" + strInstance + "} = " + dResult.ToString();
}
</pre>

<p>
Der &Uuml;bersichtlichkeit halber habe ich den Exception Handling Code herausgenommen (f&uuml;r Sicherheitsverletzungen
gedacht). Ein einziger Aufruf an <i>NextValue</i> liefert den aktuellen Wert zur&uuml;ck, und der wird dann dem
Benutzer pr&auml;sentiert. Damit w&auml;re unsere heutige Aufgabe erledigt.
</p>
<p>
Wer mit den Performance Countern in diesem Beispiel jetzt ein wenig herumspielt wird sehen, da&szlig; einige Werte nicht so sind
wie erwartet. Ich habe nat&uuml;rlich nicht die volle Funktionalit&auml;t aller Countertypen implementiert
(Prozent, Total, etc.). Wer das implementieren m&ouml;chte, der findet die notwendigen Informationen, wie man korrekt mit Performance Countern rechnet,
in der Hilfe des .NET Framework SDK unter folgendem Eintrag:
</p>

<IMG SRC="Bilder/200008/20000809_3.png" width="388" height="275" alt="" border="0">

<h2>Schlu&szlig;bemerkung</h2>
<p>
Im heutigen Artikel haben wir uns mit Performance Monitoring a la .NET besch&auml;ftigt, und ich hoffe
die Leistungsf&auml;higkeit anhand der trotzdem eigentlich simplen Beispiele ganz gut demonstriert zu haben.
Nehmen Sie sich die Zeit, und lesen in der Dokumentation &uuml;ber den Leistungsumfang des Performance
Monitorings nach!
</p>
<h2>Download des Codes</h2>
<p><a href="../Code/20000809.zip">Klicken Sie hier</a>, um den Download zu starten.</p>
<h2>Verwandte Artikel</h2>
<p>
<a href="20000811.htm">Ausgabe der Event Log Eintr&auml;ge a la ASP.NET</a><br>
<a href="20000808.htm">Einf&uuml;hrung in ASP.NET Web Forms</a><br>
<a href="20000428.htm">Einf&uuml;hrung in Performance Monitoring</a><br>
<a href="20000502.htm">Monitoring von ASP</a><br>
<a href="20011206.htm">Performancemessungen in .NET</a><br>
<a href="20000925.htm">Services &uuml;ber das Web managen</a><br>
<a href="20000814.htm">Webserver-Tuning mit XTune</a><br>

</p>
<h2>Links zu anderen Sites</h2>
<p>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Edotnetgerman%2Ecom%2Flisten%2FaspDEdotnet%2Easp">Die aspDEdotnet Diskussionsliste</a><br>

</p>

<h2>Wenn Sie jetzt Fragen haben...</h2>
<p>
Wenn Sie Fragen rund um die in diesem Artikel vorgestellte Technologie haben, dann schauen Sie einfach bei uns
in den <a href="http://glengamoi.com/forums/">Community Foren der deutschen .NET Community</a> vorbei. Die Teilnehmer 
helfen Ihnen gerne, wenn Sie sich zur im Artikel vorgestellten Technologie weiterbilden m&ouml;chten.
</p>

<p>
<a href="http://glengamoi.com/forums/"><img src="../images/glengamoi.com_250.gif" width="250" height="80" alt="" border="0"></a>
</p>


<p>
Eine weitere sehr hilfreiche Resource ist das <a href="http://aspxfiles.com/">deutsche ASP.NET Wiki</a>,
das als zentrale Anlaufstelle f&uuml;r Tips, Tricks, Know How und alles N&uuml;tzliche was man in seinem Alltag als 
(ASP).NET-Entwickler so braucht und entdeckt gedacht ist. 
</p>

<p>
Haben Sie Fragen die sich direkt auf den Inhalt des Artikels beziehen, dann schreiben Sie dem Autor! Unsere Autoren
freuen sich &uuml;ber Feedback zu ihren Artikeln. Ein einfacher Klick auf die <i>Autor kontaktieren</i>
Schaltfl&auml;che (weiter unten) und schon haben Sie ein f&uuml;r diesen Artikel personalisiertes Anfrageformular.
</p>

<p>&nbsp;</p>
<p>
Und zu guter Letzt m&ouml;chten wir Sie bitten, den Artikel zu bewerten. Damit helfen Sie uns, 
die Qualit&auml;t der Artikel zu verbessern - und anderen Lesern bei der Auswahl der Artikel,
die sie lesen sollten.
</p>

<FORM METHOD="POST" STYLE="margin-bottom: 0px;" NAME="formRating" ACTION="/service/bewerten.asp">
<INPUT TYPE="HIDDEN" NAME="ArticleId" VALUE="20000809" />
<CENTER>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
	<TD ALIGN="CENTER" VALIGN="MIDDLE" COLSPAN="7">Bewerten Sie diesen Artikel</TD>
</TR>
<TR>
	<TD><EM>&nbsp;Sehr gut&nbsp;</EM></TD>
	<TD><INPUT TYPE="radio" value="1" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="2" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="3" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="4" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="5" NAME="radioRating" /></TD>
	<TD ALIGN="right"><EM>&nbsp;Nicht gen&uuml;gend</EM></TD>
	<TD ROWSPAN="2" VALIGN="middle">&nbsp;<INPUT TYPE="submit" VALUE="Werten!" /></TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD ALIGN="CENTER">&nbsp;1</TD>
	<TD ALIGN="CENTER">&nbsp;2</TD>
	<TD ALIGN="CENTER">&nbsp;3</TD>
	<TD ALIGN="CENTER">&nbsp;4</TD>
	<TD ALIGN="CENTER">&nbsp;5</TD>
	<TD>&nbsp;</TD>
</TR>
</TABLE>
</FORM>
</center>
&nbsp;<P>
<center>
<p><table><tr><td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="pagetitle" value="Performance Monitoring a la .NET"><input type="hidden" name="pageurl" value="http://www.aspheute.com/artikel/20000809.htm"><input type="image" src="../images/layout/senden.png" width="107" height="20" border="0" alt="Schicken Sie diese Seite einem Freund!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="Author" value="Christoph Wille"><input type="hidden" name="AuthorEmail" value="christophw@alphasierrapapa.com"><input type="hidden" name="Artikel" value="20000809"><input type="image" src="../images/layout/kontakt.png" width="107" height="20" border="0" alt="Kontaktieren Sie den Autor!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top><a href="../PrinterFriendly/20000809.htm"><img src="../images/layout/druck.png" width="118" height="20" border="0" alt="F&uuml;r Ausdruck optimierte Seite"></a></td>
</tr></table></p>
</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
