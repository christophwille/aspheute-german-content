<HTML>
<HEAD>
<TITLE>MP3-Titelinformationen mit .NET auslesen</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="7 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="Das MP3-Format erfreut sich ungebrochener Beliebtheit, um die gesamte heimische Platten- und CD-Sammlung auf g&auml;ngige PC-Festplatten zu rippen. Dieser Artikel beschreibt, wie leicht man mit .NET die Titelinformationen auslesen kann.">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,MP3,ID3 Tags,Titelinformationen,Mp3File,Klasse,C#,Stream,File,Datei">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff"  BACKGROUND="../images/layout/aspheutemainbg.gif" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<MAP NAME="titlebar">
<!--<AREA SHAPE=RECT COORDS="116,46,191,61" HREF="http://www.aspaktuell.com" ALT="ASP Aktuell">-->
<!--<AREA SHAPE=RECT COORDS="192,46,255,61" HREF="http://www.aspwelt.com" ALT="ASP Welt">-->
<AREA SHAPE=RECT COORDS="256,46,432,61" HREF="http://www.aspgerman.com/aspgerman/" ALT="ASP German">
<AREA SHAPE=RECT COORDS="115,15,269,42" HREF="../default.htm" ALT="Homepage">
<AREA SHAPE=RECT COORDS="278,26,587,42" HREF="../default.htm" ALT="Homepage">
</MAP>

<div style="position:absolute;left:0px;top:30px">
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td background="../images/layout/aspheutetitle.gif">
<img src="../images/layout/blind.gif" width="715" height="73" usemap="#titlebar" border="0">
</td>
<td width="100%" background="../images/layout/aspheutetitleext.gif">
&nbsp;
</td>
<td background="../images/layout/aspheutetitleend.gif">
<img src="../images/layout/blind.gif" width="25" height="1">
</td>
</tr>
</table>
</div>

<div style="position:absolute;left:1px;top:115px">
<table width="110" border="0" cellspacing="0" cellpadding="0">
<tr><td width="110"><img src="../Images/spacer.gif" width="110" height="1" alt="" border="0"></td></tr>
<tr>
<td background="../images/layout/aspheuteheader.gif" class="header" height=16 width="110">
<p>Liste</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">

<p class="content">
<a href="../kategorien/dotNET%202dot0.htm">.NET 2.0 (1)</a><br>
<a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein (16)</a><br>
<a href="../kategorien/dotNET%20Fu.htm">.NET Fu (5)</a><br>
<a href="../kategorien/ADOdotNET.htm">ADO.NET (11)</a><br>
<a href="../kategorien/Aprilscherz.htm">Aprilscherz (3)</a><br>
<a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen (44)</a><br>
<a href="../kategorien/ASP%20Tricks.htm">ASP Tricks (83)</a><br>
<a href="../kategorien/ASPdotNET.htm">ASP.NET (44)</a><br>
<a href="../kategorien/ASPIntranetdotde.htm">ASPIntranet.de (5)</a><br>
<a href="../kategorien/Csharp.htm">C# (28)</a><br>
<a href="../kategorien/Datenbank.htm">Datenbank (44)</a><br>
<a href="../kategorien/Dokumentation.htm">Dokumentation (4)</a><br>
<a href="../kategorien/IIS%206dot0.htm">IIS 6.0 (1)</a><br>
<a href="../kategorien/Komponenten.htm">Komponenten (29)</a><br>
<a href="../kategorien/Optimierung.htm">Optimierung (10)</a><br>
<a href="../kategorien/Server.htm">Server (21)</a><br>
<a href="../kategorien/Sicherheit.htm">Sicherheit (34)</a><br>
<a href="../kategorien/Tee%20Off.htm">Tee Off (6)</a><br>
<a href="../kategorien/VBdotNET.htm">VB.NET (6)</a><br>
<a href="../kategorien/WAP.htm">WAP (8)</a><br>
<a href="../kategorien/Web%20Services.htm">Web Services (11)</a><br>
<a href="../kategorien/XML.htm">XML (9)</a><br>


<br>
<a href="/syndication/rss.xml"><img src="../Images/rss_small.png" width="25" height="10" alt="RSS 2.0 - Die neuesten f&uuml;nf Artikel auf AspHeute.com" border="0"></a>

</p><!-- </p> remains -->


<br>

</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearch.gif" class="header" height=16 width="110">
<p>Suchen</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearchext.gif" class="header" width="110">
<form class="content" ACTION="REMOVED" METHOD="GET">
<div>
<input class="Newsletter" type="text" size="10" name="CiRestriction">
<span class="spacer2"><br></span>
<span class="spacer4"><br></span>
<INPUT TYPE="HIDDEN" NAME="CiMaxRecordsPerPage" VALUE="10">
<INPUT TYPE="HIDDEN" NAME="CiSort" VALUE="rank[d]">
<INPUT TYPE="HIDDEN" NAME="HTMLQueryForm" VALUE="../default.htm">
<img src="../images/layout/blind.gif" width="41" height="1"><input type="image" src="../images/layout/aspheutesearchenter.gif" border="0" width="49" height="14"><br>
<span class="spacer4"><br></span>
</div>
</form>
</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">
<p class="content">
<a href="/REMOVED/" title="Our most popular articles translated into English">English Articles</a><br>
<a href="/REMOVED/" title="Visit our Chinese content section">Chinese Articles</a><br>
<a href="../autoren/UnsereAutoren.htm" title="Unsere Autoren">Unsere Autoren</a><br>
&nbsp;<br>
<a href="/REMOVED/link2us.asp" title="Setzen Sie einen Link zu AspHeute!">Link zu AspHeute</a><br>
<a href="/REMOVED/impressum.asp" title="Das Impressum von AspHeute">Impressum</a><br>
<a href="/REMOVED/advertise.asp" title="Werben auch Sie auf AspHeute">Werben</a><br>
<a href="/REMOVED/kontakt.asp" title="Teilen Sie uns Ihre W&uuml;nsche, Beschwerden und Anregungen mit">Anfragen</a><br>
</p>
</td>
</tr>
</table>
</div>



<!-- Content starts here  -->
<div style="position:absolute;left:120px;top:108px">
<table cellspacing="0" cellpadding="0"><!--Tabelle aussen-->
<tr><!--Tabelle aussen, 1/2-->
<td><!--Tabelle aussen, 1/1-->
    <table border=0 align=center><tr><td align=center>


</td></tr></table>

<H1>MP3-Titelinformationen mit .NET auslesen</H1>
<p>
Geschrieben von: <a href="../autoren/bjoernwaide.htm">Björn Waide</a><br>
Kategorie: <a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20030430"></SCRIPT>
</p>
<p>
St&auml;ndig eintrudelnde Pressemeldungen &uuml;ber Schlie&szlig;ungen von Peer-To-Peer Tauschb&ouml;rsen wie Napster und Co. hin oder her, das MP3-Format 
erfreut sich ungebrochener Beliebtheit. Die Kompressionsrate ist bei guter Audio-Qualit&auml;t hoch genug, um die gesamte heimische Platten- 
und CD-Sammlung auf g&auml;ngige PC-Festplatten zu rippen. Tagelanger Musik-Genuss ohne CD-Wechsel ist die Folge. Ohne die auf den CD-Covern 
abgedruckten Informationen &uuml;ber Titel, Interpret und Sonstigem kann man jedoch schnell den &Uuml;berblick &uuml;ber den Inhalt seiner Mega-Jukebox 
verlieren. Dankeswerterweise erlaubt es das MP3-Format, solche Informationen direkt mit in die Dateien zu schreiben. 
</p>
<p>
Dieser Artikel beschreibt, wie leicht man mit den Klassen des .NET-Frameworks diese Titelinformationen aus MP3-Dateien auslesen kann. 
Die Ergebnisse dieses kleinen HowTo's sind dem Artikel als Sourcecode beigelegt.
</p>

<h2>ID3 Tags</h2>
<p>
Um an die Meta-Daten zu einem MP3-File heranzukommen, mu&szlig; man als Erstes wissen, wo und wie sie abgelegt sind. Zur Zeit gibt es zwei 
Standards mit den Namen ID3v1 und ID3v2. Diese legen fest, an welcher Stelle in einer MP3-Datei und mit wieviel Bytes eine bestimmte 
Information, z.B. die &uuml;ber den Interpreten, abgelegt ist. In diesem Artikel wird ausschlie&szlig;lich auf die Version 1 dieses Standards 
eingegangen. Eine informelle &Uuml;bersicht findet sich in der nachstehenden Grafik.
</p>

<IMG SRC="Bilder/200304/20030430.png" width="221" height="240" alt="" border="0">

<p>
Im Anhang zur Spezifikation der aktuellen ID3 Version ID3v2.4.0 findet sich die genaue Definition. Die Informationen stehen, sofern sie 
vorhanden sind, in den letzten 128 Bytes einer MP3-Datei. Sie werden mit der Zeichenfolge "TAG" eingeleitet. Danach stehen in dieser 
Reihenfolge die interessierenden Daten:
</p>

<table>
<tr><td>Song title</td><td>30 Zeichen</td></tr>
<tr><td>Artist</td><td>30 Zeichen</td></tr>
<tr><td>Album</td><td>30 Zeichen</td></tr>
<tr><td>Year</td><td>4 Zeichen</td></tr>
<tr><td>Comment</td><td>30 Zeichen</td></tr>
<tr><td>Genre</td><td>1 Byte</td></tr>
</table>

<h2>Auslesen der Informationen</h2>
<p>
Mit diesem Wissen ausger&uuml;stet k&ouml;nnen wir uns daran wagen, das Ganze mit C# zu realisieren. Mit Hilfe der Klassen aus dem Namespace 
<i>System.IO</i> des .NET-Frameworks lesen wir zuerst die letzten 128 Byte der Datei aus. Dazu &ouml;ffnen wir in den Zeilen 1 und 2 des nachfolgenden 
Listings einen <i>Stream</i> auf die jeweilige Datei und "spulen" in Zeile 5 bis auf diese letzten Bytes vor. &Uuml;ber die Methode <i>Read</i> des 
Stream-Objektes lesen wir in Zeile 9 diese letzten 128 Bytes nun schrittweise in ein Byte-Array.
</p>

<pre style="background='silver';">
FileInfo file = new FileInfo(this.Filename);
Stream s = file.OpenRead();
 		
byte[] bytes = new byte[128];
s.Seek(-128, SeekOrigin.End);
int numBytesToRead = 128;
int numBytesRead = 0;
while (numBytesToRead &gt; 0) {
	int n = s.Read(bytes, numBytesRead, numBytesToRead);

	if (n==0) {
		break;
	}
	numBytesRead += n;
	numBytesToRead -= n;
}
s.Close();
</pre>

<h2>Parsen der ID3 Tags</h2>
<p>
Nachdem das geschafft ist, mu&szlig; der Inhalt dieses Byte-Arrays noch anhand der Angaben aus der ID3-Spezifikation "geparsed" werden. Aufgrund 
der festen L&auml;ngen der einzelnen Abschnitte ist das ein leichtes Unterfangen. Wir verwenden hierzu die Methode <i>ConvertByteToString</i>, 
die einen bestimmten Abschnitt des &uuml;bergebenen Byte-Arrays als String zur&uuml;ckgibt. 
</p>

<pre style="background='silver';">
private static String ConvertByteToString(byte[] bytes, int pos1, int pos2)
{
   //pos2 mu&szlig; gr&ouml;&szlig;er oder gleich pos1 sein und
   //pos2 darf L&auml;nge des Arrays nicht &uuml;berschreiten
   if ((pos1 &gt; pos2) || (pos2 &gt; bytes.Length - 1))
   {
    throw new ArgumentException("Aruments out of range");
   }
    
   //L&auml;nge des zu betrachtenden Ausschnittes
   int length = pos2 - pos1 + 1;
    
   //neues Char-Array anlegen der L&auml;nge length
   Char[] chars = new Char[length];
    
   //packe alle Bytes von pos1 bis pos2 als
   //Char konvertiert in Array chars
   for (int i = 0; i &lt; length; i++)
   {
    chars[i] = Convert.ToChar(bytes[i + pos1]);
   }//end for
    
   //konvertiere Char-Array in String und gebe es zur&uuml;ck
   return new String(chars);
}
</pre>

<p>
Wir brauchen nun eigentlich nur noch die Tabelle 1 aus dem Abschnitt "ID3 Tags" abzutippen. Vorher ist jedoch noch darauf zu achten, da&szlig; 
die eingelesene Datei auch wirklich ID3-Informationen enth&auml;lt. Dem ist so, wenn in den ersten drei Bytes unseres Byte-Arrays das Wort 
"TAG" steht.
</p>

<pre style="background='silver';">
String tag = ConvertByteToString(bytes, 0, 2);
if (tag != "TAG") {
	return false;
}

m_title  = ConvertByteToString(bytes, 3, 32);
m_artist = ConvertByteToString(bytes, 33, 62);
m_album  = ConvertByteToString(bytes, 63, 92);
m_year = Int32.Parse(ConvertByteToString(bytes, 93, 96));
m_comment = ConvertByteToString(bytes, 97, 126);
m_genre = bytes[127];
</pre>

<p>
Damit haben wir schon den wichtigsten Teil, das Auslesen der Daten, erledigt. Mit ein wenig schm&uuml;ckendem Code-Beiwerk erh&auml;lt man so eine 
leicht zu benutzende Klasse. Der beiliegende Source Code enth&auml;lt neben der eigentlichen <i>Mp3File</i> Klasse zwei kleine Beispiele, wie man 
die gewonnenen Daten darstellen kann: Einmal an der Kommandozeile und - etwas sch&ouml;ner und komfortabler - ein anderes Mal als DataGrid 
auf einer Web-Seite.
</p>

<IMG SRC="Bilder/200304/20030430_1.png" width="800" height="241" alt="" border="0">

<p>
Dieses zweite Beispiel demonstriert dabei auch noch das DataBinding mit Standard-Collections und eigenen Objekten.
</p>


<h2>Schlu&szlig;bemerkung</h2>
<p>
Wie man sieht, ist es mit ein wenig Hintergrundwissen und den Klassen des .NET-Frameworks sehr leicht m&ouml;glich, an die Titelinformationen 
von MP3-Dateien zu gelangen. Als Hausaufgabe verbleibt dem Leser die Implementierung des ID3v2-Standards, der wesentlich mehr Felder bei 
variabler Feldl&auml;nge bietet. N&auml;here Informationen zu diesem Thema finden sich auf den Seiten der 
<a href="http://www.id3.org" target="_blank">ID3.org</a>.
</p>
<h2>Download des Codes</h2>
<p><a href="../Code/20030430.zip">Klicken Sie hier</a>, um den Download zu starten.</p>
<h2>Links zu anderen Sites</h2>
<p>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Eid3%2Eorg">ID3.org</a><br>

</p>

<h2>Wenn Sie jetzt Fragen haben...</h2>
<p>
Wenn Sie Fragen rund um die in diesem Artikel vorgestellte Technologie haben, dann schauen Sie einfach bei uns
in den <a href="http://glengamoi.com/forums/">Community Foren der deutschen .NET Community</a> vorbei. Die Teilnehmer 
helfen Ihnen gerne, wenn Sie sich zur im Artikel vorgestellten Technologie weiterbilden m&ouml;chten.
</p>

<p>
<a href="http://glengamoi.com/forums/"><img src="../images/glengamoi.com_250.gif" width="250" height="80" alt="" border="0"></a>
</p>


<p>
Eine weitere sehr hilfreiche Resource ist das <a href="http://aspxfiles.com/">deutsche ASP.NET Wiki</a>,
das als zentrale Anlaufstelle f&uuml;r Tips, Tricks, Know How und alles N&uuml;tzliche was man in seinem Alltag als 
(ASP).NET-Entwickler so braucht und entdeckt gedacht ist. 
</p>

<p>
Haben Sie Fragen die sich direkt auf den Inhalt des Artikels beziehen, dann schreiben Sie dem Autor! Unsere Autoren
freuen sich &uuml;ber Feedback zu ihren Artikeln. Ein einfacher Klick auf die <i>Autor kontaktieren</i>
Schaltfl&auml;che (weiter unten) und schon haben Sie ein f&uuml;r diesen Artikel personalisiertes Anfrageformular.
</p>

<p>&nbsp;</p>
<p>
Und zu guter Letzt m&ouml;chten wir Sie bitten, den Artikel zu bewerten. Damit helfen Sie uns, 
die Qualit&auml;t der Artikel zu verbessern - und anderen Lesern bei der Auswahl der Artikel,
die sie lesen sollten.
</p>

<FORM METHOD="POST" STYLE="margin-bottom: 0px;" NAME="formRating" ACTION="/service/bewerten.asp">
<INPUT TYPE="HIDDEN" NAME="ArticleId" VALUE="20030430" />
<CENTER>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
	<TD ALIGN="CENTER" VALIGN="MIDDLE" COLSPAN="7">Bewerten Sie diesen Artikel</TD>
</TR>
<TR>
	<TD><EM>&nbsp;Sehr gut&nbsp;</EM></TD>
	<TD><INPUT TYPE="radio" value="1" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="2" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="3" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="4" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="5" NAME="radioRating" /></TD>
	<TD ALIGN="right"><EM>&nbsp;Nicht gen&uuml;gend</EM></TD>
	<TD ROWSPAN="2" VALIGN="middle">&nbsp;<INPUT TYPE="submit" VALUE="Werten!" /></TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD ALIGN="CENTER">&nbsp;1</TD>
	<TD ALIGN="CENTER">&nbsp;2</TD>
	<TD ALIGN="CENTER">&nbsp;3</TD>
	<TD ALIGN="CENTER">&nbsp;4</TD>
	<TD ALIGN="CENTER">&nbsp;5</TD>
	<TD>&nbsp;</TD>
</TR>
</TABLE>
</FORM>
</center>
&nbsp;<P>
<center>
<p><table><tr><td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="pagetitle" value="MP3-Titelinformationen mit .NET auslesen"><input type="hidden" name="pageurl" value="http://www.aspheute.com/artikel/20030430.htm"><input type="image" src="../images/layout/senden.png" width="107" height="20" border="0" alt="Schicken Sie diese Seite einem Freund!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="Author" value="Björn Waide"><input type="hidden" name="AuthorEmail" value="bjoern@waide.de"><input type="hidden" name="Artikel" value="20030430"><input type="image" src="../images/layout/kontakt.png" width="107" height="20" border="0" alt="Kontaktieren Sie den Autor!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top><a href="../PrinterFriendly/20030430.htm"><img src="../images/layout/druck.png" width="118" height="20" border="0" alt="F&uuml;r Ausdruck optimierte Seite"></a></td>
</tr></table></p>
</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
