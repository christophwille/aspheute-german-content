<HTML>
<HEAD>
<TITLE>Fern&ouml;stliche Formulare / Unicode die Zweite</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="7 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="In diesem Artikel zeigt der Autor, wie man mit chinesischen und japanischen Zeichens&auml;tzen jongliert.">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,Unicode,ASP,Chinesisch,Big5,Japanisch,CodePage,Code">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff"  BACKGROUND="../images/layout/aspheutemainbg.gif" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<MAP NAME="titlebar">
<!--<AREA SHAPE=RECT COORDS="116,46,191,61" HREF="http://www.aspaktuell.com" ALT="ASP Aktuell">-->
<!--<AREA SHAPE=RECT COORDS="192,46,255,61" HREF="http://www.aspwelt.com" ALT="ASP Welt">-->
<AREA SHAPE=RECT COORDS="256,46,432,61" HREF="http://www.aspgerman.com/aspgerman/" ALT="ASP German">
<AREA SHAPE=RECT COORDS="115,15,269,42" HREF="../default.htm" ALT="Homepage">
<AREA SHAPE=RECT COORDS="278,26,587,42" HREF="../default.htm" ALT="Homepage">
</MAP>

<div style="position:absolute;left:0px;top:30px">
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td background="../images/layout/aspheutetitle.gif">
<img src="../images/layout/blind.gif" width="715" height="73" usemap="#titlebar" border="0">
</td>
<td width="100%" background="../images/layout/aspheutetitleext.gif">
&nbsp;
</td>
<td background="../images/layout/aspheutetitleend.gif">
<img src="../images/layout/blind.gif" width="25" height="1">
</td>
</tr>
</table>
</div>

<div style="position:absolute;left:1px;top:115px">
<table width="110" border="0" cellspacing="0" cellpadding="0">
<tr><td width="110"><img src="../Images/spacer.gif" width="110" height="1" alt="" border="0"></td></tr>
<tr>
<td background="../images/layout/aspheuteheader.gif" class="header" height=16 width="110">
<p>Liste</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">

<p class="content">
<a href="../kategorien/dotNET%202dot0.htm">.NET 2.0 (1)</a><br>
<a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein (16)</a><br>
<a href="../kategorien/dotNET%20Fu.htm">.NET Fu (5)</a><br>
<a href="../kategorien/ADOdotNET.htm">ADO.NET (11)</a><br>
<a href="../kategorien/Aprilscherz.htm">Aprilscherz (3)</a><br>
<a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen (44)</a><br>
<a href="../kategorien/ASP%20Tricks.htm">ASP Tricks (83)</a><br>
<a href="../kategorien/ASPdotNET.htm">ASP.NET (44)</a><br>
<a href="../kategorien/ASPIntranetdotde.htm">ASPIntranet.de (5)</a><br>
<a href="../kategorien/Csharp.htm">C# (28)</a><br>
<a href="../kategorien/Datenbank.htm">Datenbank (44)</a><br>
<a href="../kategorien/Dokumentation.htm">Dokumentation (4)</a><br>
<a href="../kategorien/IIS%206dot0.htm">IIS 6.0 (1)</a><br>
<a href="../kategorien/Komponenten.htm">Komponenten (29)</a><br>
<a href="../kategorien/Optimierung.htm">Optimierung (10)</a><br>
<a href="../kategorien/Server.htm">Server (21)</a><br>
<a href="../kategorien/Sicherheit.htm">Sicherheit (34)</a><br>
<a href="../kategorien/Tee%20Off.htm">Tee Off (6)</a><br>
<a href="../kategorien/VBdotNET.htm">VB.NET (6)</a><br>
<a href="../kategorien/WAP.htm">WAP (8)</a><br>
<a href="../kategorien/Web%20Services.htm">Web Services (11)</a><br>
<a href="../kategorien/XML.htm">XML (9)</a><br>


<br>
<a href="/syndication/rss.xml"><img src="../Images/rss_small.png" width="25" height="10" alt="RSS 2.0 - Die neuesten f&uuml;nf Artikel auf AspHeute.com" border="0"></a>

</p><!-- </p> remains -->


<br>

</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearch.gif" class="header" height=16 width="110">
<p>Suchen</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearchext.gif" class="header" width="110">
<form class="content" ACTION="REMOVED" METHOD="GET">
<div>
<input class="Newsletter" type="text" size="10" name="CiRestriction">
<span class="spacer2"><br></span>
<span class="spacer4"><br></span>
<INPUT TYPE="HIDDEN" NAME="CiMaxRecordsPerPage" VALUE="10">
<INPUT TYPE="HIDDEN" NAME="CiSort" VALUE="rank[d]">
<INPUT TYPE="HIDDEN" NAME="HTMLQueryForm" VALUE="../default.htm">
<img src="../images/layout/blind.gif" width="41" height="1"><input type="image" src="../images/layout/aspheutesearchenter.gif" border="0" width="49" height="14"><br>
<span class="spacer4"><br></span>
</div>
</form>
</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">
<p class="content">
<a href="/REMOVED/" title="Our most popular articles translated into English">English Articles</a><br>
<a href="/REMOVED/" title="Visit our Chinese content section">Chinese Articles</a><br>
<a href="../autoren/UnsereAutoren.htm" title="Unsere Autoren">Unsere Autoren</a><br>
&nbsp;<br>
<a href="/REMOVED/link2us.asp" title="Setzen Sie einen Link zu AspHeute!">Link zu AspHeute</a><br>
<a href="/REMOVED/impressum.asp" title="Das Impressum von AspHeute">Impressum</a><br>
<a href="/REMOVED/advertise.asp" title="Werben auch Sie auf AspHeute">Werben</a><br>
<a href="/REMOVED/kontakt.asp" title="Teilen Sie uns Ihre W&uuml;nsche, Beschwerden und Anregungen mit">Anfragen</a><br>
</p>
</td>
</tr>
</table>
</div>



<!-- Content starts here  -->
<div style="position:absolute;left:120px;top:108px">
<table cellspacing="0" cellpadding="0"><!--Tabelle aussen-->
<tr><!--Tabelle aussen, 1/2-->
<td><!--Tabelle aussen, 1/1-->
    <table border=0 align=center><tr><td align=center>


</td></tr></table>

<H1>Fern&ouml;stliche Formulare / Unicode die Zweite</H1>
<p>
Geschrieben von: <a href="../autoren/christiankoller.htm">Christian Koller</a><br>
Kategorie: <a href="../kategorien/ASP%20Tricks.htm">ASP Tricks</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20001010"></SCRIPT>
</p>
<p><strong>Aus dem Tagebuch eines Programmierers</strong><br>
Was treibt sie an, was treiben sie?</p>
<p>Nur die wenigsten Programmierer werden in die Verlegenheit kommen eine 
japanische oder gar chinesische Website zu programmieren. Trotzdem erhielt ich
vor kurzem eine Email, in der ich um Rat gefragt wurde. Involviert war eine chinesische
Website, genauer gesagt, ein Webformular, das in ASP auszuwerten war.</p>

<p>Aufgrund meiner Erfahrung mit Unicode in Zusammenhang mit ASP oder Datenbanken 
dachte ich bei mir, es w&auml;re sicherlich eine einfache Sache: nur ein
paar chinesische Schriftzeichen in einem Formular, das zu einer ASP Datei 
geschickt werden sollte.</p>

<p>Doch ich hatte nicht mit den gemeinen Fallen gerechnet, die mir auf meinem Weg
auflauern w&uuml;rden.</p>

<p>Aber zur&uuml;ck zum Anfang: wie ich der geheimnisvollen Email eines verzweifelten 
Programmierers entnehmen konnte, war das mit den chinesischen Schriftzeichen 
und ASP so eine Sache. Nat&uuml;rlich wollte ich mich davon mit eigenen Augen 
&uuml;berzeugen und wagte mich in die H&ouml;hle des L&ouml;wen. Genauer gesagt, zuerst in 
die H&ouml;hle des Drachen.</p>

<p>Ein Souvenier meiner ausgedehnten Streifz&uuml;ge durchs Internet war eine 
japanische Fehlermeldung, die mir mit bl&uuml;migen Worten von einem HTTP 404 Fehler 
gek&uuml;ndet hatte. Eingeweihte wissen: HTTP Fehler 404, das ist wie wenn 
man an der T&uuml;re eines gr&ouml;&szlig;en Hauses l&auml;utet und keiner macht auf.
Oder wie einer meiner amerikanischen Kollegen so treffend zu sagen pflegt: 
<i>File Not Found</i>.</p>


<p><IMG SRC="Bilder/200010/20001010_yakuza.png" width=616 height=364 alt="" border="0">
<br>
<i>Bild 1: Webseite nicht gefunden, diesmal auf japanisch.</i></p>

<p>Ich machte mich also auf den Weg, bei mir meine treuen Begleiter
Homesite 4.0, IIS 5.0 und Internet Explorer 5.5. Sie alle hatten mir bisher
hervorragende Dienste erwiesen, ich wu&szlig;te, wenn ich das R&auml;tsel l&ouml;sen wollte,
dann nur mit diesen Werkzeugen.</p>



<h2>Basteln des fern&ouml;stlichen Formulars</h2>

<p>So ging ich daran ein Formular zu basteln, das in einer Unicode codierten
HTML Seite eingebettet war. K&uuml;hl rechnete ich damit, da&szlig; der Auswertungsteil 
in ASP, da ebenso auf Unicode basierend, eigentlich kompatibel sein m&uuml;&szlig;te.</p>

<p>Um das Formular mit fremdartigen, ja unverst&auml;ndlichen Schriftzeichen zu testen,
nahm ich eben jene 404 Meldung auf japanisch her, die schon seit geraumer Zeit
auf meiner Festplatte friedlich vor sich hin geschlummert hatte.</p>

<p>Mit einem gewissen Kribbeln in der Magengegend spielte ich also das folgende ASP File 
auf den IIS 5.0 Server. Eingeweihte wissen bereits: das folgende Skript 
(<i>20001010_unicode.asp</i>) verweigert auf einem IIS 4.0 seinen Dienst - 
<i>Windows NT 4.0 kann die Codepage 65001 (Unicode) nicht liefern,
also h&ouml;chste Zeit um in Pension zu gehen und Platz f&uuml;r Windows 2000 Server
zu machen!</i></p>

<p><pre style="background='silver';">
&lt;% @Codepage = 65001 %&gt;
&lt;% 
' Achtung: Codepage Unicode (65001) kann nur unter IIS 5.0 angegeben werden
' Wenn Sie es mit einem hinterhaeltigen IIS 4.0 zu tun haben, so verweigern
' Sie einfach die Angabe jeglicher Codepage! Er wird Sie mit sonderbaren 
' Zeichen strafen, aber so ist die Welt.
%&gt;

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;

&lt;html&gt;
&lt;head&gt;
   &lt;title&gt;Unicode mit Japanisch (Banzai!)&lt;/title&gt;
   &lt;meta name="Author" content="christian.koller@aspexpert.com"&gt;

&lt;!-- Achtung: Unicode (charset=UTF-8) versteht nicht jeder 
Browser, daher mit Vorsicht zu geniessen --&gt;   
&lt;META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8"&gt;

&lt;/head&gt;
&lt;body&gt;

Unerschrocken erdacht und getestet von 
&lt;a href="mailto:christian.koller@aspexpert.com"&gt;Christian Koller&lt;/a&gt;!
&lt;br&gt;&lt;br&gt;

&lt;%
' Ist das Formular abgeschickt? Die gute alte Servervariable
' Content_Length gibt bereitwillig Auskunft
If Request.ServerVariables("CONTENT_LENGTH") &lt;&gt; 0 Then
   isPostBack = True
   
   ' Lese den abgesendeten Text aus
   content = Request.Form("content")

   ' Schreibe den Text zum Browser 
   ' (Ein Roundtrip der schwindligen Art):
   ' Ersetze davor alle Returns mit "&lt;BR&gt;", der Browser wird 
   ' es dir danken (Moegen die Goetter mit dir sein!)
   strOut = Replace(content, chr(13), "&lt;BR&gt;")
   strOut = Replace(strOut, chr(10), "")
   Response.write "Empfangen:&lt;br&gt;" &amp; strOut &amp; "&lt;br&gt;&lt;br&gt;" &amp; vbcrlf
   
   ' Achtung: Server.HTMLEncode reagiert sehr gereizt
   ' wenn unter Unicode aufgerufen: Fuer Fehler keine Haftung 
   contentHTMLEncode = Server.HTMLEncode(content)

   ' Schreibe die Unicode Codes aller Buchstaben zum Browser,
   ' Stueck fuer Stueck sich naehernd der Wahrheit
   ' (die bekanntlich irgendwo da draussen liegt ...)
   For intI = 1 to Len(content)
      strChar = Mid(content,intI, 1)
      AscwChar = ASCW(strChar)
      ' Achtung Falle: Wegen eines Fehlers in der AscW Implementation:
      ' Ein Wert kleiner als Null darf nicht ungestraft hingenommen werden!
      If AscwChar &lt; 0 Then AscwChar = AscwChar + 65536
      
      ' Schreibe den Unicode Code und den Buchstaben zum Browser,
      ' moege er das Antlitz des Programmierers strahlen lassen
      Response.Write AscwChar &amp; " = " &amp; strChar &amp; _
          "&lt;br&gt;" &amp; vbcrlf
   Next
   Response.Write "&lt;br&gt;&lt;br&gt;"
   
   ' Eigenhaendig einen HTML-enkodierten String "zusammenbauen" -
   ' (Heimwerken leicht gemacht)
   strHTMLEncoded = ""
   For intI = 1 to Len(content)
      strChar = Mid(content,intI, 1)
      AscwChar = ASCW(strChar)
      ' Schon wieder die Falle in ASCW:
      If AscwChar &lt; 0 Then AscwChar = AscwChar + 65536
      ' Zeichen einfach als &amp;#xxxxx; ausgeben.
      ' Sei xxxxx der Unicode Wert des Zeichens - 
      ' und das Glueck ist auf Deiner Seite:
      strHTMLEncoded = strHTMLEncoded &amp; "&amp;#" &amp; AscwChar &amp; ";"
   Next
   
   ' Schreibe den HTML-enkodierten String zum Browser
   ' Keine Angst, der Browser beisst nicht, 
   ' zumindest nicht bei Unicde!
   Response.Write "HTML-enkodierter String:&lt;br&gt;"
   strOut = Replace(strHTMLEncoded, "&amp;#13;", "&lt;BR&gt;")
   strOut = Replace(strOut, "&amp;#10;", "")   
   Response.Write strOut &amp; vbcrlf
Else
   isPostBack = False
End If
%&gt;

&lt;form action="&lt;%= Request.ServerVariables("SCRIPT_NAME") %&gt;" method="POST"&gt;

&lt;!-- Der folgende Inhalt is unicode-kodiertes Japanisch --&gt;
&lt;textarea name="content" cols="40" rows="10"&gt;
HTTP &amp;#12456;&amp;#12521;&amp;#12540; 404
404 &amp;#35211;&amp;#12388;&amp;#12363;&amp;#12426;&amp;#12414;&amp;#12379;&amp;#12435;
&lt;/textarea&gt; 

&lt;input type="Submit" name="Submit" value="Submit"&gt;
&lt;/form&gt;

&lt;br&gt;
&lt;a href="&lt;%= Request.ServerVariables("SCRIPT_NAME") %&gt;"&gt;Zurueck&lt;/a&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></p>


<p>Vorsichtig startete ich den Internet Explorer - die Eingabe der Adresse meines
Entwicklungsservers war Routine. Wohlwollend konnte ich das erwartete, erste  Ergebnis 
betrachten:</p>

<p><IMG SRC="Bilder/200010/20001010_banzai.png" width=613 height=361 alt="" border="0">
<br>
<i>Bild 2: Browser bei Anzeige der ASP Datei mit japanischen Schriftzeichen.</i></p>

<p>Was w&uuml;rde nun passieren, wenn ich den <i>Submit</i> Button dr&uuml;ckte? W&uuml;rde
der Browser wohl die richtigen Zeichen in verst&auml;ndlicher Kodierung an den Webserver
schicken; w&auml;re ASP in der Lage, die Zeichen zu lesen und zu deuten? Fragen
&uuml;ber Fragen. Doch mit der Entschlossenheit eines Samurai sandte ich das Formular zum 
Server, mein Schicksal in die H&auml;nde der G&ouml;tter, mein Geist bis zum
Zerrei&szlig;en gespannt. Blitzschnell ging ich in Gedanken jeden einzelnen Schritt durch,
der nun unabwendbar seinen Weg gehen w&uuml;rde:</p>

<p>Der Browser sendet die Zeichen, als Unicode Zeichen kodiert, &uuml;ber das 
ihm wohlvertraute HTTP Protokoll zum Webserver. Er schickt die Zeichen als Unicode,
da dies das augenblickliche Characterset sozusagen das Karma der Seite, bestimmt!</p>

<p>Am IIS 5.0 w&uuml;rde der Aufruf bei der ASP Seite Geh&ouml;r finden, 
der Webserver die Daten huldvoll in Empfang nehmen und mit geb&uuml;hrendem Respekt 
zum <i>Request</i> Objekt weiterreichen.</p>

<p>So liegt des Textes Schicksal nun in des Skriptes H&auml;nden. Gespeichert
in der Variable <i>content</i> verweilt der Text doch nur einen kurzen Augenblick.
Ja, in der Tat es war ein KLEINER Inhalt, doch um so abenteuerlicher sein Weg:</p>

<p>Denn schon schreibt das ASP Skript den gespeicherten Text wieder zum Browser, eine Art
Boomerang. Doch damit der Text lesbar im Browser wieder erscheint, mu&szlig; der Server
die Codepage 65001 (Uniocode) in Verwendung nehmen, sozusagen als Umschlag, damit 
die Buchstaben richtig, unbeschadet und unverf&auml;lscht am Browser ankommen:</p>


<p><IMG SRC="Bilder/200010/20001010_Die_Ankunft.png" width=612 height=365 alt="" border="0">
<br>
<i>Bild 3: Die Ankunft, unbeschadet und unversehrt!</i></p>


<p>F&uuml;r die direkte Ausgabe mittels <i>Response.Write(content)</i> ist es
nicht von Bedeutung, ob die Codepage in der ASP Seite explizit auf Unicode (65001) gesetzt ist.
Die Zeichen der Botschaft finden auch so wieder unbeschadet ihren Weg zum Browser. 
Jedoch w&uuml;rde eine nicht gesetzte Codepage f&uuml;r den Befehl <i>Server.HTMLEncode</i>
bedeuten, da&szlig; die Zeichen vollkommen falsch kodiert zum Browser geschickt werden:</p>

<p><IMG SRC="Bilder/200010/20001010_kamikaze.png" width=612 height=365 alt="" border="0">
<br>
<i>Bild 4: Kamikaze?</i></p>

<p>Das Aufzeigen der Unicode Codes der einzelnen Schriftzeichen,
vom Listing mit Hilfe einer <i>For</i> Schleife und den String Funktionen <i>Mid</i>
und <i>ASCW</i> vollbracht. <i>ASCW</i> liefert dabei nur den
ASCII Wert eines Unicode Schriftzeichens zur&uuml;ck:</p>


<p><IMG SRC="Bilder/200010/20001010_NurNummern.png" width=612 height=365 alt="" border="0">
<br>
<i>Bild 5: Die Buchstaben und ihre Unicode Werte </i></p>

<p>Eine kleine Episode am Rande: das in Bild 5 mit dem Wert 35211 gekennzeichnete
Schriftzeichen hat mir den Fallstrick gezeigt, den die <i>ASCW</i> Funktion birgt - 
f&uuml;r manche Zeichen liefert sie negative Werte, ganz entgegen jeder Konvention und
Vernunft! F&uuml;r jenes bewu&szlig;te Zeichen mit dem Unicode Wert 35211
liefert <i>ASCW</i> den Wert -30325, man stelle sich vor!
Diesen Lapsus mu&szlig; der Programmierer in seiner Weisheit korrigieren,
wobei ein Addieren der magischen Zahl 65536 (2 hoch 16) zu negativen <i>ASCW</i> Werten
wahrlich Wunder wirkt!</p>


<p><pre style="background='silver';">
      AscwChar = ASCW(strChar)
      ' Schon wieder die Falle in ASCW:
      If AscwChar &lt; 0 Then AscwChar = AscwChar + 65536
</pre></p>


<p>Zu guter letzt bastelt unsere tapfere ASP Datei noch eine Zeichnekette zusammen,
die aus den einzelnen Schriftzeichen des japanischen Textes bestehen - jeweils
in der Form <i>&amp;#xxxxx;</i> kodiert. Der Wert <i>xxxxx</i> steht dabei f&uuml;r den
Unicode Wert des jeweiligen Zeichens. Und ebenso erwartungsgem&auml;&szlig; sieht die
Ausgabe im Internet Explorer aus:</p>

<p><IMG SRC="Bilder/200010/20001010_Selbstgestrickt.png" width=612 height=365 alt="" border="0">
<br>
<i>Bild 6: HTMLEncode einmal anders!?!</i></p>



<p>Auch hier ist es von immenser Wichtigkeit, da&szlig; die Codepage der Seite auf
Unicode gesetzt ist. Nicht sehen k&ouml;nnt Ihr sonst die Sch&ouml;nheit oder die
Bedeutung der Schrift!</p>

<p>F&uuml;r diejenigen, die dieses Skript unter Netscape ausf&uuml;hren eine eindringliche
Warnung! Nicht einweihen wird Euch dieser Browser in die Geheimnisse der 
Unicode-Verschl&uuml;sselung - nicht f&auml;hig ist er doch dazu, erkennt er doch 
nicht die verborgenen Botschaften, die jedem Unicode Zeichen inne wohnen!</p>


<h2>Das chinesische R&auml;tsel</h2>

<p>Das erste Skript ein voller Erfolg - ich lehnte mich in meinen Lehnstuhl 
und genehmigte mir erstmal eine dicke Zigarre. Alles schien so einfach, so klar.
Wo sollten hier, in diesem fast vollkommenen R&auml;derwerk, die Probleme lauern,
die mein geheimnisvoller Informant mir mitgeteilt hat?</p>

<p>Ich analysierte noch einmal die Email, nahm Fingerabdr&uuml;cke, verfolgte die 
Route der Email zur&uuml;ck, doch all dies half nichts. Also entschlo&szlig; ich mich,
mein unersch&ouml;pfliches Nachschlagewerk, die Bibliothek der hohen Programmiererkunst
zu befragen - die 
<a href="http://msdn.microsoft.com../default.htm" target="_blank">Microsoft Developer Network Library</a>, 
oft auch nur kurz MSDN genannt.</p>

<p>Schon oftmals in fast hoffnungslosen Situationen fand ich den rettenden Ausweg in den
weisen Schriften. Auch diesmal sollte mir das Gl&uuml;ck treu sein!</p>

<p>War nicht in der Email von "Chinesisch" die Rede? Also durchforstete ich
die Weiten der MSDN nach chinesischen Codepages, sowohl f&uuml;r den Browser
als auch f&uuml;r den Server - und meine M&uuml;hen wurden belohnt.</p>

<p>Ich stie&szlig; auf ein l&auml;ngst vergessenes Dokument mit dem 
eindeutigen Titel 
<a href="http://msdn.microsoft.com/library../default.htm?URL=/library/books/devintl/S24CD.HTM" target="_blank">
Appendix G DBCS/Unicode Mapping Tables</a>. 
Es fiel mir wie Schuppen von den Augen und ich
kombinierte blitzschnell: Chinesische Schriftzeichen - chinesisches Characterset im Browser!
Wie sonst sollten chinesische Schriftzeichen dargestellt werden, wenn man nicht dem
Browser die Anwesenheit derselbigen mitteilte? Einzig und allein die folgende HTML Zeile
&auml;nderte die ganze Situation grundlegend:</p>

<p><pre style="background='silver';">
&lt;META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=big5"&gt;
</pre></p>

<p>Diese kleine Anweisung war verantwortlich daf&uuml;r, da&szlig; die 
chinesischen Schriftzeichen korrekt im Browser dargestellt werden!
Um ein wenig ins Detail zu gehen, der Characterset <i>Big5</i> ist das Synonym
f&uuml;r die Codepage f&uuml;r "Traditionelles Chinesisch". Die zugeh&ouml;rige 
server-seitige Codepage hat den Wert 950, soviel stand fest.</p>

<p>Nun gut, gar nicht faul &auml;nderte ich einfach das Skript, das mit der
japanischen Schrift so hervorragend harmoniert hatte, und benutzte anstatt 
der Unicode Zeichens&auml;tze im Browser die Big5 Zeichens&auml;tze:</p>

<p><pre style="background='silver';">
&lt;% @Codepage = 950 %&gt;
&lt;% 
' Codepage Unicode (950) steht fuer traditionelles Chineisch (big5),
' und in unserem Fall auch fuer Probleme!
%&gt;

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;

&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Japanisch als traditionelles Chinesisch verkleidet&lt;/title&gt;
	&lt;meta name="Author" content="christian.koller@aspexpert.com"&gt;

&lt;!-- Achtung: Big5 Characterset: Traditionelles Chinesisch --&gt;	
&lt;META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=big5"&gt;

&lt;/head&gt;
&lt;body&gt;

...
</pre></p>

<p>Das Script glich dem alten Skript bis aufs Haar, nur die Kodierung wechselte von
Unicode auf "Traditionelles Chinesisch" (Big5). Ern&uuml;chterung stellte sich bei mir
ein, als ich das Formular abgeschickt hatte:</p>

<p><IMG SRC="Bilder/200010/20001010_Ernuechterung.png" width=612 height=365 alt="" border="0">
<br>
<i>Bild 7: Traditionelle Chinesische Ern&uuml;chterung</i></p>

<p>Der direkt gesendete Text kam im Browser noch unversehrt an. Doch schon bei der 
Ausgabe des Befehls Server.HTMLEncode, und erst recht bei der Auflistung der einzelnen Zeichen
&uuml;berkam mich eine tiefe M&uuml;digkeit - leichte Ratlosigkeit, gepaart mit ungl&auml;ubigem
Kopfsch&uuml;tteln bestimmte meine Reaktion.</p>

<p>Der Schrecken sa&szlig; tief. Was war genau passiert, dies galt es zu kl&auml;ren,
eindeutig aufzuzeigen, wo und warum die Schriftzeichen nicht mehr die selben waren,
die Ihren Weg zum Server angetreten hatten:</p>

<p>Im Eingabfeld des Formulars wurden die Zeichen noch so angezeigt, wie sie wohl jeder
Japaner ohne M&uuml;he lesen k&ouml;nnte.</p>



<p>Minuti&ouml;s konstruierte ich den Weg, den die Informationen zum Server und wieder zur&uuml;ck zum
Browser genommen hatten, und nach einiger Suche fand ich schlie&szlig;lich die wahre
Ursache f&uuml;r das Dilemma heraus. Wie aus der Ausgabe der einzelnen Schriftzeichen
bzw. Buchstaben unschwer zu erkennen ist, werden die meisten Zeichen in der Form &amp;#xxxxx; 
bereits in der Variablen <i>content</i> gespeichert.</p>

<p><IMG SRC="Bilder/200010/20001010_Erstaunen.png" width=612 height=365 alt="" border="0">
<br>
<i>Bild 8: Inhalt der Variablen content</i></p>

<p>Damit dies der Fall sein kann, mu&szlig; bereits das Request Objekt die Zeichen
in dieser Form gespeichert haben. Nur so ist es zu erkl&auml;ren, da&szlig; bei
der nachfolgenden Zuweisung die Variable <i>content</i> den unerwarteten aber 
einwandfrei festgestellten Inhalt birgt.</p>

<p><pre style="background='silver';">
	content = Request.Form("content")
</pre></p>

<p>Doch wie sollte das <i>Request</i> Objekt zu diesem Inhalt kommen? 
Nach Abw&auml;gung aller Fakten bleibt als einzig logische Schlu&szlig;folgerung, 
da&szlig; bereits der Browser die Zeichen nicht vern&uuml;nftig kodiert zum Server geschickt
hat, sondern direkt als &amp;#xxxxx;! 
Damit ist ein einzelnes Zeichen nicht mehr mittels DBCS (Double Byte Character Set)
kodiert, sondern liegt als HTML/Unicode-Darstellungswert vor.</p>

<p>Wie Sie sich, gesch&auml;tzter Leser, sicherlich vorstellen k&ouml;nnen, ist
die Handhabung eines solchen Inhaltes alles andere als leicht. Noch dazu sind
manche Zeichen als als DBCS kodiert, andere als &amp;#xxxxx;. Das Chaos ist perfekt!</p>


<p>Was kann man tun, um der Misere zu entrinnen? </p>


<h2>Der Ausweg: Einfach "vereinfachtes Chinesisch"</h2>

<p>Ich konsultierte noch einmal die MSDN und fand einen anderen Zeichensatz,
mit dem sich chinesische Schriftzeichen darstellen lassen. Den Zeichensatz 
"Simplified Chinese", Codepage 936.</p>

<p>Rasch schrieb ich das Beispiel um, verwendete im HTML als auch in der ASP Seite
den "Simple Chinese" Zeichensatz, und wie durch ein Wunder, einem Sonnstrahl in finsterem Walde
gleich --- es funktionierte! Ich konnte beliebige chinesische Zeichen zum Server senden, wo Sie
wohlbehalten und unversehrt in der Variable content gespeichert wurden.</p>


<p>Erleichtert legte ich den gel&ouml;sten Fall zu den Akten.</p>



<h2>Schlu&szlig;bemerkung</h2>
<p>
Big5 liefert GROSSE Probleme, wenn man in dieser Codierung ein
Formular zum Server schickt.
</p>
<p>
Der Ausweg liegt darin, sich mit dem simplified Chinese Characterset zufrieden zu stellen,
das vielleicht ein paar tausend Zeichen weniger enth&auml;lt, daf&uuml;r aber alle
vern&uuml;nftig kodiert zum Webserver schickt!
</p>
<h2>Download des Codes</h2>
<p><a href="../Code/20001010.zip">Klicken Sie hier</a>, um den Download zu starten.</p>
<h2>Verwandte Artikel</h2>
<p>
<a href="20000522.htm">&Uuml;berpr&uuml;fen von HTML-Formularen mit ASP</a><br>
<a href="20000405.htm">@-Direktiven auf ASP Seiten</a><br>
<a href="20000831.htm">Unicode und ASP (Einf&uuml;hrung)</a><br>
<a href="20020704.htm">Zahl, Datum und W&auml;hrung korrekt formatiert ausgeben</a><br>

</p>
<h2>Links zu anderen Sites</h2>
<p>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fmsdn%2Emicrosoft%2Ecom%2Flibrary%2Fdefault%2Easp%3FURL%3D%2Flibrary%2Fbooks%2Fdevintl%2FS24CD%2EHTM">Appendix G DBCS/Unicode Mapping Tables</a><br>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fmsdn%2Emicrosoft%2Ecom%2Fworkshop%2Fdatabase%2Ftdc%2Freference%2FCharSet%2Easp">Character- und Codesets</a><br>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fmsdn%2Emicrosoft%2Ecom%2Flibrary%2Fdefault%2Easp%3FURL%3D%2Flibrary%2Fbooks%2Fdevintl%2FS24AE%2EHTM">Developing International Software</a><br>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fmsdn%2Emicrosoft%2Ecom%2Fdefault%2Easp">Microsoft Developer Network Library</a><br>

</p>

<h2>Wenn Sie jetzt Fragen haben...</h2>
<p>
Wenn Sie Fragen rund um die in diesem Artikel vorgestellte Technologie haben, dann schauen Sie einfach bei uns
in den <a href="http://glengamoi.com/forums/">Community Foren der deutschen .NET Community</a> vorbei. Die Teilnehmer 
helfen Ihnen gerne, wenn Sie sich zur im Artikel vorgestellten Technologie weiterbilden m&ouml;chten.
</p>

<p>
<a href="http://glengamoi.com/forums/"><img src="../images/glengamoi.com_250.gif" width="250" height="80" alt="" border="0"></a>
</p>


<p>
Haben Sie Fragen die sich direkt auf den Inhalt des Artikels beziehen, dann schreiben Sie dem Autor! Unsere Autoren
freuen sich &uuml;ber Feedback zu ihren Artikeln. Ein einfacher Klick auf die <i>Autor kontaktieren</i>
Schaltfl&auml;che (weiter unten) und schon haben Sie ein f&uuml;r diesen Artikel personalisiertes Anfrageformular.
</p>

<p>&nbsp;</p>
<p>
Und zu guter Letzt m&ouml;chten wir Sie bitten, den Artikel zu bewerten. Damit helfen Sie uns, 
die Qualit&auml;t der Artikel zu verbessern - und anderen Lesern bei der Auswahl der Artikel,
die sie lesen sollten.
</p>

<FORM METHOD="POST" STYLE="margin-bottom: 0px;" NAME="formRating" ACTION="/service/bewerten.asp">
<INPUT TYPE="HIDDEN" NAME="ArticleId" VALUE="20001010" />
<CENTER>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
	<TD ALIGN="CENTER" VALIGN="MIDDLE" COLSPAN="7">Bewerten Sie diesen Artikel</TD>
</TR>
<TR>
	<TD><EM>&nbsp;Sehr gut&nbsp;</EM></TD>
	<TD><INPUT TYPE="radio" value="1" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="2" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="3" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="4" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="5" NAME="radioRating" /></TD>
	<TD ALIGN="right"><EM>&nbsp;Nicht gen&uuml;gend</EM></TD>
	<TD ROWSPAN="2" VALIGN="middle">&nbsp;<INPUT TYPE="submit" VALUE="Werten!" /></TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD ALIGN="CENTER">&nbsp;1</TD>
	<TD ALIGN="CENTER">&nbsp;2</TD>
	<TD ALIGN="CENTER">&nbsp;3</TD>
	<TD ALIGN="CENTER">&nbsp;4</TD>
	<TD ALIGN="CENTER">&nbsp;5</TD>
	<TD>&nbsp;</TD>
</TR>
</TABLE>
</FORM>
</center>
&nbsp;<P>
<center>
<p><table><tr><td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="pagetitle" value="Fern&ouml;stliche Formulare / Unicode die Zweite"><input type="hidden" name="pageurl" value="http://www.aspheute.com/artikel/20001010.htm"><input type="image" src="../images/layout/senden.png" width="107" height="20" border="0" alt="Schicken Sie diese Seite einem Freund!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="Author" value="Christian Koller"><input type="hidden" name="AuthorEmail" value="christiank@aspexpert.com"><input type="hidden" name="Artikel" value="20001010"><input type="image" src="../images/layout/kontakt.png" width="107" height="20" border="0" alt="Kontaktieren Sie den Autor!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top><a href="../PrinterFriendly/20001010.htm"><img src="../images/layout/druck.png" width="118" height="20" border="0" alt="F&uuml;r Ausdruck optimierte Seite"></a></td>
</tr></table></p>
</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
