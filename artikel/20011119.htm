<HTML>
<HEAD>
<TITLE>Schritt-f&uuml;r-Schritt Debuggen von Sicherheitsproblemen</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="7 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="Eines der l&auml;stigsten Probleme beim Entwicklen und Administrieren von Web Sites ist das Troubleshooten von Sicherheitsproblemen. Die absolute #1 ist hierbei Access Denied - Zugriff verweigert.">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,Access Denied,ACL,Access Control List,Debugging security problems,Debug,Fehlersuche,NTFS,Registry,Privileg,User Right,Recht,Troubleshooting,ACE">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff"  BACKGROUND="../images/layout/aspheutemainbg.gif" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<MAP NAME="titlebar">
<!--<AREA SHAPE=RECT COORDS="116,46,191,61" HREF="http://www.aspaktuell.com" ALT="ASP Aktuell">-->
<!--<AREA SHAPE=RECT COORDS="192,46,255,61" HREF="http://www.aspwelt.com" ALT="ASP Welt">-->
<AREA SHAPE=RECT COORDS="256,46,432,61" HREF="http://www.aspgerman.com/aspgerman/" ALT="ASP German">
<AREA SHAPE=RECT COORDS="115,15,269,42" HREF="../default.htm" ALT="Homepage">
<AREA SHAPE=RECT COORDS="278,26,587,42" HREF="../default.htm" ALT="Homepage">
</MAP>

<div style="position:absolute;left:0px;top:30px">
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td background="../images/layout/aspheutetitle.gif">
<img src="../images/layout/blind.gif" width="715" height="73" usemap="#titlebar" border="0">
</td>
<td width="100%" background="../images/layout/aspheutetitleext.gif">
&nbsp;
</td>
<td background="../images/layout/aspheutetitleend.gif">
<img src="../images/layout/blind.gif" width="25" height="1">
</td>
</tr>
</table>
</div>

<div style="position:absolute;left:1px;top:115px">
<table width="110" border="0" cellspacing="0" cellpadding="0">
<tr><td width="110"><img src="../Images/spacer.gif" width="110" height="1" alt="" border="0"></td></tr>
<tr>
<td background="../images/layout/aspheuteheader.gif" class="header" height=16 width="110">
<p>Liste</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">

<p class="content">
<a href="../kategorien/dotNET%202dot0.htm">.NET 2.0 (1)</a><br>
<a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein (16)</a><br>
<a href="../kategorien/dotNET%20Fu.htm">.NET Fu (5)</a><br>
<a href="../kategorien/ADOdotNET.htm">ADO.NET (11)</a><br>
<a href="../kategorien/Aprilscherz.htm">Aprilscherz (3)</a><br>
<a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen (44)</a><br>
<a href="../kategorien/ASP%20Tricks.htm">ASP Tricks (83)</a><br>
<a href="../kategorien/ASPdotNET.htm">ASP.NET (44)</a><br>
<a href="../kategorien/ASPIntranetdotde.htm">ASPIntranet.de (5)</a><br>
<a href="../kategorien/Csharp.htm">C# (28)</a><br>
<a href="../kategorien/Datenbank.htm">Datenbank (44)</a><br>
<a href="../kategorien/Dokumentation.htm">Dokumentation (4)</a><br>
<a href="../kategorien/IIS%206dot0.htm">IIS 6.0 (1)</a><br>
<a href="../kategorien/Komponenten.htm">Komponenten (29)</a><br>
<a href="../kategorien/Optimierung.htm">Optimierung (10)</a><br>
<a href="../kategorien/Server.htm">Server (21)</a><br>
<a href="../kategorien/Sicherheit.htm">Sicherheit (34)</a><br>
<a href="../kategorien/Tee%20Off.htm">Tee Off (6)</a><br>
<a href="../kategorien/VBdotNET.htm">VB.NET (6)</a><br>
<a href="../kategorien/WAP.htm">WAP (8)</a><br>
<a href="../kategorien/Web%20Services.htm">Web Services (11)</a><br>
<a href="../kategorien/XML.htm">XML (9)</a><br>


<br>
<a href="/syndication/rss.xml"><img src="../Images/rss_small.png" width="25" height="10" alt="RSS 2.0 - Die neuesten f&uuml;nf Artikel auf AspHeute.com" border="0"></a>

</p><!-- </p> remains -->


<br>

</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearch.gif" class="header" height=16 width="110">
<p>Suchen</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearchext.gif" class="header" width="110">
<form class="content" ACTION="REMOVED" METHOD="GET">
<div>
<input class="Newsletter" type="text" size="10" name="CiRestriction">
<span class="spacer2"><br></span>
<span class="spacer4"><br></span>
<INPUT TYPE="HIDDEN" NAME="CiMaxRecordsPerPage" VALUE="10">
<INPUT TYPE="HIDDEN" NAME="CiSort" VALUE="rank[d]">
<INPUT TYPE="HIDDEN" NAME="HTMLQueryForm" VALUE="../default.htm">
<img src="../images/layout/blind.gif" width="41" height="1"><input type="image" src="../images/layout/aspheutesearchenter.gif" border="0" width="49" height="14"><br>
<span class="spacer4"><br></span>
</div>
</form>
</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">
<p class="content">
<a href="/REMOVED/" title="Our most popular articles translated into English">English Articles</a><br>
<a href="/REMOVED/" title="Visit our Chinese content section">Chinese Articles</a><br>
<a href="../autoren/UnsereAutoren.htm" title="Unsere Autoren">Unsere Autoren</a><br>
&nbsp;<br>
<a href="/REMOVED/link2us.asp" title="Setzen Sie einen Link zu AspHeute!">Link zu AspHeute</a><br>
<a href="/REMOVED/impressum.asp" title="Das Impressum von AspHeute">Impressum</a><br>
<a href="/REMOVED/advertise.asp" title="Werben auch Sie auf AspHeute">Werben</a><br>
<a href="/REMOVED/kontakt.asp" title="Teilen Sie uns Ihre W&uuml;nsche, Beschwerden und Anregungen mit">Anfragen</a><br>
</p>
</td>
</tr>
</table>
</div>



<!-- Content starts here  -->
<div style="position:absolute;left:120px;top:108px">
<table cellspacing="0" cellpadding="0"><!--Tabelle aussen-->
<tr><!--Tabelle aussen, 1/2-->
<td><!--Tabelle aussen, 1/1-->
    <table border=0 align=center><tr><td align=center>


</td></tr></table>

<H1>Schritt-f&uuml;r-Schritt Debuggen von Sicherheitsproblemen</H1>
<p>
Geschrieben von: <a href="../autoren/christophwille.htm">Christoph Wille</a><br>
Kategorie: <a href="../kategorien/Sicherheit.htm">Sicherheit</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20011119"></SCRIPT>
</p>
<p>
Eines der l&auml;stigsten Probleme beim Entwicklen und Administrieren von Web Sites ist das
Troubleshooten von Sicherheitsproblemen. Die absolute #1 ist hierbei Access Denied - Zugriff
verweigert. Effizient herauszufinden warum man einen solchen Fehler erh&auml;lt ist Ziel des heutigen
Artikels. Und wenn man den Grund kennt, ist die L&ouml;sung auch nicht mehr weit.
</p>

<h2>Wodurch ensteht ein Access Denied Fehler</h2>

<p>
Was sind die Gr&uuml;nde f&uuml;r Access Denied bei der Verwendung von ASP und IIS? Nun, grunds&auml;tzlich kommt
Sicherheit bei beiden von Windows NT / 2000. Dieses bietet die Benutzerverwaltung, sowie verschiedenste
Sicherheitsmechanismen. 
F&uuml;r unsere Betrachtung sind Privilegien und ACL's (Access Control Lists), die auf
Dateien (bekannt als NTFS Zugriffsberechtigungen) oder in der Registrierdatenbank gesetzt sein k&ouml;nnen,
von Interesse.
</p>

<p>
NTFS Zugriffsberechtigungen (ACL's) sind jedem bekannt, der schon einmal mit Windows Explorer sich
den Security Tab einer Datei angesehen hat:
</p>

<IMG SRC="Bilder/200111/20011119_1.png" width="370" height="443" alt="" border="0">

<p>
Hier ist die unsicherste Variante zu sehen - Vollzugriff (Full Control) f&uuml;r Jeder (Everyone). Das 
sollte durch entsprechende Berechtigungen ersetzt sein, nur k&ouml;nnen eben restriktive Berechtigungen
- auf ASP Dateien oder Komponenten und deren abh&auml;ngigen Dateien - unter Umst&auml;nden zu Access Denied
Fehlern f&uuml;hren.
</p>

<p>
Das Konzept der NTFS Zugriffsberechtigungen erschlie&szlig;t sich relativ leicht f&uuml;r den Programmierer,
etwas ungewohnter sind die Privilegien (User Rights), mit denen &uuml;berlicherweise nur der Netzwerkadministrator zu
tun bekommt. Hier ein Screenshot der Local Security Settings:
</p>

<IMG SRC="Bilder/200111/20011119_2.png" width="599" height="406" alt="" border="0">

<p>
Hier sind sehr viele Rechte "vergraben", die Kopfweh bereiten k&ouml;nnen, so zB die verschiedenen
Varianten von <b>Log on as...</b>, die man als User f&uuml;r das Logon an lokale FTP Server brauchen
kann. In den meisten aller F&auml;lle denkt man als Programmierer gar nicht daran, da&szlig; man unter
Umst&auml;nden an einem fehlenden Recht scheitert.
</p>

<p>
<b>Stolperstein</b> Diese Security Settings sind doppelt gef&auml;hrlich, da diese in sogenannten
<b>Policies</b> verwendet werden. Und diese Policies k&ouml;nnen an folgenden Orten vergeben
werden: Local (lokaler Computer), Site (Active Directory), Domain (Active Directory) und
Organizational Unit (Active Directory). Das Problem ist, da&szlig; Policies in dieser Reihenfolge
angewandt werden, und die letzte Einstellung "greift". Das hei&szlig;t, da&szlig; unter Umst&auml;nden die
lokale Einstellung zwar korrekt ist, aber von einer nicht passenden Group Policy 
"&uuml;berstimmt" wird.
</p>

<h2>Debuggen des Access Denied Fehlers</h2>
<p>
Raten woher der Fehler kommt ist immer die schlechteste Idee, auch wenn es hin und wieder
zum Ziel f&uuml;hrt. Vorzuziehen ist eine Checkliste, anhand derer man vorgeht. Erstens vergisst
man nichts, zweitens ver&auml;ndert man nichts durch "herumprobieren".
</p>
<p>
Folgende Schritte sollten ausgef&uuml;hrt werden, damit man in grob einer Stunde (sp&auml;testens) den Fehler
gefunden hat:
</p>

<ol>
    <li>Auditing von Privilegienverwendung (fehlgeschlagener) einschalten &amp; kontrollieren
    <li>ACL Problem am Dateisystem
    <li>ACL Problem in der Registry
</ol>

<p>
Findet man den Fehler in einem der oberen Schritte, sind die nachfolgenden nat&uuml;rlich nicht
mehr durchzuf&uuml;hren.
</p>

<h3>Auditing von Privilegienverwendung</h3>
<p>
Am schnellsten herauszufinden ist ob ein fehlendes Privileg (User Right) den Fehler verursacht
hat. Dazu mu&szlig; man zuerst das Auditing f&uuml;r Privilegien einschalten. Dies geschieht &uuml;ber Local
Security Settings, oder &uuml;ber Group Policies (Active Directory).
</p>
<p>
<b>Achtung</b> Es gelten die genau gleichen
Probleme wie f&uuml;r die Zuweisung von Privilegien - wer zuletzt kommt gewinnt.
</p>

<IMG SRC="Bilder/200111/20011119_3.png" width="710" height="473" alt="" border="0">

<p>
Um nun herauszufinden, ob ein fehlendes Privileg schuld an unserem Access Denied Fehler
war, mu&szlig; man nur im Security Log des Event Logs nachsehen. Dort steht dann, welches Privileg
gefehlt hat. Bevor man an den Privilegien herumdreht, sollte man allerdings den Netzwerkadministrator
zu Rate ziehen, welche Nebenwirkungen eine solche Umstellung haben k&ouml;nnte!
</p>

<h3>ACL Problem am Dateisystem</h3>
<p>
Bei einem ACL Problem auf einer Datei wird die Suche schon ein wenig interessanter - einerseits
k&ouml;nnte man es mit Auditing erledigen, nur allerdings ist das ziemlich aufwendig. Ein schnellerer
Weg zum Ziel ist <a href="http://www.sysinternals.com/ntw2k/source/filemon.shtml" target="_blank">FileMon von SysInternals</a>.
</p>

<p>
Das Tool startet das Mitloggen sofort nach dem Start (Achtung: man ben&ouml;tigt Administratorenrechte
um dieses Tool ausf&uuml;hren zu k&ouml;nnen):
</p>

<IMG SRC="Bilder/200111/20011119_5.png" width="670" height="423" alt="" border="0">

<p>
Das Mitloggen kann mittels <b>Ctrl+E</b> gestoppt werden. Ob etwas schiefgegangen ist, kann man
mittels der <i>Result</i> Spalte ermitteln, einfacher ist es jedoch, das Log als Textdatei zu 
speichern, und in Notepad ganz einfach nach "Access Denied" zu suchen. 
</p>

<p>
Wie kuriert man ein Access Denied auf einer Datei? Nun, hierzu lockert man die NTFS Berechtigungen
solange, bis der Access Denied Fehler nicht mehr auftritt. Die Radikalkur des Vollzugriffs f&uuml;r Jeder
ist sicherlich keine L&ouml;sung!
</p>


<h3>ACL Problem in der Registry</h3>
<p>
Auch wenn es viele Leute nicht wissen, auch die Registrierungsdatenbank ist mit ACL's abgesichert.
Man sieht dies mit <b>regedit.exe</b> nicht, diese ACL's werden erst mit <b>regedt32.exe</b> sichtbar:
</p>

<IMG SRC="Bilder/200111/20011119_4.png" width="636" height="463" alt="" border="0">

<p>
Um einem Registry-ACL-Fehler auf die Schliche zu kommen hilft nur eines -
<a href="http://www.sysinternals.com/ntw2k/source/regmon.shtml" target="_blank">RegMon von Sysinternals</a>.
Auch dieses Tool ist wie FileMon gratis, und man kann sogar den Sourcecode downloaden.
</p>

<IMG SRC="Bilder/200111/20011119_6.png" width="600" height="300" alt="" border="0">

<p>
Die Verwendung ist ident zu Filemon - zuerst mitloggen, dann nach "Access Denied" suchen. Am wahrscheinlichsten
findet sich das Problem f&uuml;r Access Denied im Zweig HKEY_LOCAL_MACHINE.
</p>

<h2>Schlu&szlig;bemerkung</h2>
<p>
Es gibt drei Gr&uuml;nde f&uuml;r Access Denied Fehler: fehlende Privilegien, ACL's auf Dateien und ACL's
auf Registrierungsschl&uuml;sseln. Mit der richtigen Strategie zur Fehlersuche erspart man sich Zeit
und kann den Fehler gezielt einkreisen und eliminieren.
</p><h2>Verwandte Artikel</h2>
<p>
<a href="20010508.htm">Dateizugriff auf Netzlaufwerken</a><br>
<a href="20020123.htm">Impersonation mit ASP.NET</a><br>
<a href="20020129.htm">Komponentenverwendung einschr&auml;nken</a><br>
<a href="20010402.htm">NT Account Management via ASP</a><br>
<a href="20010926.htm">Schlu&szlig; mit lustig - das IIS Lockdown Tool</a><br>
<a href="20010927.htm">Schlu&szlig; mit lustig Teil 2 - das URLScan Tool</a><br>
<a href="20010928.htm">Schlu&szlig; mit lustig Teil 3 - das Hfnetchk Tool</a><br>
<a href="20001109.htm">Verzeichnissicherheit mit NTFS und IIS Authentifizierung</a><br>

</p>
<h2>Links zu anderen Sites</h2>
<p>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Esysinternals%2Ecom%2Fntw2k%2Fsource%2Ffilemon%2Eshtml">FileMon</a><br>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Esysinternals%2Ecom%2Fntw2k%2Fsource%2Fregmon%2Eshtml">RegMon</a><br>

</p>

<h2>Wenn Sie jetzt Fragen haben...</h2>
<p>
Wenn Sie Fragen rund um die in diesem Artikel vorgestellte Technologie haben, dann schauen Sie einfach bei uns
in den <a href="http://glengamoi.com/forums/">Community Foren der deutschen .NET Community</a> vorbei. Die Teilnehmer 
helfen Ihnen gerne, wenn Sie sich zur im Artikel vorgestellten Technologie weiterbilden m&ouml;chten.
</p>

<p>
<a href="http://glengamoi.com/forums/"><img src="../images/glengamoi.com_250.gif" width="250" height="80" alt="" border="0"></a>
</p>


<p>
Haben Sie Fragen die sich direkt auf den Inhalt des Artikels beziehen, dann schreiben Sie dem Autor! Unsere Autoren
freuen sich &uuml;ber Feedback zu ihren Artikeln. Ein einfacher Klick auf die <i>Autor kontaktieren</i>
Schaltfl&auml;che (weiter unten) und schon haben Sie ein f&uuml;r diesen Artikel personalisiertes Anfrageformular.
</p>

<p>&nbsp;</p>
<p>
Und zu guter Letzt m&ouml;chten wir Sie bitten, den Artikel zu bewerten. Damit helfen Sie uns, 
die Qualit&auml;t der Artikel zu verbessern - und anderen Lesern bei der Auswahl der Artikel,
die sie lesen sollten.
</p>

<FORM METHOD="POST" STYLE="margin-bottom: 0px;" NAME="formRating" ACTION="/service/bewerten.asp">
<INPUT TYPE="HIDDEN" NAME="ArticleId" VALUE="20011119" />
<CENTER>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
	<TD ALIGN="CENTER" VALIGN="MIDDLE" COLSPAN="7">Bewerten Sie diesen Artikel</TD>
</TR>
<TR>
	<TD><EM>&nbsp;Sehr gut&nbsp;</EM></TD>
	<TD><INPUT TYPE="radio" value="1" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="2" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="3" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="4" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="5" NAME="radioRating" /></TD>
	<TD ALIGN="right"><EM>&nbsp;Nicht gen&uuml;gend</EM></TD>
	<TD ROWSPAN="2" VALIGN="middle">&nbsp;<INPUT TYPE="submit" VALUE="Werten!" /></TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD ALIGN="CENTER">&nbsp;1</TD>
	<TD ALIGN="CENTER">&nbsp;2</TD>
	<TD ALIGN="CENTER">&nbsp;3</TD>
	<TD ALIGN="CENTER">&nbsp;4</TD>
	<TD ALIGN="CENTER">&nbsp;5</TD>
	<TD>&nbsp;</TD>
</TR>
</TABLE>
</FORM>
</center>
&nbsp;<P>
<center>
<p><table><tr><td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="pagetitle" value="Schritt-f&uuml;r-Schritt Debuggen von Sicherheitsproblemen"><input type="hidden" name="pageurl" value="http://www.aspheute.com/artikel/20011119.htm"><input type="image" src="../images/layout/senden.png" width="107" height="20" border="0" alt="Schicken Sie diese Seite einem Freund!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="Author" value="Christoph Wille"><input type="hidden" name="AuthorEmail" value="christophw@alphasierrapapa.com"><input type="hidden" name="Artikel" value="20011119"><input type="image" src="../images/layout/kontakt.png" width="107" height="20" border="0" alt="Kontaktieren Sie den Autor!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top><a href="../PrinterFriendly/20011119.htm"><img src="../images/layout/druck.png" width="118" height="20" border="0" alt="F&uuml;r Ausdruck optimierte Seite"></a></td>
</tr></table></p>
</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
