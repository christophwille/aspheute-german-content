<HTML>
<HEAD>
<TITLE>Eigene History</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="7 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="Dieser Artikel zeigt, wie man mit server-side ASP die History des Client-Browsers modifiziert - damit der User Daten nicht zweimal eingeben kann.">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,History,JavaScript,Back,Session,Browserhistory">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff"  BACKGROUND="../images/layout/aspheutemainbg.gif" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<MAP NAME="titlebar">
<!--<AREA SHAPE=RECT COORDS="116,46,191,61" HREF="http://www.aspaktuell.com" ALT="ASP Aktuell">-->
<!--<AREA SHAPE=RECT COORDS="192,46,255,61" HREF="http://www.aspwelt.com" ALT="ASP Welt">-->
<AREA SHAPE=RECT COORDS="256,46,432,61" HREF="http://www.aspgerman.com/aspgerman/" ALT="ASP German">
<AREA SHAPE=RECT COORDS="115,15,269,42" HREF="../default.htm" ALT="Homepage">
<AREA SHAPE=RECT COORDS="278,26,587,42" HREF="../default.htm" ALT="Homepage">
</MAP>

<div style="position:absolute;left:0px;top:30px">
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td background="../images/layout/aspheutetitle.gif">
<img src="../images/layout/blind.gif" width="715" height="73" usemap="#titlebar" border="0">
</td>
<td width="100%" background="../images/layout/aspheutetitleext.gif">
&nbsp;
</td>
<td background="../images/layout/aspheutetitleend.gif">
<img src="../images/layout/blind.gif" width="25" height="1">
</td>
</tr>
</table>
</div>

<div style="position:absolute;left:1px;top:115px">
<table width="110" border="0" cellspacing="0" cellpadding="0">
<tr><td width="110"><img src="../Images/spacer.gif" width="110" height="1" alt="" border="0"></td></tr>
<tr>
<td background="../images/layout/aspheuteheader.gif" class="header" height=16 width="110">
<p>Liste</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">

<p class="content">
<a href="../kategorien/dotNET%202dot0.htm">.NET 2.0 (1)</a><br>
<a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein (16)</a><br>
<a href="../kategorien/dotNET%20Fu.htm">.NET Fu (5)</a><br>
<a href="../kategorien/ADOdotNET.htm">ADO.NET (11)</a><br>
<a href="../kategorien/Aprilscherz.htm">Aprilscherz (3)</a><br>
<a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen (44)</a><br>
<a href="../kategorien/ASP%20Tricks.htm">ASP Tricks (83)</a><br>
<a href="../kategorien/ASPdotNET.htm">ASP.NET (44)</a><br>
<a href="../kategorien/ASPIntranetdotde.htm">ASPIntranet.de (5)</a><br>
<a href="../kategorien/Csharp.htm">C# (28)</a><br>
<a href="../kategorien/Datenbank.htm">Datenbank (44)</a><br>
<a href="../kategorien/Dokumentation.htm">Dokumentation (4)</a><br>
<a href="../kategorien/IIS%206dot0.htm">IIS 6.0 (1)</a><br>
<a href="../kategorien/Komponenten.htm">Komponenten (29)</a><br>
<a href="../kategorien/Optimierung.htm">Optimierung (10)</a><br>
<a href="../kategorien/Server.htm">Server (21)</a><br>
<a href="../kategorien/Sicherheit.htm">Sicherheit (34)</a><br>
<a href="../kategorien/Tee%20Off.htm">Tee Off (6)</a><br>
<a href="../kategorien/VBdotNET.htm">VB.NET (6)</a><br>
<a href="../kategorien/WAP.htm">WAP (8)</a><br>
<a href="../kategorien/Web%20Services.htm">Web Services (11)</a><br>
<a href="../kategorien/XML.htm">XML (9)</a><br>


<br>
<a href="/syndication/rss.xml"><img src="../Images/rss_small.png" width="25" height="10" alt="RSS 2.0 - Die neuesten f&uuml;nf Artikel auf AspHeute.com" border="0"></a>

</p><!-- </p> remains -->


<br>

</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearch.gif" class="header" height=16 width="110">
<p>Suchen</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearchext.gif" class="header" width="110">
<form class="content" ACTION="REMOVED" METHOD="GET">
<div>
<input class="Newsletter" type="text" size="10" name="CiRestriction">
<span class="spacer2"><br></span>
<span class="spacer4"><br></span>
<INPUT TYPE="HIDDEN" NAME="CiMaxRecordsPerPage" VALUE="10">
<INPUT TYPE="HIDDEN" NAME="CiSort" VALUE="rank[d]">
<INPUT TYPE="HIDDEN" NAME="HTMLQueryForm" VALUE="../default.htm">
<img src="../images/layout/blind.gif" width="41" height="1"><input type="image" src="../images/layout/aspheutesearchenter.gif" border="0" width="49" height="14"><br>
<span class="spacer4"><br></span>
</div>
</form>
</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">
<p class="content">
<a href="/REMOVED/" title="Our most popular articles translated into English">English Articles</a><br>
<a href="/REMOVED/" title="Visit our Chinese content section">Chinese Articles</a><br>
<a href="../autoren/UnsereAutoren.htm" title="Unsere Autoren">Unsere Autoren</a><br>
&nbsp;<br>
<a href="/REMOVED/link2us.asp" title="Setzen Sie einen Link zu AspHeute!">Link zu AspHeute</a><br>
<a href="/REMOVED/impressum.asp" title="Das Impressum von AspHeute">Impressum</a><br>
<a href="/REMOVED/advertise.asp" title="Werben auch Sie auf AspHeute">Werben</a><br>
<a href="/REMOVED/kontakt.asp" title="Teilen Sie uns Ihre W&uuml;nsche, Beschwerden und Anregungen mit">Anfragen</a><br>
</p>
</td>
</tr>
</table>
</div>



<!-- Content starts here  -->
<div style="position:absolute;left:120px;top:108px">
<table cellspacing="0" cellpadding="0"><!--Tabelle aussen-->
<tr><!--Tabelle aussen, 1/2-->
<td><!--Tabelle aussen, 1/1-->
    <table border=0 align=center><tr><td align=center>


</td></tr></table>

<H1>Eigene History</H1>
<p>
Geschrieben von: <a href="../autoren/rainervoelschow.htm">Rainer Völschow</a><br>
Kategorie: <a href="../kategorien/ASP%20Tricks.htm">ASP Tricks</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20001027"></SCRIPT>
</p>
<p>
Wenn man beim Browser eine Seite besucht hat und mit Javascript () oder dem Back-Button eine oder 
mehrere Seiten zur&uuml;ckspringt, so kann man mittels des Forward-Buttons zu dieser Seite zur&uuml;ckkehren.
Dies erm&ouml;glicht so einem User, Daten zweimal einzugeben. Wie man dies verhindert, soll dieser 
Artikel zeigen. Weil die Historyliste des Browsers nur in geringem Ma&szlig;e (&uuml;ber client-side 
JavaScript oder VBScript) manipuliert werden kann, mu&szlig; eine andere L&ouml;sung gefunden werden.
</p>

<h2>Anlegen einer Liste</h2>
<p>
Eine L&ouml;sung des Problems best&auml;nde darin, eine eigene History f&uuml;r jeden User am Webserver mittels 
ASP anzulegen. Kern dieses Unterfangens ist die Servervariable <i>SCRIPT_NAME</i>. Sie enth&auml;lt den Namen 
(inklusive Pfad) der aktuellen ASP Seite.
</p>
<p>
Man kann also mittels der ServerVariable <i>SCRIPT_NAME</i> den Namen des augenblicklich abgearbeiteten 
ASP Skripts inklusive dem virtuellen Pfad (z.b. <i>/support/anfrage.asp</i>)  auslesen, diesen mit den 
besuchten Seiten in der Historyliste vergleichen, und danach die besuchte Seite zur Historyliste 
hinzuf&uuml;gen.
</p>

<h2>Speichern der Liste in einer Session Variable</h2>
<p>
&Auml;hnlich wie das client-side Vorbild - das History Objekt im Browser - soll auch die von uns benutzte 
Liste skript&uuml;bergreifend verf&uuml;gbar sein. Allerdings soll die Liste gel&ouml;scht werden, wenn die 
aktuelle Webapplikation nicht mehr verwendet wird. Diese Eigenschaft erf&uuml;llen vorrangig ASP 
Sessionvariablen.
</p>
<p>
Wie man nun die augenblickliche Seite abfragt und die in einer Sessionvariable gespeicherte 
Historyliste verwaltet, zeigt das folgende ASP Skript:
<pre style="background='silver';">
&lt;%
 curSite = Request.Servervariables("Script_Name")
 ablage = Session("history")
 If InStr(ablage,curSite) &gt; 0 Then 
 Response.Write("Diese Seite wurde schon besucht." &amp; _ 
    "&lt;a href=javascript:history.go(-1)&gt;Zur&uuml;ck&lt;/a&gt;")
 Else
    Session("history") = Session("history") &amp; _
    curSite &amp; " | "
 End if
%&gt;
</pre>
</p>
<p>
Zun&auml;chst wird im ersten Schritt der Name (inklusive virtuellem Pfad) des aktuellen Skriptes 
ermittelt und in der Variablen <i>curSite</i> abgelegt. Der Inhalt der Sessionvariable History wird 
in der Variablen ablage zwischengespeichert. Im Anschlu&szlig; daran wird mit Hilfe der Funktion 
<i>InStr</i> (= in String enthalten) &uuml;berpr&uuml;ft, ob der zuvor ermitteltet Name der augenblicklichen 
ASP Seite, der jetzt als String zur Verf&uuml;gung steht, sich bereits in der Variable <i>ablage</i> 
befindet oder nicht. Der R&uuml;ckgabewert der Funktion <i>InStr</i> ist f&uuml;r diese &Uuml;berpr&uuml;fung entweder 0 
f&uuml;r den Fall, da&szlig; die Seite noch nicht besucht wurde, oder gr&ouml;&szlig;er als 0, wenn die Seite bereits 
in der Variablen <i>ablage</i> gespeichert ist. Die Null als Ergebnis der InStr Funktion bedeutet, da&szlig; 
die Zeichenkette <i>cursite</i> nicht in der Zeichenkette <i>ablage</i> vorhanden ist. Ein Wert von gr&ouml;&szlig;er 
als Null gibt die Position der Zeichenkette <i>ablage</i> in <i>curSite</i> an. 
</p>
<p>
Wird nun dieser String in der Sessionvariable nicht gefunden, so wird der Inhalt der Sessionvariable
um den Variableninhalt von <i>curSite</i> erweitert. Das Zeichen " | " dient als Trennzeichen und kann 
eigentlich durch jedes beliebige andere Zeichen ersetzt werden. Es wird aber nicht empfohlen, den 
Punkt oder den Schr&auml;gstrich (Slash) zu verwenden, weil selbiger bereits im Namen der ASP Datei 
verwendet wird. Da dieser Skriptteil in jeder gesch&uuml;tzen Seite gleich aussieht und unver&auml;ndert 
verwendet werden kann, ist das Includen des Scripts, mittels <i>#include</i> Directive, in alle zu 
sch&uuml;tzenden ASP Seiten empfehlenswert.
</p>
<p>
Auch das Z&auml;hlen der Eintr&auml;ge ist in unserer Historyliste m&ouml;glich. Nun gibt es in VBScript keine 
vordefinierte Zeichenkettenfunktion, mit der man einfach die Anzahl eines beliebigen Zeichens 
ermitteln kann (vom RegExp Objekt in VBScript 5 kann man nicht sagen, da&szlig; es einfach zu benutzen 
ist). Im Gegensatz dazu gibt es bei den Arrays eine Z&auml;hlfunktion, mit der man die Anzahl der 
Elemente ermitteln kann. Bevor man diese Funktion benutzen kann,  mu&szlig; zun&auml;chst ein Aufsplitten 
des Strings in ein Array erfolgen. Da der Inhalt der Sessionvariable weiterhin ben&ouml;tigt wird, 
darf dieser nicht ver&auml;ndert werden. 
</p>
<p>
<pre style="background='silver';">
&lt;%
  ablage = Split(Session("history"),"|")
  anzahl = UBound(ablage,1)
%&gt;
</pre>
</p>
<p>
Das Aufsplitten der Zeichenkette in ein Array kann, wie hier gezeigt, mit der Funktion 
<i>Split(Variable, Trennzeichen)</i> erfolgen. Jeder Teilstring zwischen dem zuvor definierte 
Trennzeichen wird in ein eigenes Arrayelelement geschrieben. Nach  Umwandlung der Zeichenkette 
in ein Array kann man mit der Funktion U<i>Bound(Arrayname, Dimension)</i> die Abmessungen eines Arrays 
ermitteln. Der Parameter 1 gibt nur an, da&szlig; die Anzahl der Elemente in der ersten Dimension des  
Array ermittelt werden soll. 
</p>
<p>
Das L&ouml;schen von Eintr&auml;gen in der History Session Variable erfolgt mit <i>Replace</i>, wobei zu beachten 
ist, da&szlig; auch das Trennzeichen gel&ouml;scht wird. So verhindert man ein Verf&auml;lschung der Anzahl von 
Listeneintr&auml;gen. Der Historyinhalt kann durch Verwendung von Response.Write() zum Browser 
geschrieben werden.
</p>
<p>
Mit Verlassen der Webapplikation (Schlie&szlig;en der Browserfenster oder Inaktivit&auml;t auf der Website 
f&uuml;r eine gewisse Zeitspanne) durch den User wird die aktuelle Session beendet, wodurch auch die 
Sessionvariable History ihre G&uuml;ltigkeit verliert und vom Server automatisch verworfen wird.
</p>

<h2>M&ouml;glichkeit des Speicherns der History in der Application</h2>
<p>
Der Nachteil bei der Verwendung von Session Variablen ist, da&szlig; der Browser einen Session Cookies 
speichern mu&szlig;, damit der Webserver den Aufruf einer ASP Seite einer bestimmten Session zuordnen 
kann. Akzeptiert der Browser keine Cookies, so beginnt f&uuml;r den Benutzer mit dem Aufruf einer 
neuen ASP Seite eine neue Session. VBScript bietet als Alternative zu Sessionvariablen die 
Applicationvariablen an, die an keine Cookies gebunden sind. Im Gegensatz zu den Sessionvariablen 
werden sie nicht der aktuellen SessionID zugeordnet, so da&szlig; der Inhalt einer Applicationvariablen
f&uuml;r ASP Skripts aller Benutzer zu Verf&uuml;gung steht. 
</p>
<p>
Aufgrund dieser Eigenschaft ist f&uuml;r das Anlegen einer eigenen Historyliste ein wenig mehr 
Programmieraufwand n&ouml;tig, um f&uuml;r jeden Benutzer eine eigene Historyliste zu erstellen. Dies kann
durch die Definition eines Variablenames erreicht werden, der f&uuml;r jeden Benutzer eindeutig 
sein mu&szlig;. Au&szlig;erdem mu&szlig; darauf geachtet werden, da&szlig; nicht mehr ben&ouml;tigte Application Variablen 
gel&ouml;scht werden, da ansonsten der Speicher des Webservers unn&ouml;tig belastet und zugem&uuml;llt wird, 
was sich in einer drastischen Performanceeinbu&szlig;e bemerkbar macht. 
</p>

<h2>Schlu&szlig;bemerkung</h2>
<p>
Die hier vorgestellte M&ouml;glichkeit kann innerhalb einer User-Session (Sitzung) verhindern, da&szlig; 
der Besucher Daten in eine Datenbank doppelt eintr&auml;gt. Allerdings k&ouml;nnte man eine bereits 
besuchte Seite immer noch mit den 'Vorw&auml;rts' oder 'Zur&uuml;ck'-Buttons des Browsers erreichen. Will 
man auch dies verhindern so wendet man einen weiteren Kunstgriff an, indem man in jedem ASP 
Skript am Anfang das Ablaufdatum f&uuml;r eine ASP Seite auf "Sofort" setzt:
</p>
<p>
<pre style="background='silver';">
Response.Expires=0
Response.AddHeader "Pragma","no-cache"
Response.AddHeader "cache-control", "no-store"
</pre>
</p>
<p>
Dies veranlasst die meisten Browser, die Seite nicht mehr anzuzeigen wenn man mit den 
'Vorw&auml;rts' oder 'Zur&uuml;ck'-Buttons arbeitet.
</p>
<h2>Download des Codes</h2>
<p><a href="../Code/20001027.zip">Klicken Sie hier</a>, um den Download zu starten.</p>
<h2>Verwandte Artikel</h2>
<p>
<a href="19990808.htm">Caching bei Browser und Proxy - Woher Seiten wirklich kommen</a><br>
<a href="20010530.htm">Redirects mit Frame-Targets</a><br>

</p>

<h2>Wenn Sie jetzt Fragen haben...</h2>
<p>
Wenn Sie Fragen rund um die in diesem Artikel vorgestellte Technologie haben, dann schauen Sie einfach bei uns
in den <a href="http://glengamoi.com/forums/">Community Foren der deutschen .NET Community</a> vorbei. Die Teilnehmer 
helfen Ihnen gerne, wenn Sie sich zur im Artikel vorgestellten Technologie weiterbilden m&ouml;chten.
</p>

<p>
<a href="http://glengamoi.com/forums/"><img src="../images/glengamoi.com_250.gif" width="250" height="80" alt="" border="0"></a>
</p>


<p>
Haben Sie Fragen die sich direkt auf den Inhalt des Artikels beziehen, dann schreiben Sie dem Autor! Unsere Autoren
freuen sich &uuml;ber Feedback zu ihren Artikeln. Ein einfacher Klick auf die <i>Autor kontaktieren</i>
Schaltfl&auml;che (weiter unten) und schon haben Sie ein f&uuml;r diesen Artikel personalisiertes Anfrageformular.
</p>

<p>&nbsp;</p>
<p>
Und zu guter Letzt m&ouml;chten wir Sie bitten, den Artikel zu bewerten. Damit helfen Sie uns, 
die Qualit&auml;t der Artikel zu verbessern - und anderen Lesern bei der Auswahl der Artikel,
die sie lesen sollten.
</p>

<FORM METHOD="POST" STYLE="margin-bottom: 0px;" NAME="formRating" ACTION="/service/bewerten.asp">
<INPUT TYPE="HIDDEN" NAME="ArticleId" VALUE="20001027" />
<CENTER>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
	<TD ALIGN="CENTER" VALIGN="MIDDLE" COLSPAN="7">Bewerten Sie diesen Artikel</TD>
</TR>
<TR>
	<TD><EM>&nbsp;Sehr gut&nbsp;</EM></TD>
	<TD><INPUT TYPE="radio" value="1" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="2" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="3" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="4" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="5" NAME="radioRating" /></TD>
	<TD ALIGN="right"><EM>&nbsp;Nicht gen&uuml;gend</EM></TD>
	<TD ROWSPAN="2" VALIGN="middle">&nbsp;<INPUT TYPE="submit" VALUE="Werten!" /></TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD ALIGN="CENTER">&nbsp;1</TD>
	<TD ALIGN="CENTER">&nbsp;2</TD>
	<TD ALIGN="CENTER">&nbsp;3</TD>
	<TD ALIGN="CENTER">&nbsp;4</TD>
	<TD ALIGN="CENTER">&nbsp;5</TD>
	<TD>&nbsp;</TD>
</TR>
</TABLE>
</FORM>
</center>
&nbsp;<P>
<center>
<p><table><tr><td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="pagetitle" value="Eigene History"><input type="hidden" name="pageurl" value="http://www.aspheute.com/artikel/20001027.htm"><input type="image" src="../images/layout/senden.png" width="107" height="20" border="0" alt="Schicken Sie diese Seite einem Freund!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="Author" value="Rainer Völschow"><input type="hidden" name="AuthorEmail" value="rvoelsch@gmx.de"><input type="hidden" name="Artikel" value="20001027"><input type="image" src="../images/layout/kontakt.png" width="107" height="20" border="0" alt="Kontaktieren Sie den Autor!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top><a href="../PrinterFriendly/20001027.htm"><img src="../images/layout/druck.png" width="118" height="20" border="0" alt="F&uuml;r Ausdruck optimierte Seite"></a></td>
</tr></table></p>
</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
