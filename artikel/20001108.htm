<HTML>
<HEAD>
<TITLE>SQL Server Objekte scripten</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="7 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="Im heutigen Artikel besch&auml;ftigen wir uns damit, wie man von existierenden Objekten in SQL Server Datenbanken ein Script erstellen kann, das man dann auf einem anderen Server verwenden kann, um idente Objekte zu erstellen.">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,SQLDMO,SQL Server,SQL Server 2000,Scripting,Enterprise Manager,Generate SQL Script">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff"  BACKGROUND="../images/layout/aspheutemainbg.gif" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<MAP NAME="titlebar">
<!--<AREA SHAPE=RECT COORDS="116,46,191,61" HREF="http://www.aspaktuell.com" ALT="ASP Aktuell">-->
<!--<AREA SHAPE=RECT COORDS="192,46,255,61" HREF="http://www.aspwelt.com" ALT="ASP Welt">-->
<AREA SHAPE=RECT COORDS="256,46,432,61" HREF="http://www.aspgerman.com/aspgerman/" ALT="ASP German">
<AREA SHAPE=RECT COORDS="115,15,269,42" HREF="../default.htm" ALT="Homepage">
<AREA SHAPE=RECT COORDS="278,26,587,42" HREF="../default.htm" ALT="Homepage">
</MAP>

<div style="position:absolute;left:0px;top:30px">
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td background="../images/layout/aspheutetitle.gif">
<img src="../images/layout/blind.gif" width="715" height="73" usemap="#titlebar" border="0">
</td>
<td width="100%" background="../images/layout/aspheutetitleext.gif">
&nbsp;
</td>
<td background="../images/layout/aspheutetitleend.gif">
<img src="../images/layout/blind.gif" width="25" height="1">
</td>
</tr>
</table>
</div>

<div style="position:absolute;left:1px;top:115px">
<table width="110" border="0" cellspacing="0" cellpadding="0">
<tr><td width="110"><img src="../Images/spacer.gif" width="110" height="1" alt="" border="0"></td></tr>
<tr>
<td background="../images/layout/aspheuteheader.gif" class="header" height=16 width="110">
<p>Liste</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">

<p class="content">
<a href="../kategorien/dotNET%202dot0.htm">.NET 2.0 (1)</a><br>
<a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein (16)</a><br>
<a href="../kategorien/dotNET%20Fu.htm">.NET Fu (5)</a><br>
<a href="../kategorien/ADOdotNET.htm">ADO.NET (11)</a><br>
<a href="../kategorien/Aprilscherz.htm">Aprilscherz (3)</a><br>
<a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen (44)</a><br>
<a href="../kategorien/ASP%20Tricks.htm">ASP Tricks (83)</a><br>
<a href="../kategorien/ASPdotNET.htm">ASP.NET (44)</a><br>
<a href="../kategorien/ASPIntranetdotde.htm">ASPIntranet.de (5)</a><br>
<a href="../kategorien/Csharp.htm">C# (28)</a><br>
<a href="../kategorien/Datenbank.htm">Datenbank (44)</a><br>
<a href="../kategorien/Dokumentation.htm">Dokumentation (4)</a><br>
<a href="../kategorien/IIS%206dot0.htm">IIS 6.0 (1)</a><br>
<a href="../kategorien/Komponenten.htm">Komponenten (29)</a><br>
<a href="../kategorien/Optimierung.htm">Optimierung (10)</a><br>
<a href="../kategorien/Server.htm">Server (21)</a><br>
<a href="../kategorien/Sicherheit.htm">Sicherheit (34)</a><br>
<a href="../kategorien/Tee%20Off.htm">Tee Off (6)</a><br>
<a href="../kategorien/VBdotNET.htm">VB.NET (6)</a><br>
<a href="../kategorien/WAP.htm">WAP (8)</a><br>
<a href="../kategorien/Web%20Services.htm">Web Services (11)</a><br>
<a href="../kategorien/XML.htm">XML (9)</a><br>


<br>
<a href="/syndication/rss.xml"><img src="../Images/rss_small.png" width="25" height="10" alt="RSS 2.0 - Die neuesten f&uuml;nf Artikel auf AspHeute.com" border="0"></a>

</p><!-- </p> remains -->


<br>

</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearch.gif" class="header" height=16 width="110">
<p>Suchen</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearchext.gif" class="header" width="110">
<form class="content" ACTION="REMOVED" METHOD="GET">
<div>
<input class="Newsletter" type="text" size="10" name="CiRestriction">
<span class="spacer2"><br></span>
<span class="spacer4"><br></span>
<INPUT TYPE="HIDDEN" NAME="CiMaxRecordsPerPage" VALUE="10">
<INPUT TYPE="HIDDEN" NAME="CiSort" VALUE="rank[d]">
<INPUT TYPE="HIDDEN" NAME="HTMLQueryForm" VALUE="../default.htm">
<img src="../images/layout/blind.gif" width="41" height="1"><input type="image" src="../images/layout/aspheutesearchenter.gif" border="0" width="49" height="14"><br>
<span class="spacer4"><br></span>
</div>
</form>
</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">
<p class="content">
<a href="/REMOVED/" title="Our most popular articles translated into English">English Articles</a><br>
<a href="/REMOVED/" title="Visit our Chinese content section">Chinese Articles</a><br>
<a href="../autoren/UnsereAutoren.htm" title="Unsere Autoren">Unsere Autoren</a><br>
&nbsp;<br>
<a href="/REMOVED/link2us.asp" title="Setzen Sie einen Link zu AspHeute!">Link zu AspHeute</a><br>
<a href="/REMOVED/impressum.asp" title="Das Impressum von AspHeute">Impressum</a><br>
<a href="/REMOVED/advertise.asp" title="Werben auch Sie auf AspHeute">Werben</a><br>
<a href="/REMOVED/kontakt.asp" title="Teilen Sie uns Ihre W&uuml;nsche, Beschwerden und Anregungen mit">Anfragen</a><br>
</p>
</td>
</tr>
</table>
</div>



<!-- Content starts here  -->
<div style="position:absolute;left:120px;top:108px">
<table cellspacing="0" cellpadding="0"><!--Tabelle aussen-->
<tr><!--Tabelle aussen, 1/2-->
<td><!--Tabelle aussen, 1/1-->
    <table border=0 align=center><tr><td align=center>


</td></tr></table>

<H1>SQL Server Objekte scripten</H1>
<p>
Geschrieben von: <a href="../autoren/christophwille.htm">Christoph Wille</a><br>
Kategorie: <a href="../kategorien/Datenbank.htm">Datenbank</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20001108"></SCRIPT>
</p>
<p>
Im heutigen Artikel besch&auml;ftigen wir uns damit, wie man von existierenden Objekten in SQL Server
Datenbanken ein Script erstellen kann, das man dann auf einem anderen Server verwenden kann, um idente Objekte
zu erstellen (Schema, nicht Daten). Dazu werde ich zwei Wege beschreiben - der interaktive Weg &uuml;ber den
Enterprise Manager, als auch wie man es programmatisch erledigen kann.
</p>

<h2>Scripting im Enterprise Manager</h2>
<p>
Die Variante, die jeder Datenbankadministrator sicher schon einmal verwendet hat, ist Generate <i>SQL Scripts</i>.
Dazu selektiert man ein Objekt in der Datenbank (in diesem Fall eine Tabelle), klickt mit der rechten Maustaste, und
w&auml;hlt den entsprechenden Befehl im Kontextmen&uuml;:
</p>
<p><IMG SRC="Bilder/200011/20001108_01.png" width="590" height="427" alt="" border="0"></p>
<p>
Damit &ouml;ffnet sich die Dialogbox <i>Generate SQL Scripts</i>. Hier ist standardm&auml;&szlig;ig nur das zuvor selektierte
Objekte gew&auml;hlt, klickt man allerdings auf <i>Show All</i> kann man alle Tables, Views, Stored Procedures etc.
scripten.
</p>
<p><IMG SRC="Bilder/200011/20001108_02.png" width="544" height="417" alt="" border="0"></p>
<p>
Es gibt etliche Formatierungsoptionen f&uuml;r das zu generierende Script. Standardm&auml;&szlig;ig sollte man sich ein DROP
Statement generieren lassen, das allf&auml;llig existierende Objekte gleichen Namens (und nat&uuml;rlich Typs) l&ouml;scht.
Da das ein Screenshot f&uuml;r SQL Server 2000 ist, hat man hier zus&auml;tzlich die Option, nur SQL 7.0 kompatible
Statements generieren zu lassen.
</p>
<p><IMG SRC="Bilder/200011/20001108_03.png" width="544" height="417" alt="" border="0"></p>
<p>
In den Optionen wird es dann so richtig interessant. Hier kann man Roles und Users scripten lassen, die Indexes
und Triggers mitscripten (f&uuml;r Tabellen wichtig!), als auch Prim&auml;rschl&uuml;ssel und Fremdschl&uuml;ssel - ebenfalls f&uuml;r
Tabellen.
</p>
<p><IMG SRC="Bilder/200011/20001108_04.png" width="544" height="417" alt="" border="0"></p>
<p>
Klickt man nun auf OK, wird man noch nach einem Dateinamen f&uuml;r das Skript gefragt, und schon generiert der 
Enterprise Manager das SQL Script. Beispielsweise k&ouml;nnte es so aussehen:
<pre style="background='silver';">
if exists (select * from dbo.sysobjects where 
   id = object_id(N'[dbo].[FK_Products_Categories]') 
   and OBJECTPROPERTY(id, N'IsForeignKey') = 1)
ALTER TABLE [dbo].[Products] DROP CONSTRAINT FK_Products_Categories
GO

if exists (select * from dbo.sysobjects where 
   id = object_id(N'[dbo].[Categories]') 
   and OBJECTPROPERTY(id, N'IsUserTable') = 1)
drop table [dbo].[Categories]
GO

CREATE TABLE [dbo].[Categories] (
	[CategoryID] [int] IDENTITY (1, 1) NOT NULL ,
	[CategoryName] [nvarchar] (15) COLLATE 
         SQL_Latin1_General_CP1_CI_AS NOT NULL ,
	[Description] [ntext] COLLATE SQL_Latin1_General_CP1_CI_AS NULL ,
	[Picture] [image] NULL 
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
</pre>
</p>
<p>
Dieses Script kann man nun auf einen beliebigen anderen Server transferieren, dort im Query Analyzer &ouml;ffnen
und ausf&uuml;hren - und schon hat man dort eine Tabelle <i>Categories</i>.
</p>
<p>
Wie generiert der Enterprise Manager dieses Script? Mit Hilfe von Stored Procedures? Weit gefehlt! Es gibt die
SQL Distributed Management Objects (SQLDMO), welche die gesamte Palette an Funktionen unterst&uuml;tzen - der 
Enterprise Manager verpackt diese "nur" in einem netten User Interface. Aber jeder - sogar ASP - kann auf SQLDMO
durchgreifen, und Objekte nach Belieben scripten lassen.
</p>

<h2>Scripting in ASP mit SQLDMO</h2>
<p>
Da wir jetzt wissen, wozu SQLDMO genutzt werden kann, schauen wir uns ein Beispiel an, das die Categories Tabelle
scriptet. Ich habe die Konstantennamen 1:1 aus der Dokumentation von SQL Server 2000 herausgenommen, damit man 
leichter danach suchen kann. Die Liste ist nat&uuml;rlich nicht vollst&auml;ndig, soll aber grunds&auml;tzlich zeigen, worauf der
Enterprise Manager aufsetzt - auf einer Liste simpler Konstanten!
</p>
<p>
<pre style="background='silver';">
&lt;%
Const SQLDMOScript_Drops = 1
Const SQLDMOScript_Default = 4
Const SQLDMOScript_UseQuotedIdentifiers = -1
Const SQLDMOScript_IncludeHeaders = 131072

Const SQLDMOScript_Indexes = 73736
Const SQLDMOScript_Triggers = 16

Const SQLDMOScript_DRI_All = 532676608 ' all of the below
Const SQLDMOScript_DRI_AllConstraints = 520093696
Const SQLDMOScript_DRI_ForeignKeys = 134217728
Const SQLDMOScript_DRI_PrimaryKey = 268435456

strFile = Server.MapPath(&quot;/sqldmo/demo.sql&quot;)

Set sql = Server.CreateObject(&quot;SQLDMO.SQLServer&quot;)
sql.LoginSecure = False ' we are not using NTLM
sql.LoginTimeout = 5 ' seconds
sql.Connect &quot;STRANGELOVE&quot;, &quot;sa&quot;, &quot;&quot;

Set db = sql.Databases(&quot;Northwind&quot;, &quot;dbo&quot;)
Set oTable = db.Tables(&quot;Categories&quot;)

nOptions = SQLDMOScript_Drops Or SQLDMOScript_Default
strResult = oTable.Script(nOptions, strFile)

Response.Write &quot;&lt;PRE&gt;&quot; &amp; strResult &amp; &quot;&lt;/PRE&gt;&quot;
%&gt;
</pre>
</p>
<p>
Das eigentlich Herzst&uuml;ck des Sourcecodes ist die <i>Script</i> Methode. Diese gibt es f&uuml;r (fast) alle Objekte in 
der SQLDMO Objekthierarchie (Stored Procedures, Views, etc), und erzeugt je nach Konstantenkombination das gew&uuml;nschte
SQL Script - sowohl als R&uuml;ckgabestring, und optional in eine Datei. In unserem Beispiel generiert der Code das
schon bekannte SQL Script:
</p>
<p><IMG SRC="Bilder/200011/20001108_05.png" width="590" height="375" alt="" border="0"></p>
<p>
Wer &uuml;brigens zu faul ist, die Konstanten einzutippen, der kann die SQLDMO Type Library einbinden.
Zum Beweis, da&szlig; es funktioniert, hier der entsprechende Sourcecode - es werden keine DROP Statements
generiert, und es wird keine Datei generiert.
<pre style="background='silver';">
&lt;!--METADATA NAME=&quot;Microsoft SQLDMO Object Library&quot; 
	TYPE=&quot;TypeLib&quot; 
	UUID=&quot;{10010001-E260-11CF-AE68-00AA004A34D5}&quot;
--&gt;
&lt;%
Set sql = Server.CreateObject(&quot;SQLDMO.SQLServer&quot;)

sql.LoginSecure = False ' we are not using NTLM
sql.LoginTimeout = 5 ' seconds
sql.Connect &quot;STRANGELOVE&quot;, &quot;sa&quot;, &quot;&quot;

Set db = sql.Databases(&quot;Northwind&quot;, &quot;dbo&quot;)
Set oTable = db.Tables(&quot;Categories&quot;)

nOptions = SQLDMOScript_Default
strResult = oTable.Script(nOptions)

Response.Write &quot;&lt;PRE&gt;&quot; &amp; strResult &amp; &quot;&lt;/PRE&gt;&quot;
%&gt;
</pre>
</p>
<p>
Ich habe die <i>Script</i> Methode hier anhand des <i>Table</i> Objekts gezeigt. Man kann nat&uuml;rlich so weit
gehen, und die gesamte <i>Generate SQL Scripts</i> Dialogbox in ASP nachbauen. Das ist aber dann die 
Hausaufgabe des Lesers.
</p>

<h2>Schlu&szlig;bemerkung</h2>
<p>
Als Abschlu&szlig; m&ouml;chte ich noch darauf hinweisen, da&szlig; man mit
SQLDMO nicht nur SQL Scripts erstellen kann - man kann in ASP fast den gesamten SQL Server Enterprise 
Manager nachbauen. Wer also ein Feature gerne Web-enabled h&auml;tte, der sollte sich mit SQLDMO besch&auml;ftigen.
</p>
<h2>Download des Codes</h2>
<p><a href="../Code/20001108.zip">Klicken Sie hier</a>, um den Download zu starten.</p>
<h2>Verwandte Artikel</h2>
<p>
<a href="20020322.htm">Query Express f&uuml;r MSDE</a><br>
<a href="20020903.htm">Stored Procedures einfach erstellt</a><br>

</p>
<h2>Links zu anderen Sites</h2>
<p>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Easptoday%2Ecom%2Farticles%2F19991123%2Ehtm">SQL Administration over the Web</a><br>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Ealphasierrapapa%2Ecom%2FIisDev%2FArticles%2FSQLAdmin%2F">SQL Server 6.5 Web Manager</a><br>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Easptoday%2Ecom%2Farticles%2F19991104%2Ehtm">The Power of SQL-DMO with ASP</a><br>

</p>

<h2>Wenn Sie jetzt Fragen haben...</h2>
<p>
Wenn Sie Fragen rund um die in diesem Artikel vorgestellte Technologie haben, dann schauen Sie einfach bei uns
in den <a href="http://glengamoi.com/forums/">Community Foren der deutschen .NET Community</a> vorbei. Die Teilnehmer 
helfen Ihnen gerne, wenn Sie sich zur im Artikel vorgestellten Technologie weiterbilden m&ouml;chten.
</p>

<p>
<a href="http://glengamoi.com/forums/"><img src="../images/glengamoi.com_250.gif" width="250" height="80" alt="" border="0"></a>
</p>


<p>
Haben Sie Fragen die sich direkt auf den Inhalt des Artikels beziehen, dann schreiben Sie dem Autor! Unsere Autoren
freuen sich &uuml;ber Feedback zu ihren Artikeln. Ein einfacher Klick auf die <i>Autor kontaktieren</i>
Schaltfl&auml;che (weiter unten) und schon haben Sie ein f&uuml;r diesen Artikel personalisiertes Anfrageformular.
</p>

<p>&nbsp;</p>
<p>
Und zu guter Letzt m&ouml;chten wir Sie bitten, den Artikel zu bewerten. Damit helfen Sie uns, 
die Qualit&auml;t der Artikel zu verbessern - und anderen Lesern bei der Auswahl der Artikel,
die sie lesen sollten.
</p>

<FORM METHOD="POST" STYLE="margin-bottom: 0px;" NAME="formRating" ACTION="/service/bewerten.asp">
<INPUT TYPE="HIDDEN" NAME="ArticleId" VALUE="20001108" />
<CENTER>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
	<TD ALIGN="CENTER" VALIGN="MIDDLE" COLSPAN="7">Bewerten Sie diesen Artikel</TD>
</TR>
<TR>
	<TD><EM>&nbsp;Sehr gut&nbsp;</EM></TD>
	<TD><INPUT TYPE="radio" value="1" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="2" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="3" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="4" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="5" NAME="radioRating" /></TD>
	<TD ALIGN="right"><EM>&nbsp;Nicht gen&uuml;gend</EM></TD>
	<TD ROWSPAN="2" VALIGN="middle">&nbsp;<INPUT TYPE="submit" VALUE="Werten!" /></TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD ALIGN="CENTER">&nbsp;1</TD>
	<TD ALIGN="CENTER">&nbsp;2</TD>
	<TD ALIGN="CENTER">&nbsp;3</TD>
	<TD ALIGN="CENTER">&nbsp;4</TD>
	<TD ALIGN="CENTER">&nbsp;5</TD>
	<TD>&nbsp;</TD>
</TR>
</TABLE>
</FORM>
</center>
&nbsp;<P>
<center>
<p><table><tr><td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="pagetitle" value="SQL Server Objekte scripten"><input type="hidden" name="pageurl" value="http://www.aspheute.com/artikel/20001108.htm"><input type="image" src="../images/layout/senden.png" width="107" height="20" border="0" alt="Schicken Sie diese Seite einem Freund!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="Author" value="Christoph Wille"><input type="hidden" name="AuthorEmail" value="christophw@alphasierrapapa.com"><input type="hidden" name="Artikel" value="20001108"><input type="image" src="../images/layout/kontakt.png" width="107" height="20" border="0" alt="Kontaktieren Sie den Autor!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top><a href="../PrinterFriendly/20001108.htm"><img src="../images/layout/druck.png" width="118" height="20" border="0" alt="F&uuml;r Ausdruck optimierte Seite"></a></td>
</tr></table></p>
</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
