<HTML>
<HEAD>
<TITLE>Spruch des Tages</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="7 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="Die Idee zum heutigen Artikel entstammt aus dem echten (Beisl)Leben, n&auml;mlich dem k.u.k. Hofbeisl in Bad Ischl. Der Artikel portiert den Spruch des Tages in die Welt des Internets und ASP.">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,Spruch,Spruchdatenbank,Spruch des Tages,MOD,Motto of Day,ADO,TOP Abfrage,Access,Include">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff"  BACKGROUND="../images/layout/aspheutemainbg.gif" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<MAP NAME="titlebar">
<!--<AREA SHAPE=RECT COORDS="116,46,191,61" HREF="http://www.aspaktuell.com" ALT="ASP Aktuell">-->
<!--<AREA SHAPE=RECT COORDS="192,46,255,61" HREF="http://www.aspwelt.com" ALT="ASP Welt">-->
<AREA SHAPE=RECT COORDS="256,46,432,61" HREF="http://www.aspgerman.com/aspgerman/" ALT="ASP German">
<AREA SHAPE=RECT COORDS="115,15,269,42" HREF="../default.htm" ALT="Homepage">
<AREA SHAPE=RECT COORDS="278,26,587,42" HREF="../default.htm" ALT="Homepage">
</MAP>

<div style="position:absolute;left:0px;top:30px">
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td background="../images/layout/aspheutetitle.gif">
<img src="../images/layout/blind.gif" width="715" height="73" usemap="#titlebar" border="0">
</td>
<td width="100%" background="../images/layout/aspheutetitleext.gif">
&nbsp;
</td>
<td background="../images/layout/aspheutetitleend.gif">
<img src="../images/layout/blind.gif" width="25" height="1">
</td>
</tr>
</table>
</div>

<div style="position:absolute;left:1px;top:115px">
<table width="110" border="0" cellspacing="0" cellpadding="0">
<tr><td width="110"><img src="../Images/spacer.gif" width="110" height="1" alt="" border="0"></td></tr>
<tr>
<td background="../images/layout/aspheuteheader.gif" class="header" height=16 width="110">
<p>Liste</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">

<p class="content">
<a href="../kategorien/dotNET%202dot0.htm">.NET 2.0 (1)</a><br>
<a href="../kategorien/dotNET%20Allgemein.htm">.NET Allgemein (16)</a><br>
<a href="../kategorien/dotNET%20Fu.htm">.NET Fu (5)</a><br>
<a href="../kategorien/ADOdotNET.htm">ADO.NET (11)</a><br>
<a href="../kategorien/Aprilscherz.htm">Aprilscherz (3)</a><br>
<a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen (44)</a><br>
<a href="../kategorien/ASP%20Tricks.htm">ASP Tricks (83)</a><br>
<a href="../kategorien/ASPdotNET.htm">ASP.NET (44)</a><br>
<a href="../kategorien/ASPIntranetdotde.htm">ASPIntranet.de (5)</a><br>
<a href="../kategorien/Csharp.htm">C# (28)</a><br>
<a href="../kategorien/Datenbank.htm">Datenbank (44)</a><br>
<a href="../kategorien/Dokumentation.htm">Dokumentation (4)</a><br>
<a href="../kategorien/IIS%206dot0.htm">IIS 6.0 (1)</a><br>
<a href="../kategorien/Komponenten.htm">Komponenten (29)</a><br>
<a href="../kategorien/Optimierung.htm">Optimierung (10)</a><br>
<a href="../kategorien/Server.htm">Server (21)</a><br>
<a href="../kategorien/Sicherheit.htm">Sicherheit (34)</a><br>
<a href="../kategorien/Tee%20Off.htm">Tee Off (6)</a><br>
<a href="../kategorien/VBdotNET.htm">VB.NET (6)</a><br>
<a href="../kategorien/WAP.htm">WAP (8)</a><br>
<a href="../kategorien/Web%20Services.htm">Web Services (11)</a><br>
<a href="../kategorien/XML.htm">XML (9)</a><br>


<br>
<a href="/syndication/rss.xml"><img src="../Images/rss_small.png" width="25" height="10" alt="RSS 2.0 - Die neuesten f&uuml;nf Artikel auf AspHeute.com" border="0"></a>

</p><!-- </p> remains -->


<br>

</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearch.gif" class="header" height=16 width="110">
<p>Suchen</p>
</td>
</tr>
<tr>
<td background="../images/layout/aspheutesearchext.gif" class="header" width="110">
<form class="content" ACTION="REMOVED" METHOD="GET">
<div>
<input class="Newsletter" type="text" size="10" name="CiRestriction">
<span class="spacer2"><br></span>
<span class="spacer4"><br></span>
<INPUT TYPE="HIDDEN" NAME="CiMaxRecordsPerPage" VALUE="10">
<INPUT TYPE="HIDDEN" NAME="CiSort" VALUE="rank[d]">
<INPUT TYPE="HIDDEN" NAME="HTMLQueryForm" VALUE="../default.htm">
<img src="../images/layout/blind.gif" width="41" height="1"><input type="image" src="../images/layout/aspheutesearchenter.gif" border="0" width="49" height="14"><br>
<span class="spacer4"><br></span>
</div>
</form>
</td>
</tr>
<tr>
<td class="empty" width="110">
&nbsp;
</td>
</tr>
<tr>
<td background="../images/layout/aspheuteheaderext.gif" class="header" width="110">
<p class="content">
<a href="/REMOVED/" title="Our most popular articles translated into English">English Articles</a><br>
<a href="/REMOVED/" title="Visit our Chinese content section">Chinese Articles</a><br>
<a href="../autoren/UnsereAutoren.htm" title="Unsere Autoren">Unsere Autoren</a><br>
&nbsp;<br>
<a href="/REMOVED/link2us.asp" title="Setzen Sie einen Link zu AspHeute!">Link zu AspHeute</a><br>
<a href="/REMOVED/impressum.asp" title="Das Impressum von AspHeute">Impressum</a><br>
<a href="/REMOVED/advertise.asp" title="Werben auch Sie auf AspHeute">Werben</a><br>
<a href="/REMOVED/kontakt.asp" title="Teilen Sie uns Ihre W&uuml;nsche, Beschwerden und Anregungen mit">Anfragen</a><br>
</p>
</td>
</tr>
</table>
</div>



<!-- Content starts here  -->
<div style="position:absolute;left:120px;top:108px">
<table cellspacing="0" cellpadding="0"><!--Tabelle aussen-->
<tr><!--Tabelle aussen, 1/2-->
<td><!--Tabelle aussen, 1/1-->
    <table border=0 align=center><tr><td align=center>


</td></tr></table>

<H1>Spruch des Tages</H1>
<p>
Geschrieben von: <a href="../autoren/herberthahn.htm">Herbert Hahn</a><br>
Kategorie: <a href="../kategorien/ASP%20Grundlagen.htm">ASP Grundlagen</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20020301"></SCRIPT>
</p>
<p>
Die Idee zum heutigen Artikel entstammt aus dem echten (Beisl)Leben, n&auml;mlich dem k.u.k. Hofbeisl 
in Bad Ischl, das jeden Tag auf's neue einen Spruch des Tages auf einer Schautafel vor das 
Lokal stellt. Der Artikel "portiert" den Spruch des Tages in die Welt des Internets und ASP.
</p>
<p>
In unserer "Portierung" kommen die Spr&uuml;che aus einer Access Datenbank. Damit wir den tagesaktuellen 
Spruch in unsere Startseite (und andere Unterseiten) einbauen k&ouml;nnen, kapseln wir die Spruchabfrage 
in einer separaten ASP Datei. Deshalb beginnen wir bei der Datenbank und der Include-Datei.
</p>

<h2>Die Vorbereitung</h2>
<p>
Die Datenbank besteht lediglich aus einer Tabelle. Diese Tabelle <b>tblSpruch</b> beinhaltet alle unsere 
Spr&uuml;che, und erlaubt auch die Erweiterung in Richtung von Usern vorgeschlagenen Spr&uuml;chen:
</p>
<IMG SRC="Bilder/200203/20020301.png" width="512" height="431" alt="" border="0">
<p>
Wenn wir die Datenbank fertig haben, wenden wir uns dem Script zum Auslesen der Spr&uuml;che zu 
(<b>SpruchInclude.asp</b>). Das &Ouml;ffnen der Datenbank geschieht mit einer Funktion, die in der aktuellen 
Implementierung annimmt, da&szlig; die Datenbankdatei auch im gleichen Verzeichnis liegt wie das Script. 
Diese Annahme mu&szlig; man je nach eigenem Webserversetup korrigieren.
</p>

<pre style="background='silver';">
&lt;%
Sub OpenDB(ByRef con, d)
	DB = d &amp; ".mdb"
	Dir = Request.ServerVariables("SCRIPT_NAME")
	Dir = StrReverse(Dir)
	Dir = Mid(Dir, InStr(1, Dir, "/"))
	Dir = StrReverse(Dir)
	Path = Server.MapPath(Dir) &amp; "\"
	DSN = "DRIVER=Microsoft Access Driver (*.mdb);FIL=MS Access;DriverId=25" &amp;_
        ";DefaultDir=" &amp; Path &amp; ";DBQ=" &amp; Path &amp; DB &amp; ";"
	Set con = Server.CreateObject("ADODB.Connection")
	con.Open DSN
End Sub
</pre>
<p>
In <b>SpruchInclude.asp</b> findet sich dann noch eine zweite Funktion, <i>GetSpruch</i>, die die eigentliche 
Arbeit des Auslesens des Spruchs &uuml;bernimmt. Dieser Funktion &uuml;bergibt man das Datum, f&uuml;r das man 
den Spruch ermitteln will, und bekommt dann den Text, den  Autor, als auch das ausgelesene Datum 
zur&uuml;ck (dazu mehr sp&auml;ter):
</p>
<pre style="background='silver';">
Sub GetSpruch(ByVal varDate, ByRef strSpruch, ByRef strAutor, ByRef dtDatum)
 varSqlDate = "#" &amp; Month(varDate) &amp; "/"  &amp; Day(varDate) &amp; "/"  &amp; Year(varDate) &amp; "#"
</pre>
<p>
Da man mit VBScript Datumswerten bei SQL Statements immer Schiffbruch erleidet, konvertiere ich es 
zuallererst  in einen SQL-vertr&auml;glichen Datumsstring.  Weiter geht es mit dem &Ouml;ffnen der Datenbank:
</p>
<pre style="background='silver';">
 OpenDB con, "Sprueche_db"
 SQL = "SELECT TOP 1 * FROM tblSpruch Where fldSichtbar=True AND " &amp; _
	" fldDatum &lt;= " &amp; varSqlDate &amp; " ORDER BY fldDatum DESC"
</pre>
<p>
Der SQL Befehl selektiert mir genau einen Spruch (<i>TOP 1</i>) der am oder vor dem angegebenen Datum 
aktuell war. Der Grund hierf&uuml;r: erstens wollen wir keine Eintr&auml;ge aus der Zukunft sehen, zweitens 
k&ouml;nnte es vorkommen da&szlig; am gew&uuml;nschten Tag kein Spruch eingegeben wurde, und deshalb nehmen wir 
einfach den n&auml;chst-&auml;lteren. Das SQL-Statement zeigt mir au&szlig;erdem  nur die Spr&uuml;che in der 
Datenbank, die auch als sichtbar markiert sind. (Vorausschauend haben wir dieses Flag in die 
Datenbank aufgenommen um auch von den Besuchern der Seite Spr&uuml;che entgegennehmen zu k&ouml;nnen. Diese 
k&ouml;nnen dann von einem Administrator freigegeben werden.)
</p>
<pre style="background='silver';">
 Set rs = con.Execute(SQL)

 If Not rs.EOF Then
   Spruch = rs.Fields("fldSpruch").Value
   Autor = rs.Fields("fldAutor").Value
   Datum = rs.Fields("fldDatum").Value
 End If

 rs.Close
 con.Close
 Set rs = Nothing
 Set con = Nothing
End Sub
</pre>
<p>
Das SQL Statement wird ausgef&uuml;hrt, und die Resultate der einzigen Datenzeile ausgelesen. Danach geht 
es nur noch ans Aufr&auml;umen, und schon ist die Funktion abgearbeitet.
</p>

<h2>Der Einsatz</h2>
<p>
Damit wir den Spruch nun in einer Seite (zB auf der Startseite) verwenden k&ouml;nnen, ist nur das Einbinden 
der gerade erstellten Include-Datei notwendig (<b>SpruchDesTages.asp</b>):
</p>
<pre style="background='silver';">
&lt;!--#include file="SpruchInclude.asp"--&gt;
&lt;%
Dim varToday, Spruch, Autor, Datum

' Je nach Server musz man das Datum korrigieren (zB +6 Stunden)
varToday = Date()
GetSpruch varToday, Spruch, Autor, Datum
%&gt;
</pre>
<p>
Das aktuelle Datum wird ermittelt, und damit dann die <i>GetSpruch</i> Funktion aufgerufen. Alles 
was noch zu tun bleibt ist den Spruch auf der Seite darzustellen:
</p>

<pre style="background='silver';">
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Spruch des Tages&lt;/title&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"&gt;
&lt;/head&gt;

&lt;body bgcolor="#ffffff" text="#000000"&gt;
&lt;table width="75%" border="0" align="center" cellspacing="0" cellpadding="0"&gt;
  
  &lt;TR&gt;
    &lt;TD width=150&gt;&lt;/TD&gt;
    &lt;TD&gt;&lt;/TD&gt;
    &lt;TD width=150&gt;&lt;/TD&gt;&lt;/TR&gt;
  &lt;tr&gt;
    &lt;td width="150"&gt;&amp;nbsp;&lt;/TD&gt;
    &lt;td&gt;
      &lt;div align="center"&gt;
        &lt;IMG align=middle height=44 src="softwing.gif" width=135&gt;
      &lt;/DIV&gt;&lt;/TD&gt;
    &lt;td width="150"&gt;&amp;nbsp;&lt;/TD&gt;&lt;/TR&gt;
  &lt;TR&gt;
    &lt;TD width=150&gt;&lt;/TD&gt;
    &lt;TD&gt;&lt;/TD&gt;
    &lt;TD width=150&gt;&lt;/TD&gt;&lt;/TR&gt;
  &lt;tr&gt; 
    &lt;td width="150"&gt;&amp;nbsp;&lt;/TD&gt;
    &lt;td&gt; 
      &lt;div align="center"&gt;&lt;b&gt;&lt;font face="Arial" size="4"&gt;Der Spruch 
      des Tages&lt;/FONT&gt;&lt;/B&gt;&lt;/DIV&gt;&lt;/TD&gt;
    &lt;td width="150"&gt;&amp;nbsp;&lt;/TD&gt;&lt;/TR&gt;
  &lt;tr&gt; 
    &lt;td width="150"&gt;&amp;nbsp;&lt;/TD&gt;
    &lt;td&gt; 
      &lt;div align="center"&gt;&lt;font face="Arial" size="3"&gt;
      &lt;% = Spruch %&gt;
      &lt;/FONT&gt;&lt;/DIV&gt;&lt;/TD&gt;
    &lt;td width="150"&gt;&amp;nbsp;&lt;/TD&gt;&lt;/TR&gt;
  &lt;tr&gt; 
    &lt;td width="150"&gt;&amp;nbsp;&lt;/TD&gt;
    &lt;td&gt;&lt;font size="2" face="Arial"&gt;Autor:
      &lt;% = Autor % &gt;  
      &lt;br&gt;
      Datum:
      &lt;% = Datum %&gt;
       &lt;/FONT&gt;&lt;/TD&gt;
    &lt;td width="150"&gt;&amp;nbsp;&lt;/TD&gt;&lt;/TR&gt;&lt;/TABLE&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
<p>
Damit haben wir den Spruch des Tages in unserer Seite eingebaut. 
</p>

<h2>Schlu&szlig;bemerkung</h2>
<p>
Nat&uuml;rlich gibt es f&uuml;r das Einbauen in eine Seite elegantere Varianten, jedoch ging es mir hier um die 
Spruchdatenbank selbst. Verwendet habe ich dieses Script im Projekt <a href="http://www.kukhofbeisl.at" target="_blank">http://www.kukhofbeisl.at</a> 
(Es ist mein Stammbeisl und mitunter kommt hier auch Christoph Wille als Gast vor). 
</p>
<p>
Wer jetzt sagt "ist ja ganz nett aber wo bekomme ich die vielen Spr&uuml;che her", dem kann geholfen werden. 
Mit <a href="http://www.kukhofbeisl.at/kuk4you/spruch/gastspruch.asp" target="_blank">dieser Url</a> 
kann man eine kleine Spruchseite in die eigene Site einbauen, die von der k.u.k. Crew t&auml;glich gewartet 
wird. Die Qualit&auml;t der Spr&uuml;che ist hier im ganzen Salzkammergut bekannt.
</p>
<h2>Download des Codes</h2>
<p><a href="../Code/20020301.zip">Klicken Sie hier</a>, um den Download zu starten.</p>

<h2>Wenn Sie jetzt Fragen haben...</h2>
<p>
Wenn Sie Fragen rund um die in diesem Artikel vorgestellte Technologie haben, dann schauen Sie einfach bei uns
in den <a href="http://glengamoi.com/forums/">Community Foren der deutschen .NET Community</a> vorbei. Die Teilnehmer 
helfen Ihnen gerne, wenn Sie sich zur im Artikel vorgestellten Technologie weiterbilden m&ouml;chten.
</p>

<p>
<a href="http://glengamoi.com/forums/"><img src="../images/glengamoi.com_250.gif" width="250" height="80" alt="" border="0"></a>
</p>


<p>
Haben Sie Fragen die sich direkt auf den Inhalt des Artikels beziehen, dann schreiben Sie dem Autor! Unsere Autoren
freuen sich &uuml;ber Feedback zu ihren Artikeln. Ein einfacher Klick auf die <i>Autor kontaktieren</i>
Schaltfl&auml;che (weiter unten) und schon haben Sie ein f&uuml;r diesen Artikel personalisiertes Anfrageformular.
</p>

<p>&nbsp;</p>
<p>
Und zu guter Letzt m&ouml;chten wir Sie bitten, den Artikel zu bewerten. Damit helfen Sie uns, 
die Qualit&auml;t der Artikel zu verbessern - und anderen Lesern bei der Auswahl der Artikel,
die sie lesen sollten.
</p>

<FORM METHOD="POST" STYLE="margin-bottom: 0px;" NAME="formRating" ACTION="/service/bewerten.asp">
<INPUT TYPE="HIDDEN" NAME="ArticleId" VALUE="20020301" />
<CENTER>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
<TR>
	<TD ALIGN="CENTER" VALIGN="MIDDLE" COLSPAN="7">Bewerten Sie diesen Artikel</TD>
</TR>
<TR>
	<TD><EM>&nbsp;Sehr gut&nbsp;</EM></TD>
	<TD><INPUT TYPE="radio" value="1" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="2" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="3" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="4" NAME="radioRating" /></TD>
	<TD><INPUT TYPE="radio" value="5" NAME="radioRating" /></TD>
	<TD ALIGN="right"><EM>&nbsp;Nicht gen&uuml;gend</EM></TD>
	<TD ROWSPAN="2" VALIGN="middle">&nbsp;<INPUT TYPE="submit" VALUE="Werten!" /></TD>
</TR>
<TR>
	<TD>&nbsp;</TD>
	<TD ALIGN="CENTER">&nbsp;1</TD>
	<TD ALIGN="CENTER">&nbsp;2</TD>
	<TD ALIGN="CENTER">&nbsp;3</TD>
	<TD ALIGN="CENTER">&nbsp;4</TD>
	<TD ALIGN="CENTER">&nbsp;5</TD>
	<TD>&nbsp;</TD>
</TR>
</TABLE>
</FORM>
</center>
&nbsp;<P>
<center>
<p><table><tr><td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="pagetitle" value="Spruch des Tages"><input type="hidden" name="pageurl" value="http://www.aspheute.com/artikel/20020301.htm"><input type="image" src="../images/layout/senden.png" width="107" height="20" border="0" alt="Schicken Sie diese Seite einem Freund!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top>
<form action="REMOVED" method="GET"><input type="hidden" name="Author" value="Herbert Hahn"><input type="hidden" name="AuthorEmail" value="herbert.hahn@softwing.com"><input type="hidden" name="Artikel" value="20020301"><input type="image" src="../images/layout/kontakt.png" width="107" height="20" border="0" alt="Kontaktieren Sie den Autor!" style="cursor='hand';"></form>
<td>&nbsp;&nbsp;</td>
<td valign=top><a href="../PrinterFriendly/20020301.htm"><img src="../images/layout/druck.png" width="118" height="20" border="0" alt="F&uuml;r Ausdruck optimierte Seite"></a></td>
</tr></table></p>
</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
