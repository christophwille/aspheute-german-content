<HTML>
<HEAD>
<TITLE>Schlu&szlig; mit lustig Teil 3 - das Hfnetchk Tool</TITLE>
<META HTTP-EQUIV="content-type: text/html; charset= ISO-8859-1">
<META HTTP-EQUIV="Content-Language" CONTENT="DE">
<META NAME="robots" CONTENT="FOLLOW,INDEX">
<META NAME="generator" CONTENT="Xitra Site Publishing">
<meta name="Author" content="webmaster@aspheute.com">

<META NAME="revisit-after" CONTENT="21 days">
<META NAME="copyright" CONTENT="(c) 2000-2006. Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich geschützt.">
<META HTTP-EQUIV="expires" CONTENT="1999-03-30T00:00:00+00:00"> 
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-store">

<meta http-equiv="Description" name="Description" content="Die Vorg&auml;ngerversion, das IIS 5.0 Hotfix Checking Tool, hatte den Nachteil da&szlig; nur der IIS auf das Vorhandensein von Hotfixes hin uuml;berpr&uuml;ft wurde. Das Hfnetchk Tool hingegen kann nun einiges mehr.">
<meta http-equiv="Keywords" name="Keywords" content="ASP,Active Server Pages,IIS,Internet Information Server,PWS,Personal Web Server,ADO,Hfnetchk,Sicherheit,Check,Hotfix,Bugfix,Scan,Scanning,Security,Scanner,Patch,IIS,SQL Server,Windows 2000">
<link rel="stylesheet" href="../includes/default.css">
</HEAD>
<BODY BGCOLOR="#ffffff" >


<div style="border-bottom: solid 5px white;">
<div class="DotNetGermanCommunityBar">
    <a href="http://www.glengamoi.com">Glengamoi (Forum)</a> &middot;
    <a href="http://www.aspheute.com/" style="font-weight: bold">AspHeute</a> &middot;
    <a href="http://dotnetheute.com/">.NET Heute (RSS-Suche)</a> &middot;
    <a href="http://aspxfiles.com/">AspxFiles (Wiki)</a> &middot;
    <a href="http://blogs.dotnetgerman.com/">.NET Blogs</a>
</div>
</div>


<H1>Schlu&szlig; mit lustig Teil 3 - das Hfnetchk Tool</H1>
<p>
Geschrieben von: <a href="../autoren/christianholm.htm">Christian Holm</a><br>
Kategorie: <a href="../kategorien/Sicherheit.htm">Sicherheit</a><br>
<SCRIPT src="/service/artikelbewertung.asp?Artikel=20010928"></SCRIPT>
</p>


<p><strong>This printed page brought to you by <a href="http://www.alphasierrapapa.com/">AlphaSierraPapa</a></strong></p><p>
Im dritten Teil dieser "Wie sichere ich meinen Web Server gegen 'Se Evil Folks' ab" Serie stelle ich Ihnen das
Hfnetchk Tool oder ausgeschrieben das Microsoft Network Security Hotfix Checker Tool vor. Die
Vorg&auml;ngerversion, das "IIS 5.0 Hotfix Checking Tool", hatte den Nachteil da&szlig; "nur" der IIS auf das
Vorhandensein von Hotfixes hin &uuml;berpr&uuml;ft wurde. Das Hfnetchk Tool hingegen kann nun einiges mehr.
Dies und wie man eine &Uuml;berpr&uuml;fung automatisert bzw. per Email versenden kann, lesen Sie in diesem
Artikel.
</p>

<p>
Im Moment arbeiten Microsoft und Shavlik Technologies an einer neueren Version des Kommandozeilentools die von der
<a href="http://ntbugtraq.ntadvice.com../default.htm?sid=1&pid=55&did=37" target="_blank">NTBugTraq</a> Web Site downgeloadet 
werden kann. Diese befindet sich allerdings noch im Beta Stadium. Eine (&auml;ltere) offizielle
Releaseversion k&ouml;nnen Sie direkt bei Microsoft unter 
<a href="http://support.microsoft.com/support/kb/articles/q303/2/15.asp?id=303215&sd=tech#Download" target="_blank">diesem Link</a>
downloaden. Beginnen wir aber mit den Features der offizielle Releaseversion. Diese kann im Vergleich zum
IIS 5.0 Hotfix Checking Tool eben nicht nur den IIS (jetzt auch Version 4) scannen sondern auch folgende 
Microsoft Produkte:
</p>

<ul>
<li>Windows NT 4.0 and Windows 2000 Betriebssysteme</li>
<li>MS SQL Server 7/2000 (inklusive Microsoft Data Engine (MSDE)</li>
<li>Internet Explorer Versionen ab 5.01</li>
</ul>

<p>
Neu ist auch die M&ouml;glichkeit da&szlig; diese Produkte sich auch auf Remote Computern, also im Netzwerk befinden k&ouml;nnen.
Zus&auml;tzlich zur Netzwerkfunktionalit&auml;t k&ouml;nnen Sie nun auch IP-Ranges angeben um mehrere Adressen innerhalb
eines Tasks scannen zu lassen. Die Betaversion, die Sie unter der angegebenen 
<a href="http://ntbugtraq.ntadvice.com../default.htm?sid=1&pid=55&did=37" target="_blank">NTBugTraq</a> 
Adresse downloaden k&ouml;nnen, scannt den oder die angegebenen Computer bzw. Server zus&auml;tzlich auf das Vorhandensein
einiger Dateien die mit dem Nimda Virus in Zusammenhang stehen:
</p>

<ul>
<li>admin.dll</li>
<li>root.exe</li>
<li>readme.eml</li>
<li>readme.exe</li>
</ul>

<p>
Diese Dateien sucht das Kommandozeilentool in diversen Windows bzw. Web Server Standardverzeichnissen. Alle beide
Versionen k&ouml;nnen <i>kostenlos</i> unter den genannten Links downgeloaded werden. Wie gesagt, ist es ein 
Kommandozeilentool, d.h. auf eine komfortable GUI m&uuml;ssen Sie verzichten. Dies gilt genauso f&uuml;r die Auswertung
des Reports der wahlweise entweder einfach nur in der Kommandozeile (<b>cmd.exe</b>) eingesehen werden kann oder 
Sie lassen sich per optionalen Parameter den Report in eine Datei speichern. Wenn Ihnen das aber zuwenig ist
m&uuml;ssen Sie sich entweder eine GUI bzw. ein Auswertungstool selber programmieren oder Sie schauen bei 
Shavlik Technologies vorbei und bestellen sich unter <a href="http://www.shavlik.com/nshc.htm" target="_blank">diesem Link</a>
die "Shavlik GUI" (diese ist nicht gratis).
</p>

<p>
Befassen wir uns aber mit der von Microsoft 
<a href="http://support.microsoft.com/support/kb/articles/q303/2/15.asp?id=303215&sd=tech#Download" target="_blank">downloadbaren</a> 
Version. Nach dem Download und Extrahieren in ein beliebiges Verzeichnis der <b>hfnetchk.zip</b> Datei k&ouml;nnen
Sie auf dem Kommandozeilenprompt gleich loslegen. Wie bei (fast) jedem Kommandozeilentool k&ouml;nnen Sie
mit 
</p>

<pre style="background='silver';">
hfnetchk -?
</pre>

<p>
den genauen Syntax des Tools und eine Auflistung der verf&uuml;gbaren Parameter einsehen. Bevor wir zu
einer webgest&uuml;tzten Ausf&uuml;hrung bzw. einer Automatisierung des Tools mit Hilfe eines Scheduled Tasks &uuml;bergehen, 
nur kurz die Basics und die wichtigsten Parameter.
</p>

<p>
Das Tool sucht am lokalen Computer bzw. Servern im Netzwerk nach den installierten Patches. Hierbei vergleicht
es die gefundenen Patches mit einer XML-Datei namens <b>mssecure.xml</b>. Diese XML Datei enth&auml;lt neben den 
aktuellen Versionsnummern der Patches auch ihre Pr&uuml;fsummen um so virale Ver&auml;nderungen zu erkennen.
</p>

<p>
Da die XML immer am neuesten Stand gehalten wird, ist diese im Download nicht inkludiert. Das bedeutet Sie m&uuml;ssen 
bei der erstmaligen Ausf&uuml;hrung dieses Tools eine aktive Verbindung zum Internet haben. Ein Beispiel. Sie wechseln in
das Unterverzeichnis in welches das Tool installiert wurde und geben einfach
</p>

<pre style="background='silver';">
hfnetchk
</pre>

<p>
ein. Dies bewirkt da&szlig; eine digital signierte (um F&auml;lschungen auszuschlie&szlig;en) Cabinet-Datei (.cab) namens
<b>mssecure.cab</b> von einem Microsoft Server downgeloaded wird. Hierbei erhalten Sie eine Sicherheitsinformation
&uuml;ber die digitale Signatur der Datei, die Sie falls authentisch, mit "Yes" best&auml;tigen m&uuml;ssen um fortzufahren:
</p>

<IMG SRC="/artikel/Bilder/200109/20010928_1.png" width="666" height="451" alt="" border="0">

<p>
Da wir keine zus&auml;tzlichen Parameter und auch keine Hostnamen angegeben haben, wird sogleich der lokale Computer
&uuml;berpr&uuml;ft.
</p>

<h2>Anwendungsbeispiele</h2>

<p>
Scannen mehrerer Computer durch Angabe ihrer NetBIOS Namen (getrennt durch Beistriche):
</p>

<pre style="background='silver';">
hfnetchk -h kilauea,hamunaptra,bluescreen,coruscant
</pre>

<p>
Scannen von einzelnen IP-Adressen (wieder getrennt durch Beistriche) bzw. IP-Ranges:
</p>

<pre style="background='silver';">
hfnetchk -h 192.168.200.10,192.168.200.20,192.168.200.30
<i>bzw.</i>
hfnetchk -h 192.168.200.10-192.168.200.70
</pre>

<p>
Scannen von Domains und zus&auml;tzliches Anzeigen der installierten Hotfixes (Parameter <i>-a</i>)
sowie mit Information &uuml;ber die installierten und fehlenden Hotfixes (Zusatz <i>b</i>):
</p>

<pre style="background='silver';">
hfnetchk -d dev.sirefnicks -a b
</pre>

<p>
Scannen des Servers "kilauea", Ausgabe des Reports in die <b>MyReport.txt</b> Datei (Parameter <i>-o</i>, hier zus&auml;tzlich 
Trennung der Eintr&auml;ge durch Tabulatoren) und Verwendung der bereits downgeloadeten <b>mssecure.xml</b> Datei 
(Parameter <i>-x</i>):
</p>

<pre style="background='silver';">
hfnetchk -h kilauea -o tab &gt; MyReport.txt -x mssecure.xml
</pre>

<p>
Da hier bei den Dateiangaben keine Pfade angegeben wurden, wird die <b>MyReport.txt</b> Datei in das 
Rootverzeichnis der lokalen C: Partition kopiert und die <b>mssecure.xml</b> Datei mu&szlig; im gleichen Verzeichnis wie 
die <b>hfnetchk.exe</b> Datei liegen. Mit Pfadangaben k&ouml;nnen Sie nat&uuml;rlich auf andere Speicherorte der beiden 
Dateien verweisen (auch auf Netzlaufwerke):
</p>

<pre style="background='silver';">
hfnetchk -h kilauea -o tab &gt; C:\HFnetchkTool\Reports\MyReport.txt -x http://192.168.200.10/_
	HFnetchkTool/XML/mssecure.xml
</pre>

<p>
Als Abschlu&szlig;beispiele habe ich zum einen eine Ausf&uuml;hrung in ASP und eine automatisierte Ausf&uuml;hrung der Datei
durch einen Scheduled Task vorbereitet. Sehen wir uns zun&auml;chst die ASP Datei an (<b>HFCheck.asp</b>):
</p>

<pre style="background='silver';">
&lt;%
Set fso = Server.CreateObject("Scripting.FileSystemObject")

strXmlFile = "mssecure.xml"
strFileSpecs = Server.MapPath(strXmlFile)
strMyReport = "MyReport.txt"
strMyReportSpecs = Server.MapPath(strMyReport)
strMailFrom = "admin@sirefnicks.com"
strMailTo = "jsirefnicks@sirefnicks.com"
strMailSubject = "HFCheck Tool Report" &amp; Now

If (fso.FileExists(strFileSpecs)) Then
    strCommand = Server.MapPath("hfnetchk.exe") &amp; " -o tab &gt; " &amp; _
                     Server.MapPath(strMyReport) &amp; " -x " &amp; strXmlFile
Else
    strCommand = Server.MapPath("hfnetchk.exe") &amp; " -o tab &gt; " &amp; _
                     Server.MapPath(strMyReport)
End If
Response.Write strCommand

Set objWsh = Server.CreateObject("WScript.Shell")
nRetVal = objWsh.Run(strCommand, 1, True)
Set objWsh = Nothing

If (fso.FileExists(strFileSpecs)) Then
	
    Set objCDONTS = Server.CreateObject("CDONTS.NewMail")
	
    objCDONTS.From = strMailFrom
    objCDONTS.To = strMailTo
    objCDONTS.Subject = strMailSubject
    objCDONTS.AttachFile strMyReportSpecs
    objCDONTS.Send
    Set objCDONTS = Nothing
	
    If Err.Number &lt;&gt; 0 Then
        Response.Write "&lt;b&gt;Error(s) during SendMail:&lt;/b&gt;"
        Response.Write "Fehlercode: " &amp; Err.Number &amp; "&lt;br&gt;"
        Response.Write "Quelle: " &amp; Err.Source &amp; "&lt;br&gt;"	
        Response.Write "Beschreibung: " &amp; Err.Description &amp; "&lt;br&gt;"
    End If
Else
    Response.Write "Couldn't send Mail - No Report File"
End If		
Set fso = Nothing
%&gt;
</pre>

<p>
Nicht allzu komplex - einfach je nach Vorhandensein der <b>mssecure.xml</b> den Syntax f&uuml;r das Tool zusammengesetzt
und dann mit Hilfe der <i>Run</i> Methode des Windows Scripting Host das Tool aufgerufen. Dabei wird gem&auml;&szlig; der
angegebenen Parameter der Report in eine Datei (MyReport.txt) geschrieben. Diese kann dann entweder im Browser 
selbst optisch aufbereitet werden, oder wie hier per CDONTS als Emailattachment an die genannte Adresse versandt 
werden.
</p>

<p>
Um up-to-date zu bleiben kann man auch einen Scheduled Task einrichten. Hierf&uuml;r erstellt man zun&auml;chst ein
Windows Script File (.wsf), welches wie oben die gleiche Aufgabe erf&uuml;llt, nur mit entsprechendem Syntax
<b>HFChk.wsf</b>:
</p>

<pre style="background='silver';">
&lt;package&gt;
&lt;Job id="HFCheck"&gt;
&lt;script language="VBScript"&gt;

Set fso = CreateObject("Scripting.FileSystemObject")

strXmlFile = "mssecure.xml"
strFileSpecs = "C:\LocalSites\TestRoot\HFCheck" &amp; strXmlFile
strMyReport = "MyReport.txt"
strMyReportSpecs = "C:\LocalSites\TestRoot\HFCheck" &amp; strMyReport
strMailFrom = "jsirefnicks@holmcs.com"
strMailTo = "office@holmcs.com"
strMailSubject = "HFCheck Tool Report" &amp; Now

If (fso.FileExists(strFileSpecs)) Then
    strCommand = "C:\LocalSites\TestRoot\HFCheck\hfnetchk.exe" &amp; " -o tab &gt; 
        " &amp; "C:\LocalSites\TestRoot\HFCheck\" &amp; strMyReport &amp; " 
        -x " &amp; strXmlFile
Else
    strCommand = "C:\LocalSites\TestRoot\HFCheck\hfnetchk.exe" &amp; " -o tab &gt; " 
        &amp; "C:\LocalSites\TestRoot\HFCheck\" &amp; strMyReport
End If

Set objWsh = CreateObject("WScript.Shell")

nRetVal = objWsh.Run(strCommand, 1, True)

Set objWsh = Nothing

If (fso.FileExists(strFileSpecs)) Then
	Set objCDONTS = CreateObject("CDONTS.NewMail")
    objCDONTS.From = strMailFrom
    objCDONTS.To = strMailTo
    objCDONTS.Subject = strMailSubject
    objCDONTS.AttachFile strMyReportSpecs
    objCDONTS.Send
    Set objCDONTS = Nothing
End If		
Set fso = Nothing
&lt;/script&gt;
&lt;/Job&gt;
&lt;/package&gt; 
</pre>

<p>
Damit diese wsf-Datei auch einfach ausgef&uuml;hrt werden kann, habe ich eine Batch-Datei 
(<b>HFChkExec.bat</b>) erstellt, die folgendes enth&auml;lt:
</p>

<pre style="background='silver';">
cscript //Job:HFCheck HFChk.wsf
</pre>

<p>
Nun mu&szlig; diese Batch-Datei noch in die Scheduled Taskliste (Start|Settings|Control Panel|Scheduled Tasks|
Add Scheduled Task) eingetragen und Startzeit, etc. angegeben werden.
Hierbei ist aber zu beachten, da&szlig; w&auml;hrend der Ausf&uuml;hrung dieses Tasks (falls notwendig) eine Netzwerkverbindung
vorhanden sein mu&szlig;.
</p>

<h2>Schlu&szlig;bemerkung</h2>

<p>
Mit dem Hfnetchk Tool haben Sie immer eine &Uuml;bersicht auf die aktuellen Patches, die zur Zeit verf&uuml;gbar sind.
Dieses Tool l&auml;&szlig;t sich neben der einfachen Handhabung auch leicht in ASP einbauen um z.B. eine GUI f&uuml;r den
erstellten Report zu kreieren, per Email zu versenden, etc. oder es auch automatisiert per Scheduled
Task ablaufen zu lassen. Der Programmieraufwand hierf&uuml;r ist relativ gering, Ihre Web Server sind 
immer up-to-date und daher vor "Se Evil Folks" sicher.
</p>

<p><strong>This printed page brought to you by <a href="http://www.alphasierrapapa.com/">AlphaSierraPapa</a></strong></p>
<h2>Download des Codes</h2>
<p><a href="../Code/20010928.zip">Klicken Sie hier</a>, um den Download zu starten.<br><SPAN class="content">http://www.aspheute.com/code/20010928.zip</span></p>
<h2>Verwandte Artikel</h2>
<p>
<a href="../artikel/20010220.htm">Applikationen aus ASP.NET ausf&uuml;hren</a><br>
<SPAN class="content">http:/www.aspheute.com/artikel/20010220.htm</span><br>
<a href="../artikel/20000511.htm">Automation - WSH versus Wget</a><br>
<SPAN class="content">http:/www.aspheute.com/artikel/20000511.htm</span><br>
<a href="../artikel/20020412.htm">Der Microsoft Baseline Security Analyzer (MBSA) 1.0</a><br>
<SPAN class="content">http:/www.aspheute.com/artikel/20020412.htm</span><br>
<a href="../artikel/20010516.htm">Kommandozeilen-Programme aufrufen</a><br>
<SPAN class="content">http:/www.aspheute.com/artikel/20010516.htm</span><br>
<a href="../artikel/20010926.htm">Schlu&szlig; mit lustig - das IIS Lockdown Tool</a><br>
<SPAN class="content">http:/www.aspheute.com/artikel/20010926.htm</span><br>
<a href="../artikel/20010927.htm">Schlu&szlig; mit lustig Teil 2 - das URLScan Tool</a><br>
<SPAN class="content">http:/www.aspheute.com/artikel/20010927.htm</span><br>
<a href="../artikel/20011119.htm">Schritt-f&uuml;r-Schritt Debuggen von Sicherheitsproblemen</a><br>
<SPAN class="content">http:/www.aspheute.com/artikel/20011119.htm</span><br>
<a href="../artikel/20010419.htm">Site&uuml;berwachung mit Scheduled Tasks</a><br>
<SPAN class="content">http:/www.aspheute.com/artikel/20010419.htm</span><br>

</p>
<h2>Links zu anderen Sites</h2>
<p>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fntbugtraq%2Entadvice%2Ecom%2Fdefault%2Easp%3Fsid%3D1%26pid%3D55%26did%3D37">HFNetChk 3.2 beta build 9/20/2001</a><br>
<SPAN class="content">http://ntbugtraq.ntadvice.com../default.htm?sid=1&pid=55&did=37</span><br>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fsupport%2Emicrosoft%2Ecom%2Fsupport%2Fkb%2Farticles%2Fq303%2F2%2F15%2Easp%3Fid%3D303215%26sd%3Dtech%23Download">Microsoft Network Security Hotfix Checker</a><br>
<SPAN class="content">http://support.microsoft.com/support/kb/articles/q303/2/15.asp?id=303215&sd=tech#Download</span><br>
<a target="_blank" href="/REMOVED/3w_link.asp?3wsite=http%3A%2F%2Fwww%2Eshavlik%2Ecom%2Fnshc%2Ehtm">Shavlik Network Security Hotfix Checker</a><br>
<SPAN class="content">http://www.shavlik.com/nshc.htm</span><br>

</p>

&nbsp;<P>
<center>

</center>

<center>
<p class="content">
&copy;2000-2006 <A HREF="../service/copyright.htm" title="Copyright Informationen">AspHeute.com</A><br>
Alle Rechte vorbehalten. Der Inhalt dieser Seiten ist urheberrechtlich gesch&uuml;tzt.<br>
Eine &Uuml;bernahme von Texten (auch nur auszugsweise) oder Graphiken bedarf unserer schriftlichen Zustimmung.
<hr>
</p>
</center>

</td>
</tr><!--Tabelle aussen, 2/2-->
</table><!--Tabelle aussen-->
</div>

</BODY>
</HTML>
